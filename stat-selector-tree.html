<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistical Test Selector - Marketing Analytics Tools</title>
    <link rel="stylesheet" href="shared/css/main.css">
    <script src="shared/js/tracking.js"></script>
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .picker-container {
        max-width: 1000px;
        margin: 2rem auto;
        padding: 2rem;
      }
      .back-btn {
        display: inline-block;
        margin-bottom: 1rem;
        padding: 0.5rem 1rem;
        background: white;
        color: #667eea;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .back-btn:hover {
        background: #f8fafc;
      }
      .picker-header {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        margin-bottom: 2rem;
      }
      .picker-header h1 {
        margin: 0 0 0.5rem 0;
        color: #1e293b;
      }
      .picker-header p {
        margin: 0.5rem 0;
        color: #64748b;
        line-height: 1.6;
      }
      .picker-content {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        padding: 2rem;
      }
      .decision-node {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        opacity: 0.4;
        pointer-events: none;
        transition: all 0.3s ease;
        display: none;
      }
      .decision-node.active {
        opacity: 1;
        pointer-events: auto;
        border-color: #3b82f6;
        box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1);
        display: block;
      }
      .node-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }
      .step-number {
        background: #3b82f6;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
      }
      .node-title {
        margin: 0;
        font-size: 1.25rem;
        color: #1e293b;
      }
      .node-help {
        margin-bottom: 1.25rem;
      }
      .node-help details {
        background: #eff6ff;
        border-left: 3px solid #3b82f6;
        padding: 0.75rem 1rem;
        border-radius: 6px;
        cursor: pointer;
      }
      .node-help summary {
        font-weight: 600;
        color: #1e40af;
        list-style: none;
        cursor: pointer;
      }
      .node-help summary::-webkit-details-marker {
        display: none;
      }
      .node-help details[open] summary {
        margin-bottom: 0.75rem;
      }
      .node-help p, .node-help ul {
        color: #475569;
        line-height: 1.6;
      }
      .node-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }
      .decision-btn {
        background: white;
        border: 2px solid #cbd5e1;
        border-radius: 10px;
        padding: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: left;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .decision-btn:hover {
        border-color: #3b82f6;
        box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2);
        transform: translateY(-2px);
      }
      .decision-btn .btn-icon {
        font-size: 2rem;
        display: block;
      }
      .decision-btn .btn-label {
        font-weight: 600;
        color: #1e293b;
        font-size: 1rem;
        display: block;
      }
      .decision-btn .btn-example {
        font-size: 0.85rem;
        color: #64748b;
        display: block;
        line-height: 1.4;
      }
      .path-connector {
        height: 30px;
        width: 3px;
        background: linear-gradient(to bottom, #3b82f6, #e5e7eb);
        margin: 0 auto;
        border-radius: 2px;
      }
      .decision-result {
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        border: 3px solid #3b82f6;
        border-radius: 12px;
        padding: 2rem;
        margin-top: 2rem;
      }
      .result-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }
      .result-icon {
        font-size: 2rem;
      }
      .result-header h3 {
        margin: 0;
        color: #1e40af;
        font-size: 1.5rem;
      }
      .result-recommendation {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #10b981;
      }
      .result-recommendation h4 {
        margin: 0 0 0.75rem 0;
        color: #059669;
        font-size: 1.15rem;
      }
      .result-recommendation p {
        margin: 0.5rem 0;
        line-height: 1.6;
      }
      .result-recommendation .tool-link {
        display: inline-block;
        margin-top: 0.75rem;
        padding: 0.6rem 1.2rem;
        background: #10b981;
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.2s;
      }
      .result-recommendation .tool-link:hover {
        background: #059669;
        transform: translateY(-1px);
      }
      /* Collapsible info sections */
      .info-section {
        margin-top: 1rem;
      }
      .info-section details {
        border-radius: 6px;
        margin-bottom: 0.5rem;
      }
      .info-section summary {
        padding: 0.6rem 1rem;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        border-radius: 6px;
        list-style: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .info-section summary::-webkit-details-marker {
        display: none;
      }
      .info-section summary::before {
        content: "‚ñ∂";
        font-size: 0.7rem;
        transition: transform 0.2s;
      }
      .info-section details[open] summary::before {
        transform: rotate(90deg);
      }
      .info-section .info-content {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
        line-height: 1.6;
        border-top: 1px solid rgba(0,0,0,0.1);
      }
      .info-section .info-content ul {
        margin: 0.5rem 0 0 1.25rem;
        padding: 0;
      }
      .info-section .info-content li {
        margin-bottom: 0.35rem;
      }
      /* Assumptions - blue theme */
      .assumptions-section details {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
      }
      .assumptions-section summary {
        color: #1e40af;
        background: #dbeafe;
      }
      .assumptions-section .info-content {
        color: #1e3a8a;
      }
      /* Common mistakes - amber/orange theme */
      .mistakes-section details {
        background: #fffbeb;
        border: 1px solid #fde68a;
      }
      .mistakes-section summary {
        color: #92400e;
        background: #fef3c7;
      }
      .mistakes-section .info-content {
        color: #78350f;
      }
      /* Alternative approaches section */
      .alternatives-section {
        margin-top: 1.25rem;
        padding-top: 1.25rem;
        border-top: 2px dashed #e5e7eb;
      }
      .alternatives-section h5 {
        margin: 0 0 0.75rem 0;
        color: #6b7280;
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .alt-test {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
      }
      .alt-test-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
      }
      .alt-test-name {
        font-weight: 600;
        color: #374151;
        font-size: 0.95rem;
      }
      .alt-test-link {
        font-size: 0.8rem;
        color: #3b82f6;
        text-decoration: none;
        padding: 0.25rem 0.5rem;
        background: #eff6ff;
        border-radius: 4px;
      }
      .alt-test-link:hover {
        background: #dbeafe;
      }
      .alt-test-link.not-available {
        color: #9ca3af;
        background: #f3f4f6;
        cursor: default;
        font-style: italic;
      }
      .alt-test-desc {
        font-size: 0.85rem;
        color: #6b7280;
        margin-top: 0.35rem;
        line-height: 1.5;
      }
      .result-alternative {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        border-left: 4px solid #f59e0b;
      }
      .result-alternative h4 {
        margin: 0 0 0.75rem 0;
        color: #d97706;
        font-size: 1.05rem;
      }
      .btn-secondary {
        background: #64748b;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 1rem;
      }
      .btn-secondary:hover {
        background: #475569;
      }
      .print-btn {
        padding: 0.75rem 1.5rem;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: all 0.2s;
        margin-bottom: 1.5rem;
        display: inline-block;
      }
      .print-btn:hover {
        background: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      }
      .print-help {
        font-size: 0.85rem;
        color: #6b7280;
        margin-top: 0.5rem;
        display: block;
      }
    </style>
</head>
<body>
    <div class="picker-container">
        <a href="index.html" class="back-btn">‚Üê Back to Home</a>
        
        <div class="picker-header">
            <h1>üí° Interactive Statistical Test Selector</h1>
            <p><strong>Not sure which test to use?</strong> Follow this guided path to find the right statistical tool for your marketing question.</p>
            <p>Each question narrows down your options based on your data structure and research goal.</p>
        </div>

        <div class="picker-content">
            <div style="text-align:center; margin-bottom: 2rem;">
                <button id="print-selector-tree" class="print-btn">
                    üìÑ Print Test Selector Guide (PDF)
                </button>
                <span class="print-help">Download a complete flowchart of all test selection paths as a study guide</span>
            </div>

            <div id="test-helper-tree" style="max-width:900px; margin:0 auto;">
                <!-- Question 1: Outcome Type -->
                <div class="decision-node active" id="node-outcome" data-step="1">
                    <div class="node-header">
                        <span class="step-number">Step 1</span>
                        <h3 class="node-title">What are you measuring? (Your Outcome Variable)</h3>
                    </div>
                    <div class="node-help">
                        <details>
                            <summary>üí° Help me understand "outcome variable"</summary>
                            <p>The <strong>outcome</strong> (also called dependent variable or Y) is what you're trying to predict, explain, or measure. In marketing:</p>
                            <ul style="margin:0.5rem 0 0 1.5rem; font-size:0.9rem;">
                                <li><strong>Numeric:</strong> Revenue, conversion rate (%), time on site, order value, satisfaction score</li>
                                <li><strong>Binary:</strong> Did convert (yes/no), clicked ad (yes/no), churned (yes/no)</li>
                                <li><strong>Categorical:</strong> Product chosen (A/B/C/D), segment membership (high/med/low)</li>
                            </ul>
                        </details>
                    </div>
                    <div class="node-options">
                        <button class="decision-btn" data-choice="numeric" data-next="data-structure">
                            <span class="btn-icon">üìä</span>
                            <span class="btn-label">Numeric / Continuous</span>
                            <span class="btn-example">Revenue, ratings, time, percentages</span>
                        </button>
                        <button class="decision-btn" data-choice="binary" data-next="predictor-count">
                            <span class="btn-icon">‚úì‚úó</span>
                            <span class="btn-label">Binary / Yes-No</span>
                            <span class="btn-example">Converted, clicked, purchased (0 or 1)</span>
                        </button>
                        <button class="decision-btn" data-choice="categorical" data-next="predictor-count">
                            <span class="btn-icon">üè∑Ô∏è</span>
                            <span class="btn-label">Categorical (3+ levels)</span>
                            <span class="btn-example">Product choice, segment, brand selected</span>
                        </button>
                    </div>
                    <div class="path-connector"></div>
                </div>

                <!-- Question 1B: Data Structure (only for numeric outcomes) -->
                <div class="decision-node" id="node-data-structure" data-step="1b">
                    <div class="node-header">
                        <span class="step-number">Step 1b</span>
                        <h3 class="node-title">Is your data time-ordered (sequential)?</h3>
                    </div>
                    <div class="node-help">
                        <details>
                            <summary>üí° Time Series vs. Cross-Sectional Data</summary>
                            <p>This determines whether you need time series methods or standard regression/comparison:</p>
                            <ul style="margin:0.5rem 0 0 1.5rem; font-size:0.9rem;">
                                <li><strong>Time Series:</strong> Observations recorded in sequence over time (daily sales, weekly revenue, monthly KPIs). Past values may influence future values.</li>
                                <li><strong>Cross-Sectional:</strong> Observations from different units at same time (customers, campaigns, products). Order doesn't matter.</li>
                            </ul>
                            <p style="margin-top:0.5rem; font-size:0.9rem;"><em>Key question: Does the ORDER of your observations matter? Would rearranging rows change your analysis?</em></p>
                        </details>
                    </div>
                    <div class="node-options">
                        <button class="decision-btn" data-choice="timeseries" data-next="result">
                            <span class="btn-icon">üìà</span>
                            <span class="btn-label">Yes - Time Series Data</span>
                            <span class="btn-example">Daily/weekly/monthly data in sequence</span>
                        </button>
                        <button class="decision-btn" data-choice="crosssectional" data-next="predictor-count">
                            <span class="btn-icon">üìã</span>
                            <span class="btn-label">No - Cross-Sectional Data</span>
                            <span class="btn-example">Different customers/units, order doesn't matter</span>
                        </button>
                    </div>
                    <div class="path-connector"></div>
                </div>

                <!-- Question 2: Number of Predictors -->
                <div class="decision-node" id="node-predictor-count" data-step="2">
                    <div class="node-header">
                        <span class="step-number">Step 2</span>
                        <h3 class="node-title">How many predictors are you analyzing?</h3>
                    </div>
                    <div class="node-help">
                        <details>
                            <summary>üí° Help me understand "predictors"</summary>
                            <p>A <strong>predictor</strong> (also called independent variable or X) is what you think influences or explains the outcome. Examples:</p>
                            <ul style="margin:0.5rem 0 0 1.5rem; font-size:0.9rem;">
                                <li><strong>One predictor:</strong> "Does ad spend affect revenue?" (X = spend, Y = revenue)</li>
                                <li><strong>Multiple predictors:</strong> "What drives revenue: spend, seasonality, AND campaign type?" (X‚ÇÅ = spend, X‚ÇÇ = season, X‚ÇÉ = campaign)</li>
                            </ul>
                            <p style="margin-top:0.5rem; font-size:0.9rem;"><em>Tip: Start with one predictor to understand the basic relationship, then add more for modeling.</em></p>
                        </details>
                    </div>
                    <div class="node-options">
                        <button class="decision-btn" data-choice="one" data-next="predictor-type">
                            <span class="btn-icon">1Ô∏è‚É£</span>
                            <span class="btn-label">One Main Predictor</span>
                            <span class="btn-example">Testing one factor (e.g., Control vs. Treatment)</span>
                        </button>
                        <button class="decision-btn" data-choice="multiple" data-next="result">
                            <span class="btn-icon">üìà</span>
                            <span class="btn-label">Multiple Predictors</span>
                            <span class="btn-example">Building a model with several factors</span>
                        </button>
                    </div>
                    <div class="path-connector"></div>
                </div>

                <!-- Question 3: Predictor Type (only shows if "one predictor") -->
                <div class="decision-node" id="node-predictor-type" data-step="3">
                    <div class="node-header">
                        <span class="step-number">Step 3</span>
                        <h3 class="node-title">What type of predictor do you have?</h3>
                    </div>
                    <div class="node-help">
                        <details>
                            <summary>üí° Help me choose predictor type</summary>
                            <p>Your predictor's type determines which test you'll use:</p>
                            <ul style="margin:0.5rem 0 0 1.5rem; font-size:0.9rem;">
                                <li><strong>Numeric:</strong> Ad spend ($), days since last purchase, customer age, discount %</li>
                                <li><strong>Binary groups:</strong> Control vs. Treatment, Email A vs. Email B, Before vs. After</li>
                                <li><strong>3+ groups:</strong> Four email designs, three price points, five geographic regions</li>
                            </ul>
                        </details>
                    </div>
                    <div class="node-options">
                        <button class="decision-btn" data-choice="numeric" data-next="result">
                            <span class="btn-icon">üìä</span>
                            <span class="btn-label">Numeric Predictor</span>
                            <span class="btn-example">Spend, time, age, distance, price</span>
                        </button>
                        <button class="decision-btn" data-choice="binary_group" data-next="group-structure">
                            <span class="btn-icon">üîÄ</span>
                            <span class="btn-label">Two Groups</span>
                            <span class="btn-example">Control vs. Treatment, A vs. B</span>
                        </button>
                        <button class="decision-btn" data-choice="categorical3" data-next="result">
                            <span class="btn-icon">üè∑Ô∏è</span>
                            <span class="btn-label">3+ Groups/Categories</span>
                            <span class="btn-example">Four versions, three segments, five regions</span>
                        </button>
                    </div>
                    <div class="path-connector"></div>
                </div>

                <!-- Question 4: Group Structure (only for binary groups) -->
                <div class="decision-node" id="node-group-structure" data-step="4">
                    <div class="node-header">
                        <span class="step-number">Step 4</span>
                        <h3 class="node-title">How is your data structured?</h3>
                    </div>
                    <div class="node-help">
                        <details>
                            <summary>üí° Independent vs. Paired data</summary>
                            <p>This is about whether the same people/accounts appear in both groups:</p>
                            <ul style="margin:0.5rem 0 0 1.5rem; font-size:0.9rem;">
                                <li><strong>Independent:</strong> Different customers in each group. Example: Group A gets Email 1, Group B gets Email 2 (different people)</li>
                                <li><strong>Paired/Matched:</strong> Same customers measured twice. Example: Same customers see Offer A then Offer B, or before/after campaign</li>
                            </ul>
                            <p style="margin-top:0.5rem; font-size:0.9rem;"><em>Key question: Can you draw a line connecting each observation in Group 1 to a specific paired observation in Group 2?</em></p>
                        </details>
                    </div>
                    <div class="node-options">
                        <button class="decision-btn" data-choice="two_ind" data-next="result">
                            <span class="btn-icon">üë•</span>
                            <span class="btn-label">Independent Groups</span>
                            <span class="btn-example">Different customers in each group</span>
                        </button>
                        <button class="decision-btn" data-choice="two_paired" data-next="result">
                            <span class="btn-icon">üîó</span>
                            <span class="btn-label">Paired/Matched Groups</span>
                            <span class="btn-example">Same customers measured twice (before/after)</span>
                        </button>
                    </div>
                    <div class="path-connector"></div>
                </div>

                <!-- Result Area -->
                <div class="decision-result" id="decision-result" style="display:none;">
                    <div class="result-header">
                        <span class="result-icon">‚ú®</span>
                        <h3>Recommended Statistical Test</h3>
                    </div>
                    <div id="result-content"></div>
                    <button type="button" class="btn-secondary" id="reset-helper">‚Ü∫ Start Over</button>
                </div>
            </div>
        </div>
    </div>

    <script src="shared/js/auth_tracking.js"></script>
    <script>
        // Decision Tree Logic
        (function () {
            const decisionState = {
                outcome: null,
                dataStructure: null,
                predictorCount: null,
                predictorType: null,
                groupStructure: null
            };

            // Add event listeners to all decision buttons
            document.querySelectorAll('.decision-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const choice = this.dataset.choice;
                    let nextNode = this.dataset.next;
                    const currentNode = this.closest('.decision-node');
                    
                    // Store the choice based on current step
                    const step = currentNode.dataset.step;
                    if (step === '1') {
                        decisionState.outcome = choice;
                    } else if (step === '1b') {
                        decisionState.dataStructure = choice;
                    } else if (step === '2') {
                        decisionState.predictorCount = choice;
                        // Smart routing based on outcome type
                        if (choice === 'one') {
                            if (decisionState.outcome === 'numeric') {
                                nextNode = 'predictor-type'; // Numeric outcomes need predictor type
                            } else if (decisionState.outcome === 'binary') {
                                nextNode = 'group-structure'; // Binary outcomes go to paired vs independent
                            } else if (decisionState.outcome === 'categorical') {
                                nextNode = 'result'; // Categorical with one predictor = chi-square
                            }
                        }
                    } else if (step === '3') {
                        decisionState.predictorType = choice;
                    } else if (step === '4') {
                        decisionState.groupStructure = choice;
                    }

                    // Deactivate current node
                    currentNode.classList.remove('active');

                    // Show result or next node
                    if (nextNode === 'result') {
                        showResult();
                    } else {
                        const nextElement = document.getElementById('node-' + nextNode);
                        if (nextElement) {
                            nextElement.classList.add('active');
                            nextElement.style.display = 'block';
                            nextElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                    }
                });
            });

            // Reset button
            document.getElementById('reset-helper')?.addEventListener('click', function() {
                decisionState.outcome = null;
                decisionState.dataStructure = null;
                decisionState.predictorCount = null;
                decisionState.predictorType = null;
                decisionState.groupStructure = null;
                
                document.querySelectorAll('.decision-node').forEach(node => {
                    node.classList.remove('active');
                    if (node.id !== 'node-outcome') {
                        node.style.display = 'none';
                    }
                });
                document.getElementById('node-outcome').classList.add('active');
                document.getElementById('decision-result').style.display = 'none';
                document.getElementById('node-outcome').scrollIntoView({ behavior: 'smooth', block: 'center' });
            });

            function showResult() {
                const resultDiv = document.getElementById('decision-result');
                const contentDiv = document.getElementById('result-content');
                
                let recommendation = getRecommendation();
                contentDiv.innerHTML = recommendation;
                resultDiv.style.display = 'block';
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            function getRecommendation() {
                const { outcome, dataStructure, predictorCount, predictorType, groupStructure } = decisionState;
                let html = '';

                // Helper function to build recommendation HTML
                function buildRecommendation(config) {
                    let result = `
                        <div class="result-recommendation">
                            <h4>‚úÖ Recommended: ${config.testName}</h4>
                            <p><strong>Marketing Context:</strong> ${config.context}</p>
                            ${config.toolUrl ? 
                                `<a href="${config.toolUrl}" class="tool-link">Open ${config.testName} Tool ‚Üí</a>` : 
                                `<span style="display:inline-block; margin-top:0.75rem; padding:0.6rem 1.2rem; background:#9ca3af; color:white; border-radius:6px; font-weight:600;">Tool Coming Soon</span>`
                            }
                            
                            <div class="info-section assumptions-section">
                                <details>
                                    <summary>üìã Assumptions to Check</summary>
                                    <div class="info-content">
                                        <ul>${config.assumptions.map(a => `<li>${a}</li>`).join('')}</ul>
                                    </div>
                                </details>
                            </div>
                            
                            ${config.mistakes && config.mistakes.length > 0 ? `
                            <div class="info-section mistakes-section">
                                <details>
                                    <summary>‚ö†Ô∏è Common Mistakes to Avoid</summary>
                                    <div class="info-content">
                                        <ul>${config.mistakes.map(m => `<li>${m}</li>`).join('')}</ul>
                                    </div>
                                </details>
                            </div>` : ''}
                        </div>`;
                    
                    // Add alternatives section if provided
                    if (config.alternatives && config.alternatives.length > 0) {
                        result += `
                        <div class="alternatives-section">
                            <h5>üìä Alternative Approaches</h5>
                            ${config.alternatives.map(alt => `
                                <div class="alt-test">
                                    <div class="alt-test-header">
                                        <span class="alt-test-name">${alt.name}</span>
                                        ${alt.url ? 
                                            `<a href="${alt.url}" class="alt-test-link">Open Tool ‚Üí</a>` :
                                            `<span class="alt-test-link not-available">Not yet available</span>`
                                        }
                                    </div>
                                    <div class="alt-test-desc">${alt.reason}</div>
                                </div>
                            `).join('')}
                        </div>`;
                    }
                    
                    return result;
                }

                // ============================================
                // TIME SERIES PATH (for numeric outcomes)
                // ============================================
                if (outcome === 'numeric' && dataStructure === 'timeseries') {
                    return buildRecommendation({
                        testName: 'ARIMAX Time Series Forecasting',
                        context: 'Analyzing sequential data over time with potential external factors. Perfect for forecasting sales with ad spend, predicting demand with promotional indicators, or any time-ordered metric.',
                        toolUrl: 'apps/time_series/arimax/main_arimax.html',
                        assumptions: [
                            '<strong>Stationarity:</strong> The data should be stationary (constant mean and variance over time). Use differencing if needed.',
                            '<strong>No autocorrelation in residuals:</strong> Check with ACF/PACF plots after fitting the model.',
                            '<strong>Normally distributed residuals:</strong> Residuals should be roughly normally distributed.',
                            '<strong>Sufficient data points:</strong> Generally need 50+ observations for reliable time series analysis.'
                        ],
                        mistakes: [
                            'Using cross-sectional methods (like t-tests or regression) on time series data‚Äîthis ignores autocorrelation.',
                            'Forecasting too far ahead without acknowledging increasing uncertainty.',
                            'Ignoring seasonality patterns in the data.'
                        ]
                    });
                }

                // ============================================
                // NUMERIC OUTCOME (cross-sectional)
                // ============================================
                if (outcome === 'numeric') {
                    // One predictor - Numeric predictor
                    if (predictorCount === 'one' && predictorType === 'numeric') {
                        return buildRecommendation({
                            testName: 'Pearson Correlation',
                            context: 'Exploring whether two numeric metrics move together (e.g., "As ad spend increases, does revenue increase?").',
                            toolUrl: 'apps/descriptive/pearson_correlation/main_pearson.html',
                            assumptions: [
                                '<strong>Linear relationship:</strong> The relationship between variables should be roughly linear (check a scatterplot).',
                                '<strong>Both variables continuous:</strong> Pearson works best with truly continuous numeric data.',
                                '<strong>No extreme outliers:</strong> Outliers can heavily distort correlation coefficients.',
                                '<strong>Bivariate normality:</strong> For hypothesis testing, both variables should be approximately normally distributed.'
                            ],
                            mistakes: [
                                'Assuming correlation means causation‚Äîit only measures association, not cause-and-effect.',
                                'Ignoring outliers that can artificially inflate or deflate the correlation.',
                                'Using Pearson on clearly non-linear relationships (use Spearman instead for ranked/monotonic relationships).'
                            ],
                            alternatives: [
                                {
                                    name: 'Bivariate Linear Regression',
                                    url: 'apps/regression/bivariate_regression/main_bivariate_regression.html',
                                    reason: 'Same underlying relationship, but gives you a prediction equation (Y = a + bX) and allows you to predict Y for new values of X.'
                                }
                            ]
                        });
                    }
                    
                    // One predictor - Two groups, Paired
                    if (predictorCount === 'one' && predictorType === 'binary_group' && groupStructure === 'two_paired') {
                        return buildRecommendation({
                            testName: 'Paired Sample t-test',
                            context: 'The same customers/accounts are measured twice (e.g., "Did customer satisfaction improve after our website redesign?" measured on the same customers before and after).',
                            toolUrl: 'apps/hypothesis_testing/paired_ttest/main_paired_ttest.html',
                            assumptions: [
                                '<strong>Paired observations:</strong> Each observation in one group has a matched pair in the other group (same person, same account, etc.).',
                                '<strong>Differences are approximately normal:</strong> The differences between pairs should be roughly normally distributed (less critical with n > 30).',
                                '<strong>Continuous outcome:</strong> The dependent variable should be measured on an interval or ratio scale.',
                                '<strong>No extreme outlier differences:</strong> Extreme differences between pairs can skew results.'
                            ],
                            mistakes: [
                                'Using an independent t-test when you actually have paired data‚Äîthis throws away the power of the paired design.',
                                'Forgetting to calculate and analyze the DIFFERENCES between pairs (the test is based on differences, not raw scores).',
                                'Having unpaired observations mixed in with paired data.'
                            ],
                            alternatives: [
                                {
                                    name: 'Wilcoxon Signed-Rank Test',
                                    url: null,
                                    reason: 'Non-parametric alternative when the differences are not normally distributed. Uses ranks instead of raw values.'
                                }
                            ]
                        });
                    }
                    
                    // One predictor - Two groups, Independent
                    if (predictorCount === 'one' && predictorType === 'binary_group' && groupStructure === 'two_ind') {
                        return buildRecommendation({
                            testName: "Welch's t-test (Independent Samples)",
                            context: 'Comparing averages between two independent groups (e.g., "Did Email A generate higher revenue per customer than Email B?" where different customers received each email).',
                            toolUrl: 'apps/hypothesis_testing/ind_ttest/main_ind_ttest.html',
                            assumptions: [
                                '<strong>Independence:</strong> Observations in each group are independent of each other (different people/accounts).',
                                '<strong>Approximately normal distributions:</strong> Each group should be roughly normally distributed (less critical with n > 30 per group).',
                                '<strong>Continuous outcome:</strong> The dependent variable should be measured on an interval or ratio scale.',
                                '<strong>No extreme outliers:</strong> Outliers can distort the group means and inflate variance.'
                            ],
                            mistakes: [
                                'Using an independent t-test when you have paired/matched data‚Äîyou should use a paired t-test instead.',
                                'Comparing more than 2 groups with multiple t-tests instead of using ANOVA (inflates Type I error).',
                                'Ignoring highly skewed distributions or outliers that violate assumptions.'
                            ],
                            alternatives: [
                                {
                                    name: 'Mann-Whitney U Test',
                                    url: null,
                                    reason: 'Non-parametric alternative when data is heavily skewed or ordinal. Compares medians/ranks rather than means.'
                                }
                            ]
                        });
                    }
                    
                    // One predictor - 3+ groups
                    if (predictorCount === 'one' && predictorType === 'categorical3') {
                        return buildRecommendation({
                            testName: 'One-Way ANOVA',
                            context: 'Comparing means across three or more groups (e.g., "Which of our four landing page designs generates highest revenue per visitor?").',
                            toolUrl: 'apps/hypothesis_testing/onewayanova/main_onewayanova.html',
                            assumptions: [
                                '<strong>Independence:</strong> Observations are independent within and across groups.',
                                '<strong>Normality:</strong> Each group should be approximately normally distributed (less critical with larger samples).',
                                '<strong>Homogeneity of variance:</strong> Variances should be roughly equal across groups (check with Levene\'s test).',
                                '<strong>Continuous outcome:</strong> The dependent variable should be measured on an interval or ratio scale.'
                            ],
                            mistakes: [
                                'Running multiple t-tests instead of ANOVA‚Äîthis inflates your false positive rate.',
                                'Stopping at the overall F-test. ANOVA tells you IF groups differ, but you need post-hoc tests to see WHICH pairs differ.',
                                'Ignoring unequal group sizes, which can affect the robustness of the test.'
                            ],
                            alternatives: [
                                {
                                    name: 'Kruskal-Wallis Test',
                                    url: null,
                                    reason: 'Non-parametric alternative when normality assumption is violated. Compares medians across groups using ranks.'
                                }
                            ]
                        });
                    }
                    
                    // Multiple predictors - Numeric outcome
                    if (predictorCount === 'multiple') {
                        return buildRecommendation({
                            testName: 'Multiple Linear Regression',
                            context: 'Modeling a numeric outcome with multiple predictors simultaneously (e.g., "Customer lifetime value based on recency, frequency, monetary value, AND customer segment").',
                            toolUrl: 'apps/regression/ml_regression/ml_regression.html',
                            assumptions: [
                                '<strong>Linearity:</strong> The relationship between each predictor and the outcome is linear.',
                                '<strong>Independence of errors:</strong> Residuals are independent of each other.',
                                '<strong>Homoscedasticity:</strong> Residuals have constant variance across all levels of predictors.',
                                '<strong>Normality of residuals:</strong> Residuals are approximately normally distributed.',
                                '<strong>No multicollinearity:</strong> Predictors should not be too highly correlated with each other (check VIF).'
                            ],
                            mistakes: [
                                'Including highly correlated predictors (multicollinearity) which makes individual coefficients unreliable.',
                                'Assuming the model is causal when it may only show correlations.',
                                'Overfitting by including too many predictors relative to sample size (rule of thumb: ~15-20 observations per predictor).'
                            ],
                            alternatives: [
                                {
                                    name: 'Multiple Regression with Interactions',
                                    url: 'apps/regression/mlr_interactions/main_mlr_interactions.html',
                                    reason: 'When you believe the effect of one predictor depends on the level of another predictor (e.g., "ad spend effect differs by channel").'
                                }
                            ]
                        });
                    }
                }

                // ============================================
                // BINARY OUTCOME
                // ============================================
                if (outcome === 'binary') {
                    // One predictor - need to check group structure
                    if (predictorCount === 'one') {
                        // Paired binary data
                        if (groupStructure === 'two_paired') {
                            return buildRecommendation({
                                testName: 'McNemar Test',
                                context: 'Paired yes/no data (e.g., "Did customers change their subscription status after seeing our new offer?" measured on same customers before and after).',
                                toolUrl: 'apps/hypothesis_testing/mcnemar/main_mcnemar.html',
                                assumptions: [
                                    '<strong>Paired/matched data:</strong> Each subject is measured twice (before/after) or subjects are matched in pairs.',
                                    '<strong>Binary outcome:</strong> The outcome at each time point must be dichotomous (yes/no, 0/1).',
                                    '<strong>Independence of pairs:</strong> Each pair is independent of other pairs.',
                                    '<strong>Sufficient discordant pairs:</strong> Need enough "switchers" (yes‚Üíno or no‚Üíyes) for reliable results.'
                                ],
                                mistakes: [
                                    'Using a chi-square test when you have paired data‚Äîchi-square assumes independence.',
                                    'Focusing on concordant pairs (stayed yes or stayed no) when McNemar is really about the changers.',
                                    'Having very few discordant pairs, which makes the test unreliable.'
                                ]
                            });
                        }
                        
                        // Independent binary data (A/B test)
                        return buildRecommendation({
                            testName: 'A/B Proportion Test (Two-Sample z-test for Proportions)',
                            context: 'Comparing conversion rates between two independent groups (e.g., "Did landing page A have a higher conversion rate than landing page B?").',
                            toolUrl: 'apps/hypothesis_testing/ab_proportion/main_ab_proportion.html',
                            assumptions: [
                                '<strong>Independence:</strong> Observations in each group are independent (different people).',
                                '<strong>Random sampling:</strong> Subjects are randomly assigned to each group.',
                                '<strong>Binary outcome:</strong> The outcome is dichotomous (converted/not converted, clicked/not clicked).',
                                '<strong>Sufficient sample size:</strong> Each group should have at least 10 successes and 10 failures (np ‚â• 10 and n(1-p) ‚â• 10).'
                            ],
                            mistakes: [
                                'Stopping the test too early ("peeking") which inflates false positive rates.',
                                'Not accounting for multiple testing if comparing many variants.',
                                'Ignoring the practical significance‚Äîa statistically significant difference may be too small to matter.'
                            ],
                            alternatives: [
                                {
                                    name: 'Chi-Square Test of Independence',
                                    url: 'apps/hypothesis_testing/chisquare/main_chisquare.html',
                                    reason: 'Mathematically equivalent for 2√ó2 tables. Chi-square is more general and extends to comparing 3+ groups or multi-level outcomes.'
                                },
                                {
                                    name: 'Logistic Regression (single predictor)',
                                    url: 'apps/regression/log_regression/log_regression.html',
                                    reason: 'Gives you an odds ratio and a model framework. Useful if you plan to add more predictors later.'
                                }
                            ]
                        });
                    }
                    
                    // Multiple predictors - Binary outcome
                    if (predictorCount === 'multiple') {
                        return buildRecommendation({
                            testName: 'Logistic Regression',
                            context: 'Predicting a yes/no outcome with multiple predictors (e.g., "What predicts conversion: traffic source, device type, AND time of day?").',
                            toolUrl: 'apps/regression/log_regression/log_regression.html',
                            assumptions: [
                                '<strong>Binary outcome:</strong> The dependent variable must be dichotomous.',
                                '<strong>Independence of observations:</strong> Each observation is independent.',
                                '<strong>No multicollinearity:</strong> Predictors should not be highly correlated with each other.',
                                '<strong>Linearity in the logit:</strong> Continuous predictors have a linear relationship with the log-odds of the outcome.',
                                '<strong>Sufficient sample size:</strong> Rule of thumb: at least 10 events per predictor variable.'
                            ],
                            mistakes: [
                                'Interpreting coefficients as probabilities‚Äîthey are log-odds. Convert to odds ratios with exp(coefficient).',
                                'Having too few events (conversions) relative to the number of predictors.',
                                'Ignoring class imbalance when one outcome is much rarer than the other.'
                            ]
                        });
                    }
                }

                // ============================================
                // CATEGORICAL OUTCOME (3+ levels)
                // ============================================
                if (outcome === 'categorical') {
                    // One predictor
                    if (predictorCount === 'one') {
                        return buildRecommendation({
                            testName: 'Chi-Square Test of Association',
                            context: 'Exploring whether two categorical variables are related (e.g., "Does product choice vary by customer segment?" or "Is device type related to purchase category?").',
                            toolUrl: 'apps/hypothesis_testing/chisquare/main_chisquare.html',
                            assumptions: [
                                '<strong>Independence:</strong> Each observation belongs to only one cell in the contingency table.',
                                '<strong>Random sampling:</strong> Data comes from a random sample.',
                                '<strong>Expected frequencies ‚â• 5:</strong> At least 80% of cells should have expected counts of 5 or more.',
                                '<strong>Sufficient sample size:</strong> Very small samples can make the test unreliable.'
                            ],
                            mistakes: [
                                'Using chi-square on paired/matched data‚Äîuse McNemar test instead.',
                                'Having too many cells with small expected frequencies (combine categories or collect more data).',
                                'Confusing chi-square test of independence with chi-square goodness-of-fit test (different purposes).'
                            ],
                            alternatives: [
                                {
                                    name: "Fisher's Exact Test",
                                    url: null,
                                    reason: 'Use when sample sizes are very small or expected cell counts fall below 5. Gives exact p-values rather than approximations.'
                                }
                            ]
                        });
                    }
                    
                    // Multiple predictors
                    if (predictorCount === 'multiple') {
                        return buildRecommendation({
                            testName: 'Multinomial Logistic Regression',
                            context: 'Predicting a categorical outcome with 3+ levels using multiple predictors (e.g., "What predicts which product a customer chooses: price sensitivity, brand loyalty, AND demographics?").',
                            toolUrl: 'apps/regression/mn_log_regression/main_mn_log_regression.html',
                            assumptions: [
                                '<strong>Nominal outcome:</strong> The outcome categories have no inherent order (use ordinal regression if ordered).',
                                '<strong>Independence of observations:</strong> Each observation is independent.',
                                '<strong>No multicollinearity:</strong> Predictors should not be highly correlated.',
                                '<strong>Independence of Irrelevant Alternatives (IIA):</strong> The odds of choosing A over B shouldn\'t change if option C is added or removed.',
                                '<strong>Sufficient sample size:</strong> Need adequate observations for each outcome category.'
                            ],
                            mistakes: [
                                'Running separate binary logistic regressions for each category instead of multinomial (loses efficiency and violates assumptions).',
                                'Ignoring the reference category‚Äîall results are interpreted RELATIVE to one baseline category.',
                                'Using multinomial for ordinal outcomes when ordinal logistic regression would be more appropriate.'
                            ]
                        });
                    }
                }

                return '<p>Unable to determine recommendation. Please try again by clicking "Start Over" below.</p>';
            }
        }());
        
        // PDF Generation
        document.addEventListener('DOMContentLoaded', function() {
            const pdfButton = document.getElementById('print-selector-tree');
            if (pdfButton) {
                pdfButton.addEventListener('click', function() {
                    const printWindow = window.open('', '_blank');
                    if (!printWindow) {
                        alert('Please allow pop-ups for this site to generate the PDF.');
                        return;
                    }
                    const htmlContent = generatePDFContent();
                    printWindow.document.write(htmlContent);
                    printWindow.document.close();
                });
            }
        });
        
        function generatePDFContent() {
            return `<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Statistical Test Selection Decision Tree</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; color: #1f2937; max-width: 1000px; margin: 0 auto; padding: 2rem; background: white; }
    .flowchart-title { text-align: center; color: #1e40af; margin-bottom: 0.5rem; font-size: 2rem; font-weight: 700; }
    .flowchart-subtitle { text-align: center; color: #6b7280; margin-bottom: 2rem; font-size: 1rem; }
    .flow-level { margin-bottom: 3rem; page-break-inside: avoid; }
    .flow-level-title { background: #3b82f6; color: white; padding: 0.5rem 1rem; border-radius: 8px; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
    .flow-branches { margin-left: 2rem; }
    .flow-branch { border-left: 3px solid #3b82f6; padding-left: 1.5rem; margin-bottom: 2rem; page-break-inside: avoid; }
    .branch-choice { background: #eff6ff; border: 2px solid #3b82f6; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .branch-choice-title { font-weight: 600; color: #1e40af; margin-bottom: 0.25rem; font-size: 1.05rem; }
    .branch-choice-desc { font-size: 0.9rem; color: #4b5563; }
    .flow-result { background: #d1fae5; border: 2px solid #10b981; border-radius: 8px; padding: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
    .flow-result-title { font-weight: 700; color: #065f46; margin-bottom: 0.5rem; font-size: 1.05rem; }
    .flow-result-desc { font-size: 0.9rem; color: #047857; margin-bottom: 0.5rem; }
    .flow-result-tool { font-size: 0.85rem; color: #065f46; font-weight: 600; }
    .flow-result-alt { font-size: 0.8rem; color: #6b7280; margin-top: 0.5rem; font-style: italic; }
    .nested-branch { margin-left: 1.5rem; margin-top: 1rem; border-left: 3px solid #8b5cf6; padding-left: 1rem; }
    .nested-choice { background: #f5f3ff; border: 2px solid #8b5cf6; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.75rem; }
    .nested-choice-title { font-weight: 600; color: #5b21b6; margin-bottom: 0.25rem; }
    .sub-result { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 6px; padding: 0.75rem; margin: 0.5rem 0 0.5rem 1rem; }
    .sub-result-title { font-weight: 600; color: #92400e; }
    .sub-result-desc { font-size: 0.85rem; color: #78350f; margin-top: 0.25rem; }
    .sub-result-tool { font-size: 0.8rem; font-weight: 600; color: #92400e; margin-top: 0.25rem; }
    .assumptions-table { width: 100%; border-collapse: collapse; margin-top: 2rem; font-size: 0.85rem; }
    .assumptions-table th { background: #1e40af; color: white; padding: 0.75rem; text-align: left; }
    .assumptions-table td { padding: 0.6rem; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
    .assumptions-table tr:nth-child(even) { background: #f9fafb; }
    .assumptions-table .test-name { font-weight: 600; color: #1e40af; }
    @media print { body { padding: 1rem; } .flow-level, .flow-branch { page-break-inside: avoid; } }
  </style>
</head>
<body>
  <h1 class="flowchart-title">üìä Statistical Test Selection Guide</h1>
  <p class="flowchart-subtitle">Complete Decision Tree for Marketing Analytics</p>
  
  <div class="flow-level">
    <div class="flow-level-title">Step 1: Outcome Variable Type</div>
    <div class="flow-branches">
      <div class="flow-branch">
        <div class="branch-choice"><div class="branch-choice-title">üìä Numeric/Continuous Outcome</div><div class="branch-choice-desc">Examples: Revenue, conversion rate (%), satisfaction score, time on site</div></div>
        <div class="flow-level-title" style="background:#10b981; font-size:1rem;">Step 1b: Data Structure</div>
        <div class="nested-branch" style="border-left-color:#10b981;">
          <div class="nested-choice" style="background:#d1fae5; border-color:#10b981;"><div class="nested-choice-title" style="color:#065f46;">üìà Time Series Data (Sequential)</div><div style="font-size:0.85rem; color:#047857;">Daily/weekly/monthly data where ORDER matters</div></div>
          <div class="flow-result"><div class="flow-result-title">‚úÖ ARIMAX Time Series Forecasting</div><div class="flow-result-desc">Analyzing sequential data over time with external factors</div><div class="flow-result-tool">Tool: ARIMAX</div></div>
        </div>
        <div class="nested-branch" style="margin-top:1.5rem; border-left-color:#10b981;">
          <div class="nested-choice" style="background:#d1fae5; border-color:#10b981;"><div class="nested-choice-title" style="color:#065f46;">üìã Cross-Sectional Data</div><div style="font-size:0.85rem; color:#047857;">Different customers/units, order doesn't matter</div></div>
          <div class="flow-level-title" style="background:#8b5cf6; font-size:1rem;">Step 2: Number of Predictors</div>
          <div class="nested-branch">
            <div class="nested-choice"><div class="nested-choice-title">One Predictor</div></div>
            <div style="margin-left:1rem;">
              <div class="flow-level-title" style="background:#ec4899; font-size:0.95rem;">Step 3: Predictor Type</div>
              <div class="flow-result"><div class="flow-result-title">Numeric Predictor ‚Üí Pearson Correlation</div><div class="flow-result-desc">Both outcome and predictor are numeric</div><div class="flow-result-alt">Alt: Bivariate Regression (for prediction equation)</div></div>
              <div class="flow-result"><div class="flow-result-title">Binary Group Predictor</div>
                <div class="sub-result"><div class="sub-result-title">Independent Groups ‚Üí Welch's t-test</div><div class="sub-result-desc">Different people in each group</div></div>
                <div class="sub-result"><div class="sub-result-title">Paired Groups ‚Üí Paired t-test</div><div class="sub-result-desc">Same people measured twice</div></div>
              </div>
              <div class="flow-result"><div class="flow-result-title">Categorical Predictor (3+ levels) ‚Üí One-Way ANOVA</div><div class="flow-result-desc">Comparing means across 3+ groups</div></div>
            </div>
          </div>
          <div class="nested-branch" style="margin-top:1.5rem;">
            <div class="nested-choice"><div class="nested-choice-title">Multiple Predictors</div></div>
            <div class="flow-result"><div class="flow-result-title">‚úÖ Multiple Linear Regression</div><div class="flow-result-desc">Modeling numeric outcome with multiple predictors</div><div class="flow-result-alt">Alt: MLR with Interactions (if effects depend on each other)</div></div>
          </div>
        </div>
      </div>
      
      <div class="flow-branch">
        <div class="branch-choice"><div class="branch-choice-title">‚úì‚úó Binary Outcome</div><div class="branch-choice-desc">Examples: Converted (yes/no), clicked ad (yes/no), churned (yes/no)</div></div>
        <div class="flow-level-title" style="background:#8b5cf6; font-size:1rem;">Step 2: Number of Predictors</div>
        <div class="nested-branch">
          <div class="nested-choice"><div class="nested-choice-title">One Predictor</div></div>
          <div style="margin-left:1rem;">
            <div class="sub-result"><div class="sub-result-title">Independent Groups ‚Üí A/B Proportion Test</div><div class="sub-result-desc">Comparing conversion rates between groups</div><div style="font-size:0.75rem; color:#6b7280; margin-top:0.25rem;">Alt: Chi-Square, Logistic Regression</div></div>
            <div class="sub-result"><div class="sub-result-title">Paired Groups ‚Üí McNemar Test</div><div class="sub-result-desc">Same people measured twice (before/after)</div></div>
          </div>
        </div>
        <div class="nested-branch" style="margin-top:1.5rem;">
          <div class="nested-choice"><div class="nested-choice-title">Multiple Predictors</div></div>
          <div class="flow-result"><div class="flow-result-title">‚úÖ Logistic Regression</div><div class="flow-result-desc">Predicting yes/no outcome with multiple factors</div></div>
        </div>
      </div>
      
      <div class="flow-branch">
        <div class="branch-choice"><div class="branch-choice-title">üè∑Ô∏è Categorical Outcome (3+ levels)</div><div class="branch-choice-desc">Examples: Product chosen (A/B/C/D), customer segment (high/med/low)</div></div>
        <div class="flow-level-title" style="background:#8b5cf6; font-size:1rem;">Step 2: Number of Predictors</div>
        <div class="nested-branch">
          <div class="nested-choice"><div class="nested-choice-title">One Predictor</div></div>
          <div class="flow-result"><div class="flow-result-title">‚úÖ Chi-square Test of Association</div><div class="flow-result-desc">Testing if two categorical variables are related</div></div>
        </div>
        <div class="nested-branch" style="margin-top:1rem;">
          <div class="nested-choice"><div class="nested-choice-title">Multiple Predictors</div></div>
          <div class="flow-result"><div class="flow-result-title">‚úÖ Multinomial Logistic Regression</div><div class="flow-result-desc">Predicting categorical outcome with 3+ levels</div></div>
        </div>
      </div>
    </div>
  </div>

  <div style="page-break-before: always;"></div>
  
  <h2 style="color:#1e40af; margin-top:2rem;">üìã Key Assumptions Quick Reference</h2>
  <table class="assumptions-table">
    <tr><th>Test</th><th>Key Assumptions</th><th>Common Mistake</th></tr>
    <tr><td class="test-name">Pearson Correlation</td><td>Linear relationship, continuous variables, no extreme outliers</td><td>Assuming correlation = causation</td></tr>
    <tr><td class="test-name">Independent t-test</td><td>Independence, approximately normal distributions, continuous outcome</td><td>Using when data is actually paired</td></tr>
    <tr><td class="test-name">Paired t-test</td><td>Matched pairs, differences are ~normal, continuous outcome</td><td>Using independent t-test instead</td></tr>
    <tr><td class="test-name">One-Way ANOVA</td><td>Independence, normality, homogeneity of variance</td><td>Running multiple t-tests instead</td></tr>
    <tr><td class="test-name">A/B Proportion Test</td><td>Independence, random assignment, sufficient sample (np ‚â• 10)</td><td>Stopping the test too early ("peeking")</td></tr>
    <tr><td class="test-name">McNemar Test</td><td>Paired/matched data, binary outcome, independent pairs</td><td>Using chi-square on paired data</td></tr>
    <tr><td class="test-name">Chi-Square Test</td><td>Independence, expected frequencies ‚â• 5 in most cells</td><td>Too many cells with small expected counts</td></tr>
    <tr><td class="test-name">Multiple Regression</td><td>Linearity, independence of errors, homoscedasticity, no multicollinearity</td><td>Including highly correlated predictors</td></tr>
    <tr><td class="test-name">Logistic Regression</td><td>Binary outcome, independence, no multicollinearity</td><td>Interpreting coefficients as probabilities</td></tr>
    <tr><td class="test-name">Multinomial Logistic</td><td>Nominal outcome, independence, no multicollinearity</td><td>Ignoring the reference category</td></tr>
  </table>

  <div style="margin-top:3rem; padding:1.5rem; background:#f3f4f6; border-radius:8px; border-left:4px solid #3b82f6;">
    <h3 style="color:#1e40af; margin-top:0;">üí° Quick Reference Tips</h3>
    <ul style="color:#4b5563; line-height:1.8;">
      <li><strong>Time Series vs. Cross-Sectional:</strong> Does the ORDER matter? Time points in sequence ‚Üí Time Series. Different people/units ‚Üí Cross-Sectional.</li>
      <li><strong>Independent vs. Paired:</strong> Can you connect each observation in Group 1 to a specific match in Group 2? Yes ‚Üí Paired. No ‚Üí Independent.</li>
      <li><strong>Predictor = X (Independent Variable):</strong> What influences the outcome (ad spend, email version, segment).</li>
      <li><strong>Outcome = Y (Dependent Variable):</strong> What you're measuring (revenue, conversion, satisfaction).</li>
      <li><strong>Always Check Assumptions:</strong> Each test has requirements. Violating them can lead to misleading conclusions.</li>
    </ul>
  </div>
  
  <div style="text-align:center; margin-top:2rem; color:#9ca3af; font-size:0.85rem;">
    <p>Statistical Test Selection Guide ‚Ä¢ Dr. Baker's Marketing Analytics Tools</p>
    <p>Generated: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
  </div>
  <scr` + `ipt>window.onload = function() { setTimeout(function() { window.print(); }, 500); };</scr` + `ipt>
</body>
</html>`;
        }
    </script>
</body>
</html>
