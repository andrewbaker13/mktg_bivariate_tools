<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>McNemar Test Explorer</title>
  <link rel="stylesheet" href="../../../shared/css/main.css">
    <script src="../../../shared/js/tracking.js"></script>
  <link rel="stylesheet" href="../../../shared/css/auth_bar.css">
  <link rel="stylesheet" href="main_mcnemar.css">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-290ZJ9RE04"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-290ZJ9RE04');
    </script>
</head>
<body>
  <div class="auth-bar">
    <div class="auth-bar__container">
      <div></div>
      <div id="auth-bar-content" class="auth-bar__links">
        <a href="../../../admin_pages/login.html">Login</a>
        <a href="../../../admin_pages/register.html">Create Account</a>
      </div>
    </div>
  </div>
  <header class="intro hero-header">
    <div class="hero-header__top">
      <h1>McNemar Test Explorer</h1>
      <div class="hero-context">
        <span class="badge">Matched test</span>
        <label class="professor-mode-toggle">
          <input type="checkbox" id="professorMode">
          <span class="toggle-label">üéì Professor Mode</span>
        </label>
      </div>
    </div>
    <p class="hero-header__lede">Investigate matched, binary outcomes with contingency visuals, effect-size diagnostics, and ready-to-share reporting.</p>
  </header>

  <main class="app-main">
    <section class="test-overview" id="tut-overview-section">
      <h2>TEST OVERVIEW &amp; EQUATIONS</h2>
      <div class="card equation-section">
        <p>McNemars test spotlights the switcherspairs where the two conditions disagree. Only those one-sided wins inform the hypothesis test.</p>
        <div class="equation-display">
          \[
          \begin{aligned}
          \chi^2_{\text{McNemar}} &= \frac{(b - c)^2}{b + c} \\
          \chi^2_{\text{Corrected}} &= \frac{(|b - c| - 1)^2}{b + c} \\
          p_{\text{exact}} &= 2 \times \min \Bigg( \sum_{i=0}^{b} \binom{b + c}{i} 0.5^{b + c},\; \sum_{i=0}^{c} \binom{b + c}{i} 0.5^{b + c} \Bigg)
          \end{aligned}
          \]
        </div>
        <div class="equation-definitions">
          <p><strong>Where:</strong></p>
          <ul>
            <li>\(b\) counts people who only converted under Condition A, \(c\) only under Condition B.</li>
            <li>Continuity-corrected \(\chi^2\) keeps Type I error in check when switchers are scarce; the exact approach doubles the smaller binomial tail.</li>
            <li>If one-sided wins favor a condition more than chance allows, we reject equal success probabilities.</li>
          </ul>
        </div>
        <details class="additional-notes">
          <summary>Additional Notes</summary>
          <p>See the <a href="https://en.wikipedia.org/wiki/McNemar%27s_test" target="_blank" rel="noopener noreferrer">McNemar test article</a> for deeper derivations and extensions (matched pairs of nominal data).</p>
        </details>
      </div>
    </section>

    <section class="scenario-section" id="tut-scenario-section">
      <h2>MARKETING SCENARIOS</h2>
      <div class="card">
        <div class="scenario-controls">
          <label for="scenario-select">Load a marketing scenario:</label>
          <div class="scenario-controls__input">
            <select id="scenario-select">
              <option value="">Manual inputs (no preset)</option>
            </select>
          </div>
          <button id="scenario-download" class="secondary hidden" type="button" disabled>Download scenario dataset</button>
        </div>
        <div id="scenario-description">
          <p>Select a preset to auto-fill matched outcomes for common diagnostics (e.g., creative tests with before/after responses). Drop additional <code>.txt</code> files in the <code>scenarios</code> folder and index them to extend the menu.</p>
        </div>
      </div>
    </section>

    <section class="inputs-panel" id="tut-input-section">
      <h2>INPUTS &amp; SETTINGS</h2>
      <div class="card data-entry-card">
        <div class="input-header">
          <h3>Select Data Entry / Upload Mode</h3>
        </div>
        <div class="mode-toggle" role="tablist" aria-label="Data entry mode">
          <button type="button" class="mode-button active" data-mode="manual">Manual entry</button>
          <button type="button" class="mode-button" data-mode="summary-upload">Upload summary inputs</button>
          <button type="button" class="mode-button" data-mode="raw-upload">Upload raw data</button>
        </div>
        <div class="mode-panels">
          <div class="mode-panel active" data-mode="manual" id="manual-panel">
            <article class="manual-card">
              <h3>Matched Outcome Table</h3>
              <p>Enter how many people fall into each combination of outcome and condition. Click the labels directly in the table to customize them.</p>
              <div class="contingency-wrapper" role="group" aria-labelledby="contingency-caption">
                <p id="contingency-caption" class="visually-hidden">2 by 2 contingency table inputs</p>
                <table class="contingency-table">
                  <thead>
                    <tr>
                      <th aria-hidden="true"></th>
                      <th aria-hidden="true" class="axis-label-col"></th>
                      <th id="condition-b-axis" colspan="2">
                        <div id="condition-b-label" class="editable-label heading" contenteditable="true" role="textbox" aria-label="Condition B label">Condition B</div>
                      </th>
                    </tr>
                    <tr>
                      <th aria-hidden="true"></th>
                      <th aria-hidden="true" class="axis-label-col"></th>
                      <th id="col-positive-header">
                        <div id="positive-label" class="editable-label" contenteditable="true" role="textbox" aria-label="Positive label">Positive</div>
                      </th>
                      <th id="col-negative-header">
                        <div id="negative-label" class="editable-label" contenteditable="true" role="textbox" aria-label="Negative label">Negative</div>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th id="condition-a-axis" class="row-axis-label" scope="rowgroup" rowspan="2">
                        <div id="condition-a-label" class="editable-label vertical" contenteditable="true" role="textbox" aria-label="Condition A label">Condition A</div>
                      </th>
                      <th id="row-positive-header" scope="row"><span id="row-positive-label" class="row-label">Positive</span></th>
                      <td>
                        <label class="visually-hidden" for="cell-a-pos-b-pos">A positive &amp; B positive</label>
                        <input type="number" id="cell-a-pos-b-pos" min="0" step="1" value="0">
                      </td>
                      <td>
                        <label class="visually-hidden" for="cell-a-pos-b-neg">A positive &amp; B negative</label>
                        <input type="number" id="cell-a-pos-b-neg" min="0" step="1" value="0">
                      </td>
                    </tr>
                    <tr>
                      <th id="row-negative-header" scope="row"><span id="row-negative-label" class="row-label">Negative</span></th>
                      <td>
                        <label class="visually-hidden" for="cell-a-neg-b-pos">A negative &amp; B positive</label>
                        <input type="number" id="cell-a-neg-b-pos" min="0" step="1" value="0">
                      </td>
                      <td>
                        <label class="visually-hidden" for="cell-a-neg-b-neg">A negative &amp; B negative</label>
                        <input type="number" id="cell-a-neg-b-neg" min="0" step="1" value="0">
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="totals-row">
                  <div><strong id="total-a-positive-label">Total condition A positive:</strong> <span id="total-a-positive">0</span></div>
                  <div><strong id="total-a-negative-label">Total condition A negative:</strong> <span id="total-a-negative">0</span></div>
                  <div><strong>Total pairs:</strong> <span id="total-pairs">0</span></div>
                </div>
              </div>
            </article>
          </div>
          <div class="mode-panel" data-mode="summary-upload" id="summary-panel">
            <p class="panel-intro">Upload a single-row CSV/TSV that includes matched counts, labels, &alpha;, and method preference.</p>
            <div class="dropzone" id="summary-dropzone" role="button" tabindex="0">
              <p class="dropzone-title">Drag &amp; Drop raw data file (.csv, .tsv, .txt)</p>
              <p class="dropzone-note">Single-row summary for 2x2 table: include labels, cell counts, and optional alpha/method fields.</p>
              <button type="button" id="summary-browse" class="secondary">Browse files</button>
            </div>
            <input type="file" id="summary-input" accept=".csv,.tsv,.txt" hidden>
            <div class="template-buttons">
              <button type="button" id="summary-template-download">Download summary template</button>
            </div>
            <p class="upload-status" id="summary-upload-status">No summary file uploaded.</p>
          </div>
          <div class="mode-panel" data-mode="raw-upload" id="raw-panel">
            <p class="panel-intro">Upload row-level matched outcomes. Each row should contain Condition A and Condition B outcomes.</p>
            <div class="dropzone" id="raw-dropzone" role="button" tabindex="0">
              <p class="dropzone-title">Drag &amp; Drop raw data file (.csv, .tsv, .txt)</p>
              <p class="dropzone-note">Two columns with headers (Condition A, Condition B); entries can be text labels or 0/1 outcomes.</p>
              <button type="button" id="raw-browse" class="secondary">Browse files</button>
            </div>
            <input type="file" id="raw-input" accept=".csv,.tsv,.txt" hidden>
            <div class="template-buttons">
              <button type="button" id="raw-template-download">Download raw template</button>
            </div>
            <p class="upload-status" id="raw-upload-status">No raw file uploaded.</p>
          </div>
        </div>
      </div>

      <div class="card confidence-card">
        <h3>Confidence Level &amp; Reporting</h3>
        <p>Set the significance level for all McNemar reporting.</p>
        <div class="alpha-controls">
          <label for="alpha">Significance level (&alpha;)</label>
          <input type="number" id="alpha" min="0.001" max="0.5" step="0.001" value="0.05">
          <div class="confidence-buttons" role="group" aria-label="Select confidence level">
            <button type="button" class="confidence-button conf-level-btn" data-level="0.90">90% Conf.</button>
            <button type="button" class="confidence-button conf-level-btn selected" data-level="0.95">95% Conf.</button>
            <button type="button" class="confidence-button conf-level-btn" data-level="0.99">99% Conf.</button>
          </div>
        </div>
      </div>

      <div class="card analysis-card">
        <h3>Analysis Settings</h3>
        <p class="helper-text">Stay with the default unless your testing doc specifies otherwise.</p>
        <div class="analysis-guidance">
          <p><strong>Statistic guidance</strong></p>
          <ul>
            <li><strong>Chi-square (corrected)</strong>: default, controls false positives when switchers are scarce.</li>
            <li><strong>Chi-square (no correction)</strong>: use when you have 25+ switchers and want slightly more power.</li>
            <li><strong>Exact binomial</strong>: safest when you have only a handful of switchers.</li>
          </ul>
        </div>
        <details class="advanced-details">
          <summary>Advanced: Override the statistic</summary>
          <div class="input-group">
            <label for="analysis-method">Primary method</label>
            <select id="analysis-method">
              <option value="chi2_cc">Chi-square (continuity-corrected)</option>
              <option value="chi2_nocc">Chi-square (no correction)</option>
              <option value="exact">Exact binomial</option>
            </select>
          </div>
          <div class="input-group checkbox">
            <input type="checkbox" id="show-odds-ratio" checked>
            <label for="show-odds-ratio">Show odds-ratio effect size and confidence interval</label>
          </div>
        </details>
      </div>
    </section>

    <section class="visual-output" id="tut-visual-section" aria-labelledby="visual-output-heading">
      <h2 id="visual-output-heading">VISUAL OUTPUT</h2>
      <div class="card">
        <article class="chart-card">
          <h3 id="matrix-chart-title">Contingency Heatmap</h3>
          <div id="matrix-chart" class="chart-placeholder" role="img" aria-live="polite" aria-label="Heatmap of the 2 by 2 contingency table."></div>
          <p id="matrix-caption" class="chart-note"></p>
        </article>
      </div>
    </section>

    <section class="test-results" id="tut-results-section" aria-labelledby="test-results-heading">
      <h2 id="test-results-heading">TEST RESULTS</h2>
      <div class="card metrics-panel">
        <div class="metric-output">Method: <span id="metric-method" class="dynamic-value">&ndash;</span></div>
        <div class="metric-output">Test statistic: <span id="metric-statistic" class="dynamic-value">&ndash;</span></div>
        <div class="metric-output" id="metric-df-row">Degrees of freedom: <span id="metric-df" class="dynamic-value">1</span></div>
        <div class="metric-output">p-value: <span id="metric-pvalue" class="dynamic-value">&ndash;</span></div>
        <div class="metric-output">Odds ratio (CI): <span id="metric-odds" class="dynamic-value">&ndash;</span></div>
        <div class="metric-output">Decision (&alpha;): <span id="metric-decision" class="dynamic-value">&ndash;</span></div>
        <div class="metric-output">Interpretation: <span id="metric-interpretation">&ndash;</span></div>
      </div>
      <div class="dual-panels">
        <article class="card dual-panel">
          <h3>APA-Style Statistical Reporting</h3>
          <p id="apa-report"></p>
        </article>
        <article class="card dual-panel">
          <h3>Managerial Interpretation</h3>
          <p id="managerial-report"></p>
        </article>
      </div>
      <div class="card">
        <h3>Switcher Narrative</h3>
        <div id="switcher-narrative"></div>
      </div>
      <div class="card stats-card">
        <h3>McNemar Test Output</h3>
        <div id="stats-grid" class="stats-grid" aria-live="polite">
          <p>Enter paired counts to run the test.</p>
        </div>
        <div id="stats-explainer" class="stat-explainer"></div>
      </div>
      <div class="card summary-table-card">
        <h3>Summary Table</h3>
        <table class="summary-table">
          <thead>
            <tr>
              <th>Cell</th>
              <th>Count</th>
              <th>Share of total</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody id="summary-table-body">
            <tr>
              <td colspan="4">Enter counts to see the full table.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="diagnostics-section" aria-labelledby="diagnostics-heading">
      <h2 id="diagnostics-heading">DIAGNOSTICS &amp; ASSUMPTIONS</h2>
      <div class="card">
        <details class="diagnostics-details">
          <summary>Diagnostics &amp; Assumption Tests</summary>
          <div id="diagnostics-content">
            <p>Run an analysis to populate diagnostics on switcher counts, balance, and assumption risk.</p>
          </div>
        </details>
      </div>
    </section>
  </main>

    <footer class="app-footer">
        <div class="footer-content">
            <div class="footer-nav">
                <a href="../../../index.html" class="back-link">‚Üê Back to Tool Selection</a>
            </div>
            <div class="footer-meta">
                <span class="meta-item">Created: 2025-11-15</span>
                <span class="separator">‚Ä¢</span>
                <span class="meta-item">Last Updated: 2025-02-23</span>
            </div>
            <div class="footer-citation">
                <div class="citation-label">Cite this tool:</div>
                <div class="citation-text">Baker, A. (2025). McNemar Test Explorer. <em>Dr. Baker's Marketing Tools</em>. Retrieved from <a href="https://drbakermarketing.com/apps/hypothesis_testing/mcnemar/main_mcnemar.html" target="_blank">https://drbakermarketing.com/apps/hypothesis_testing/mcnemar/main_mcnemar.html</a></div>
            </div>
            <div class="footer-copyright">
                &copy; 2025 Andrew Baker. All rights reserved.
            </div>
        </div>
    </footer>

  <script src="../../../shared/js/csv_utils.js"></script>
  <script src="../../../shared/js/ui_utils.js"></script>
  <script src="../../../shared/js/auth_tracking.js"></script>
  <script src="../../../shared/js/auth_bar.js"></script>
  <script src="../../../shared/js/quiz_utils.js"></script>
  <script src="mcnemar_app.js"></script>
  <script src="mcnemar_tutorial.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      initQuizButton('mcnemar');
    });
  </script>
</body>
</html>
