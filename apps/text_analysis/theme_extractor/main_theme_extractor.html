<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Theme Extractor - Marketing Text Analysis</title>
  <!-- Shared design system -->
  <link rel="stylesheet" href="../../../shared/css/main.css">
    <script src="../../../shared/js/tracking.js"></script>
  <!-- App-specific styles -->
  <link rel="stylesheet" href="theme_extractor.css">
  <!-- Chart.js for visualizations -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Auth tracking -->
  <script src="../../../shared/js/auth_tracking.js"></script>
  <script src="../../../shared/js/auth_bar.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-290ZJ9RE04"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-290ZJ9RE04');
    </script>
</head>

<body>
  <div id="auth-bar"></div>
  
  <main class="app-main">
    <header class="intro hero-header">
      <div class="hero-header__top">
        <h1>Theme Extractor</h1>
        <div class="hero-context">
          <span class="badge badge--text-analysis">Text Analysis</span>
          <span class="badge badge--nlp">NLP</span>
        </div>
      </div>
      <p class="hero-header__lede">Automatically discover hidden themes and topics in customer reviews, survey responses, and open-ended feedback using machine learning.</p>
    </header>

    <section class="test-overview" aria-labelledby="test-overview-heading">
      <h2 id="test-overview-heading">HOW IT WORKS</h2>
      <div class="card">
        <p>This tool uses <strong>Non-negative Matrix Factorization (NMF)</strong> to identify latent themes in text data. Unlike manual coding, the algorithm automatically discovers patterns across hundreds of documents.</p>
        
        <div class="how-it-works-grid">
          <div class="step-card">
            <div class="step-number">1</div>
            <h4>Text Preprocessing</h4>
            <p>Documents are cleaned, tokenized, and lemmatized. Stop words and common filler terms are removed.</p>
          </div>
          <div class="step-card">
            <div class="step-number">2</div>
            <h4>TF-IDF Vectorization</h4>
            <p>Text is converted to numerical vectors based on term frequency and document importance.</p>
          </div>
          <div class="step-card">
            <div class="step-number">3</div>
            <h4>Theme Discovery</h4>
            <p>NMF decomposes the matrix into themes, each represented by its most characteristic words.</p>
          </div>
          <div class="step-card">
            <div class="step-number">4</div>
            <h4>Document Assignment</h4>
            <p>Each document is assigned to themes based on how strongly it matches each theme's pattern.</p>
          </div>
        </div>
        
        <details class="intro-notes">
          <summary>When to Use This Tool</summary>
          <ul>
            <li><strong>Customer Reviews:</strong> Discover what aspects of your product customers discuss most</li>
            <li><strong>Survey Responses:</strong> Find patterns in open-ended feedback without manual coding</li>
            <li><strong>Social Media:</strong> Identify conversation themes around your brand</li>
            <li><strong>Support Tickets:</strong> Categorize issues automatically for better triage</li>
          </ul>
        </details>
        
        <details class="interpretation-aid">
          <summary>Understanding NMF Topic Modeling</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä What is NMF?</h5>
              <p><strong>Non-negative Matrix Factorization (NMF)</strong> is a dimensionality reduction technique that decomposes your document-term matrix into two smaller matrices:</p>
              <ul>
                <li><strong>W (Document-Theme matrix):</strong> Shows how much each document relates to each theme</li>
                <li><strong>H (Theme-Term matrix):</strong> Shows which words define each theme</li>
              </ul>
              <p>The "non-negative" constraint means all values are ‚â• 0, making results interpretable as additive parts that combine to form documents.</p>
            </div>
            
            <div class="guide-section">
              <h5>üìà NMF vs. Other Methods</h5>
              <table class="guide-table">
                <thead>
                  <tr><th>Method</th><th>Strengths</th><th>Best For</th></tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>NMF</strong></td>
                    <td>Interpretable themes, fast, produces sparse topics</td>
                    <td>Marketing text, customer reviews, product feedback</td>
                  </tr>
                  <tr>
                    <td>LDA</td>
                    <td>Probabilistic, handles document length well</td>
                    <td>Large document collections, academic papers</td>
                  </tr>
                  <tr>
                    <td>LSA/SVD</td>
                    <td>Captures synonymy, mathematical foundations</td>
                    <td>Information retrieval, search engines</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="guide-section">
              <h5>‚ö†Ô∏è Limitations to Keep in Mind</h5>
              <ul>
                <li><strong>Bag of words:</strong> Word order is ignored; "not good" and "good" are treated similarly</li>
                <li><strong>Pre-set theme count:</strong> You must specify (or auto-detect) the number of themes</li>
                <li><strong>Static themes:</strong> Themes don't evolve over time or account for sequence</li>
                <li><strong>Interpretability depends on data:</strong> Noisy or very diverse text may produce unclear themes</li>
              </ul>
            </div>
            
            <div class="guide-section">
              <h5>üí° Tips for Better Results</h5>
              <ul>
                <li><strong>Homogeneous data:</strong> Analyze reviews of similar products together, not mixed categories</li>
                <li><strong>Sufficient volume:</strong> 50+ documents recommended for meaningful themes</li>
                <li><strong>Similar length:</strong> Very short tweets mixed with long reviews may skew results</li>
                <li><strong>Domain-specific stop words:</strong> Common domain terms (e.g., "product," "service") may need filtering</li>
              </ul>
            </div>
          </div>
        </details>
        
        <details class="interpretation-aid">
          <summary>Understanding TF-IDF Vectorization</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä What is TF-IDF?</h5>
              <p><strong>Term Frequency-Inverse Document Frequency</strong> measures how important a word is to a document in a collection:</p>
              <ul>
                <li><strong>TF (Term Frequency):</strong> How often a word appears in a document (more = more important)</li>
                <li><strong>IDF (Inverse Document Frequency):</strong> How rare a word is across all documents (rarer = more distinctive)</li>
              </ul>
              <p class="equation"><strong>Formula:</strong> TF-IDF = TF √ó log(Total Documents / Documents with Term)</p>
            </div>
            
            <div class="guide-section">
              <h5>üìà Why TF-IDF Matters</h5>
              <p>Common words like "the," "is," "product" appear everywhere and don't help distinguish themes. TF-IDF automatically downweights these while highlighting distinctive vocabulary:</p>
              <ul>
                <li><strong>High TF-IDF:</strong> Words that are frequent in specific documents but rare overall ‚Üí good theme indicators</li>
                <li><strong>Low TF-IDF:</strong> Words that appear everywhere or rarely anywhere ‚Üí less useful for themes</li>
              </ul>
            </div>
            
            <div class="guide-section">
              <h5>üí° Example</h5>
              <p>In electronics reviews:</p>
              <ul>
                <li>"battery" might have high TF-IDF in power-related reviews ‚Üí strong theme signal</li>
                <li>"product" appears in almost every review ‚Üí low TF-IDF, filtered out</li>
                <li>"phenomenal" rarely appears but is strong when it does ‚Üí distinctive sentiment indicator</li>
              </ul>
            </div>
          </div>
        </details>
      </div>
    </section>

    <section class="input-card" aria-labelledby="inputs-heading">
      <h2 id="inputs-heading">UPLOAD YOUR TEXT DATA</h2>
      
      <!-- Case Study Selector -->
      <article class="card scenario-card">
        <h3>Case Studies</h3>
        <p>Practice with curated marketing datasets, or upload your own data below.</p>
        
        <div class="scenario-controls">
          <div class="scenario-select-wrapper">
            <label for="scenario-select">Select a case study:</label>
            <select id="scenario-select">
              <option value="">-- Choose a case study --</option>
            </select>
          </div>
          <button type="button" id="scenario-download" class="secondary hidden">Download Dataset (CSV)</button>
        </div>
        
        <div id="scenario-description" class="scenario-description hidden">
          <!-- Description loaded from .txt file -->
        </div>
      </article>
      
      <article class="card data-entry-card">
        <div class="input-header">
          <h3>Data Input</h3>
          <p class="limits-info">
            <span class="limit-badge">Max 500 documents</span>
            <span class="limit-badge">Max 5,000 chars each</span>
          </p>
        </div>
        
        <div class="mode-toggle" role="tablist" aria-label="Data entry mode">
          <button type="button" class="mode-button active" data-mode="paste">Paste Text</button>
          <button type="button" class="mode-button" data-mode="upload">Upload CSV</button>
        </div>
        
        <div class="mode-panels">
          <!-- Paste Mode -->
          <div class="mode-panel active" data-mode="paste" id="paste-panel">
            <div class="paste-instructions">
              <p>Paste your text data below. Each line will be treated as a separate document (review, comment, etc.).</p>
            </div>
            <textarea id="text-input" class="text-input" rows="12" placeholder="Paste your reviews/comments here, one per line...

Example:
The battery life on this phone is amazing, lasts all day!
Screen quality is great but the camera is disappointing.
Fast shipping and the price was very reasonable.
Love the design but wish it came in more colors."></textarea>
            <div class="paste-stats">
              <span id="line-count">0 documents</span>
              <span id="char-count">0 characters</span>
            </div>
          </div>
          
          <!-- Upload Mode -->
          <div class="mode-panel" data-mode="upload" id="upload-panel">
            <div class="data-import-block">
              <p>Upload a CSV file with a text column. The tool will auto-detect columns containing text.</p>
              <div id="upload-dropzone" class="dropzone" role="button" tabindex="0">
                <p class="dropzone-title">Drag & drop CSV file</p>
                <p class="dropzone-note">or click to browse</p>
                <button type="button" id="browse-btn" class="secondary">Browse files</button>
              </div>
              <input type="file" id="file-input" accept=".csv,.tsv,.txt" hidden>
              <p id="upload-feedback" class="upload-status" aria-live="polite">No file uploaded.</p>
              
              <div id="column-selector" class="column-selector hidden">
                <label for="text-column">Select text column:</label>
                <select id="text-column"></select>
                <p class="column-preview" id="column-preview"></p>
                
                <div class="grouping-option">
                  <label class="checkbox-label">
                    <input type="checkbox" id="use-grouping-checkbox" />
                    <span>Enable grouping by column (compare themes across groups)</span>
                  </label>
                  <select id="group-column-select" title="Select grouping column" disabled>
                    <option value="">(Select a grouping column)</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="template-buttons">
              <button type="button" id="download-template" class="secondary">Download sample CSV template</button>
            </div>
          </div>
        </div>
      </article>

      <article class="card analysis-settings">
        <h3>Analysis Settings</h3>
        
        <div class="settings-grid">
          <div class="setting-group">
            <label for="num-themes">Number of Themes</label>
            <div class="theme-selector">
              <select id="num-themes">
                <option value="auto" selected>Auto-detect (recommended)</option>
                <option value="2">2 themes</option>
                <option value="3">3 themes</option>
                <option value="4">4 themes</option>
                <option value="5">5 themes</option>
                <option value="6">6 themes</option>
                <option value="7">7 themes</option>
                <option value="8">8 themes</option>
              </select>
            </div>
            <p class="hint">Auto-detect finds the optimal number based on your data.</p>
          </div>
          
          <div class="setting-group">
            <label for="words-per-theme">Words per Theme</label>
            <select id="words-per-theme">
              <option value="5">5 words</option>
              <option value="8" selected>8 words</option>
              <option value="10">10 words</option>
              <option value="12">12 words</option>
            </select>
            <p class="hint">More words give richer theme descriptions.</p>
          </div>
        </div>
        
        <details class="interpretation-aid">
          <summary>Choosing the Right Number of Themes</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä Auto-Detection Method</h5>
              <p>When set to "Auto-detect," the algorithm tests different theme counts (2-8) and selects the one with the best <strong>coherence score</strong>. Coherence measures how semantically similar the top words in each theme are to each other.</p>
              <ul>
                <li><strong>High coherence:</strong> Theme words relate to a single concept (e.g., "battery, charge, power, life")</li>
                <li><strong>Low coherence:</strong> Theme words are scattered (e.g., "battery, shipping, color, return")</li>
              </ul>
            </div>
            
            <div class="guide-section">
              <h5>üìà When to Override Auto-Detection</h5>
              <table class="guide-table">
                <thead>
                  <tr><th>Situation</th><th>Recommended Action</th></tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Themes seem too broad/general</td>
                    <td>Increase theme count (more specific topics)</td>
                  </tr>
                  <tr>
                    <td>Similar themes detected</td>
                    <td>Decrease theme count (consolidate)</td>
                  </tr>
                  <tr>
                    <td>You know the domain well</td>
                    <td>Set count based on expected categories</td>
                  </tr>
                  <tr>
                    <td>Very small dataset (&lt;100 docs)</td>
                    <td>Use 2-4 themes to avoid overfitting</td>
                  </tr>
                  <tr>
                    <td>Large, diverse dataset (&gt;500 docs)</td>
                    <td>Try 5-8 themes for granularity</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="guide-section">
              <h5>üí° Iterative Approach</h5>
              <p>Topic modeling often benefits from experimentation:</p>
              <ol>
                <li>Start with auto-detect to get a baseline</li>
                <li>Review the themes‚Äîdo they make business sense?</li>
                <li>If themes overlap, reduce count; if too broad, increase count</li>
                <li>Compare sample comments across runs to validate</li>
              </ol>
            </div>
          </div>
        </details>
        
        <details class="interpretation-aid">
          <summary>Words per Theme: Quality vs. Specificity</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä What This Controls</h5>
              <p>This setting determines how many top-weighted words are shown for each discovered theme. The words are ranked by their importance to that theme (NMF weight).</p>
            </div>
            
            <div class="guide-section">
              <h5>üìà Trade-offs</h5>
              <table class="guide-table">
                <thead>
                  <tr><th>Words</th><th>Pros</th><th>Cons</th></tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>5 words</strong></td>
                    <td>Clean, focused, easy to label</td>
                    <td>May miss nuances</td>
                  </tr>
                  <tr>
                    <td><strong>8 words</strong> (default)</td>
                    <td>Good balance of clarity and detail</td>
                    <td>‚Äî</td>
                  </tr>
                  <tr>
                    <td><strong>10-12 words</strong></td>
                    <td>Richer context, better for unfamiliar domains</td>
                    <td>Can include lower-relevance terms</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="guide-section">
              <h5>üí° Recommendation</h5>
              <p>Start with <strong>8 words</strong> (default). Increase to 10-12 if you're exploring unfamiliar data and need more context to understand themes. Decrease to 5 for clean presentation in reports.</p>
            </div>
          </div>
        </details>
        
        <div class="run-analysis">
          <button type="button" id="run-btn" class="primary-btn" disabled>
            <span class="btn-text">Extract Themes</span>
            <span class="btn-loading hidden">
              <span class="spinner"></span> Analyzing...
            </span>
          </button>
        </div>
      </article>
    </section>

    <!-- Results Section (hidden until analysis runs) -->
    <section class="results-section hidden" id="results-section" aria-labelledby="results-heading">
      <h2 id="results-heading">DISCOVERED THEMES</h2>
      
      <div class="card stats-summary">
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value" id="stat-documents">--</span>
            <span class="stat-label">Documents Analyzed</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="stat-themes">--</span>
            <span class="stat-label">Themes Found</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="stat-vocab">--</span>
            <span class="stat-label">Unique Terms</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="stat-tokens">--</span>
            <span class="stat-label">Tokens Processed</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="stat-avg-length">--</span>
            <span class="stat-label">Avg Doc Length</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="stat-avg-confidence">--</span>
            <span class="stat-label">Avg Confidence</span>
          </div>
          <div class="stat-item auto-detected hidden" id="stat-auto">
            <span class="stat-badge">‚úì Auto-detected</span>
          </div>
        </div>
        
        <details class="interpretation-aid">
          <summary>Understanding These Statistics</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä Metric Explanations</h5>
              <table class="guide-table">
                <thead>
                  <tr><th>Metric</th><th>What It Means</th><th>Good Values</th></tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Documents Analyzed</strong></td>
                    <td>Total number of text items processed</td>
                    <td>50+ for reliable themes; 200+ for robust analysis</td>
                  </tr>
                  <tr>
                    <td><strong>Themes Found</strong></td>
                    <td>Number of distinct topics discovered</td>
                    <td>Typically 3-6; depends on data diversity</td>
                  </tr>
                  <tr>
                    <td><strong>Unique Terms</strong></td>
                    <td>Vocabulary size after preprocessing</td>
                    <td>100-1000 typical; varies by data</td>
                  </tr>
                  <tr>
                    <td><strong>Tokens Processed</strong></td>
                    <td>Total words analyzed (after filtering)</td>
                    <td>More is generally better for theme stability</td>
                  </tr>
                  <tr>
                    <td><strong>Avg Doc Length</strong></td>
                    <td>Mean tokens per document</td>
                    <td>5-50 tokens typical; very short docs may lack signal</td>
                  </tr>
                  <tr>
                    <td><strong>Avg Confidence</strong></td>
                    <td>Mean theme assignment strength (0-100%)</td>
                    <td>60%+ indicates clear theme assignments</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="guide-section">
              <h5>‚ö†Ô∏è Warning Signs</h5>
              <ul>
                <li><strong>Very few unique terms (&lt;50):</strong> Data may be too short or repetitive</li>
                <li><strong>Low avg confidence (&lt;40%):</strong> Themes may be overlapping or data is ambiguous</li>
                <li><strong>Avg doc length &lt;5 tokens:</strong> Documents may be too short for reliable analysis</li>
              </ul>
            </div>
          </div>
        </details>
      </div>

      <!-- Theme Cards -->
      <div class="themes-container" id="themes-container">
        <!-- Theme cards will be inserted here by JS -->
      </div>
      
      <details class="interpretation-aid card">
        <summary>How to Interpret Theme Cards</summary>
        <div class="help-content">
          <div class="guide-section">
            <h5>üìä Theme Card Elements</h5>
            <ul>
              <li><strong>Theme Label:</strong> Auto-generated label based on top words; rename mentally to match your domain</li>
              <li><strong>Document Count:</strong> How many documents primarily belong to this theme</li>
              <li><strong>Top Words:</strong> Most characteristic vocabulary for this theme, ordered by weight</li>
              <li><strong>Weight Bar:</strong> Relative importance‚Äîwider bars = more defining for the theme</li>
            </ul>
          </div>
          
          <div class="guide-section">
            <h5>üìà Reading the Word Weights</h5>
            <p>Words are ranked by their <strong>NMF weight</strong> within the theme:</p>
            <ul>
              <li><strong>First 2-3 words:</strong> Core defining terms‚Äîthese anchor the theme's meaning</li>
              <li><strong>Middle words:</strong> Supporting context‚Äîhelp refine the theme's scope</li>
              <li><strong>Last words:</strong> Peripheral‚Äîmay overlap with other themes</li>
            </ul>
            <p class="hint">Focus on the first 3-4 words when labeling themes for business presentations.</p>
          </div>
          
          <div class="guide-section">
            <h5>üí° Naming Your Themes</h5>
            <p>Auto-generated labels use top words, but you should create meaningful names:</p>
            <ul>
              <li><strong>Battery, charge, power, life</strong> ‚Üí "Battery & Power"</li>
              <li><strong>Ship, delivery, fast, arrive</strong> ‚Üí "Shipping Experience"</li>
              <li><strong>Price, expensive, worth, money</strong> ‚Üí "Value for Money"</li>
              <li><strong>Easy, simple, intuitive, learn</strong> ‚Üí "Ease of Use"</li>
            </ul>
          </div>
          
          <div class="guide-section">
            <h5>‚ö†Ô∏è Theme Quality Indicators</h5>
            <table class="guide-table">
              <thead>
                <tr><th>Observation</th><th>What It Means</th><th>Action</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td>Words don't relate to each other</td>
                  <td>Low coherence; theme is "garbage"</td>
                  <td>Try fewer themes or cleaner data</td>
                </tr>
                <tr>
                  <td>Two themes have similar words</td>
                  <td>Themes overlap</td>
                  <td>Reduce theme count</td>
                </tr>
                <tr>
                  <td>Theme has very few documents</td>
                  <td>Outlier theme or over-segmentation</td>
                  <td>Consider merging or reducing count</td>
                </tr>
                <tr>
                  <td>One theme has 80%+ of documents</td>
                  <td>Data lacks diversity</td>
                  <td>May need more themes or different data</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </details>
      
      <!-- Visualizations -->
      <div class="card visualizations">
        <h3>Theme Distribution</h3>
        <div class="chart-container">
          <canvas id="theme-distribution-chart"></canvas>
        </div>
        
        <details class="interpretation-aid">
          <summary>Reading the Distribution Chart</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä What This Shows</h5>
              <p>The bar chart displays the <strong>percentage of documents</strong> assigned to each theme. Documents are assigned to the theme with the highest confidence score.</p>
            </div>
            
            <div class="guide-section">
              <h5>üìà Interpreting the Distribution</h5>
              <ul>
                <li><strong>Even distribution:</strong> Themes are well-balanced; data covers diverse topics equally</li>
                <li><strong>Skewed distribution:</strong> One or two dominant topics; consider if this reflects reality or a data issue</li>
                <li><strong>Very small themes (&lt;5%):</strong> May be edge cases or noise; review sample comments to validate</li>
              </ul>
            </div>
            
            <div class="guide-section">
              <h5>üí° Grouping Analysis</h5>
              <p>When grouping is enabled (e.g., by product type or customer segment), the chart shows:</p>
              <ul>
                <li>Bars clustered by theme with colors representing different groups</li>
                <li>Compare how themes distribute across groups</li>
                <li>Identify themes that are dominant in specific segments</li>
              </ul>
            </div>
          </div>
        </details>
      </div>
      
      <!-- Sample Comments -->
      <div class="card sample-comments" id="sample-comments-section">
        <div class="section-header-row">
          <h3>Sample Comments by Theme</h3>
          <div class="sample-count-selector">
            <label for="sample-count">Show top</label>
            <select id="sample-count">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3" selected>3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
            <span>per theme</span>
          </div>
        </div>
        <p class="section-info">Most representative documents for each theme (highest confidence scores).</p>
        
        <div class="samples-container" id="samples-container">
          <!-- Sample cards will be inserted here by JS -->
        </div>
        
        <details class="interpretation-aid">
          <summary>Understanding Sample Comments & Confidence Scores</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä What Are Sample Comments?</h5>
              <p>These are the <strong>most representative documents</strong> for each theme‚Äîthe ones the algorithm is most confident about assigning to that theme. They serve as concrete examples of what each theme "looks like" in your data.</p>
            </div>
            
            <div class="guide-section">
              <h5>üìà Understanding Confidence Scores</h5>
              <p>The confidence percentage reflects how strongly a document matches its assigned theme:</p>
              <table class="guide-table">
                <thead>
                  <tr><th>Confidence</th><th>Interpretation</th></tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>80-100%</strong></td>
                    <td>Very strong match; document clearly belongs to this theme</td>
                  </tr>
                  <tr>
                    <td><strong>60-79%</strong></td>
                    <td>Good match; may have some secondary theme presence</td>
                  </tr>
                  <tr>
                    <td><strong>40-59%</strong></td>
                    <td>Moderate match; document spans multiple themes</td>
                  </tr>
                  <tr>
                    <td><strong>&lt;40%</strong></td>
                    <td>Weak match; assignment is uncertain</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="guide-section">
              <h5>üí° How to Use Samples</h5>
              <ul>
                <li><strong>Validate themes:</strong> Do the sample comments make sense for the theme words?</li>
                <li><strong>Name themes:</strong> Reading samples helps you create meaningful labels</li>
                <li><strong>Spot issues:</strong> If samples seem unrelated to theme words, the theme may be incoherent</li>
                <li><strong>Understand edge cases:</strong> Lower-confidence samples show the theme's boundaries</li>
              </ul>
            </div>
            
            <div class="guide-section">
              <h5>‚ö†Ô∏è When Samples Don't Match Expectations</h5>
              <p>If sample comments seem wrong for a theme:</p>
              <ul>
                <li>The theme may be capturing something unexpected (look at all words, not just top 2-3)</li>
                <li>Try increasing the number of themes to separate concepts</li>
                <li>Check if common domain words need filtering</li>
                <li>Very short documents may be assigned based on limited signal</li>
              </ul>
            </div>
          </div>
        </details>
      </div>
      
      <!-- How Scoring Works -->
      <div class="card scoring-examples" id="scoring-examples-section">
        <h3>How Scoring Works</h3>
        <p class="section-info">These examples show how the NMF algorithm processes text. Each word (token) is analyzed for its relevance to each theme. Words that strongly match a theme are highlighted in that theme's color. The final theme assignment is based on the combined weights of all tokens.</p>
        
        <div class="scoring-legend">
          <span class="legend-title">Token Legend:</span>
          <span class="legend-item"><span class="legend-color strong"></span> Strong theme match</span>
          <span class="legend-item"><span class="legend-color medium"></span> Medium match</span>
          <span class="legend-item"><span class="legend-color weak"></span> Weak/No match</span>
          <span class="legend-item"><span class="legend-color stopword"></span> Filtered (stopword)</span>
        </div>
        
        <div class="examples-container" id="examples-container">
          <!-- Example cards will be inserted here by JS -->
        </div>
        
        <details class="interpretation-aid">
          <summary>Deep Dive: The NMF Scoring Process</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä Step-by-Step Scoring</h5>
              <ol>
                <li><strong>Tokenization:</strong> Text is split into individual words (tokens)</li>
                <li><strong>Preprocessing:</strong> Stop words, punctuation, and very common terms are removed</li>
                <li><strong>TF-IDF Lookup:</strong> Each remaining token gets its TF-IDF weight from the vocabulary</li>
                <li><strong>Theme Weights:</strong> The token's TF-IDF vector is multiplied by each theme's word loadings</li>
                <li><strong>Aggregation:</strong> All token weights are summed to get total theme scores for the document</li>
                <li><strong>Normalization:</strong> Scores are converted to percentages (confidence) for assignment</li>
              </ol>
            </div>
            
            <div class="guide-section">
              <h5>üìà Token Highlighting Explained</h5>
              <table class="guide-table">
                <thead>
                  <tr><th>Highlight</th><th>Meaning</th><th>Example</th></tr>
                </thead>
                <tbody>
                  <tr>
                    <td><span class="legend-color legend-color--inline strong"></span> <strong>Strong</strong></td>
                    <td>Token is a top word in the assigned theme</td>
                    <td>"battery" in a Power theme</td>
                  </tr>
                  <tr>
                    <td><span class="legend-color legend-color--inline medium"></span> <strong>Medium</strong></td>
                    <td>Token contributes to a theme but isn't a top word</td>
                    <td>"lasts" in a Power theme</td>
                  </tr>
                  <tr>
                    <td><span class="legend-color legend-color--inline weak"></span> <strong>Weak</strong></td>
                    <td>Token is in vocabulary but has low theme relevance</td>
                    <td>"the" (common), "unique" (rare)</td>
                  </tr>
                  <tr>
                    <td><span class="legend-color legend-color--inline stopword"></span> <strong>Filtered</strong></td>
                    <td>Token was removed during preprocessing</td>
                    <td>"a", "the", "is", "and"</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="guide-section">
              <h5>üí° Why Some Words Are Filtered</h5>
              <p>The algorithm removes words that don't help distinguish themes:</p>
              <ul>
                <li><strong>Stop words:</strong> "the", "is", "and", "a" appear in every document</li>
                <li><strong>Too common:</strong> Words in 90%+ of documents don't differentiate</li>
                <li><strong>Too rare:</strong> Words in only 1-2 documents may be noise</li>
                <li><strong>Numbers/punctuation:</strong> Usually not meaningful for theme detection</li>
              </ul>
            </div>
            
            <div class="guide-section">
              <h5>‚ö†Ô∏è Limitations of Token-Level View</h5>
              <p>The highlighting shows simplified match indicators. The actual algorithm considers:</p>
              <ul>
                <li>Continuous weights (not just high/medium/low categories)</li>
                <li>Interactions between words in context</li>
                <li>Document length normalization</li>
                <li>Relative importance across all themes simultaneously</li>
              </ul>
              <p>Use this view to build intuition, but trust the overall confidence score for assignments.</p>
            </div>
          </div>
        </details>
      </div>
      
      <!-- Export Options -->
      <div class="card export-section">
        <h3>Export Results</h3>
        <div class="export-buttons">
          <button type="button" id="export-themes" class="secondary">Download Themes Summary (CSV)</button>
          <button type="button" id="export-assignments" class="secondary">Download Document Assignments (CSV)</button>
        </div>
        
        <details class="interpretation-aid">
          <summary>What's in Each Export File?</summary>
          <div class="help-content">
            <div class="guide-section">
              <h5>üìä Themes Summary (CSV)</h5>
              <p>Contains one row per theme with:</p>
              <ul>
                <li><strong>Theme ID:</strong> Numeric identifier (1, 2, 3...)</li>
                <li><strong>Top Words:</strong> Comma-separated list of characteristic terms</li>
                <li><strong>Document Count:</strong> Number of documents assigned to this theme</li>
                <li><strong>Percentage:</strong> Share of total documents</li>
              </ul>
              <p><strong>Use for:</strong> Executive summaries, presentations, theme labeling reference</p>
            </div>
            
            <div class="guide-section">
              <h5>üìà Document Assignments (CSV)</h5>
              <p>Contains one row per document with:</p>
              <ul>
                <li><strong>Document ID:</strong> Row number from your original data</li>
                <li><strong>Original Text:</strong> The full text of the document</li>
                <li><strong>Assigned Theme:</strong> Primary theme ID</li>
                <li><strong>Confidence:</strong> Assignment confidence percentage</li>
                <li><strong>Theme_1_Score, Theme_2_Score, ...:</strong> Raw scores for each theme</li>
              </ul>
              <p><strong>Use for:</strong> Further analysis in Excel/R/Python, filtering by theme, joining with other data</p>
            </div>
            
            <div class="guide-section">
              <h5>üí° Analysis Ideas</h5>
              <ul>
                <li>Join assignments with customer metadata (segment, region, NPS score)</li>
                <li>Filter low-confidence assignments for manual review</li>
                <li>Track theme distribution over time periods</li>
                <li>Compare themes across product lines or customer segments</li>
              </ul>
            </div>
          </div>
        </details>
      </div>
    </section>

    <!-- Error Display -->
    <div class="error-toast hidden" id="error-toast">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span class="error-message" id="error-message"></span>
      <button type="button" class="error-close" id="error-close">√ó</button>
    </div>
  </main>

  <footer class="app-footer">
    <div class="footer-content">
        <div class="footer-nav">
            <a href="../../../index.html">‚Üê Back to Tool Selection</a>
        </div>
        <div class="footer-meta">
            <span>Created: <span id="created-date">2025-12-01</span></span>
            <span class="meta-separator">&bull;</span>
            <span>Last Updated: <span id="modified-date">2025-12-11</span></span>
        </div>
        <div class="footer-citation">
            <span class="citation-label">Cite this tool</span>
            <p class="citation-text">
                Baker, A. (2025). <em>Theme Extractor - Marketing Text Analysis Tool</em>. Marketing Analysis Tools.
                <br>
                <span style="font-size: 0.85em; color: #6b7280;">Retrieved from: https://drbakermarketing.com/apps/text_analysis/theme_extractor/main_theme_extractor.html</span>
            </p>
        </div>
        <div class="footer-copyright">
            &copy; 2025 Andrew Baker. All rights reserved.
        </div>
    </div>
  </footer>

  <script src="../../../shared/js/csv_utils.js"></script>
  <script src="theme_extractor_app.js"></script>
</body>

</html>
