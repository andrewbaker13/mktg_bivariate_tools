<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Network Playground - Dr. Baker Marketing Analytics</title>
    <link rel="stylesheet" href="../../../shared/css/main.css">
    <style>
        .playground-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .playground-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .playground-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .playground-header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .playground-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .controls-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            font-size: 0.9em;
            text-transform: uppercase;
            color: #7f8c8d;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-size: 0.9em;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .control-group select,
        .control-group input[type="range"] {
            width: 100%;
        }

        .control-group .value-display {
            font-size: 0.85em;
            color: #3498db;
            font-weight: 600;
        }

        .dataset-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .dataset-card {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dataset-card:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .dataset-card.active {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .dataset-preview {
            width: 60px;
            height: 60px;
            margin: 0 auto 5px;
        }

        .dataset-card h4 {
            font-size: 0.85em;
            margin: 0 0 3px 0;
            color: #2c3e50;
        }

        .dataset-card .dataset-desc {
            font-size: 0.75em;
            color: #7f8c8d;
            margin: 0;
        }

        .scenario-details {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            margin-top: 15px;
        }

        .scenario-details h4 {
            color: #2c3e50;
        }

        .section-divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #3498db, transparent);
            margin: 25px 0;
        }

        .model-section {
            background: #f0f7ff;
            border-left: 3px solid #3498db;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
        }

        .help-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            line-height: 16px;
            text-align: center;
            background: #3498db;
            color: white;
            border-radius: 50%;
            font-size: 0.7em;
            cursor: help;
            margin-left: 3px;
        }

        .help-icon:hover {
            background: #2980b9;
        }

        .feature-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .feature-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85em;
        }

        .visualization-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .network-viz {
            margin-bottom: 20px;
        }

        .viz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .viz-header h2 {
            margin: 0;
            font-size: 1.2em;
            color: #2c3e50;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .training-section, .validation-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.3em;
        }

        .training-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .network-viz-box, .progress-viz-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        .network-viz-box h3, .progress-viz-box h3, .boundary-viz-box h3, .validation-metrics-box h3 {
            margin: 0 0 15px 0;
            font-size: 1em;
            color: #2c3e50;
        }

        #networkCanvas {
            width: 100%;
            height: 350px;
            border: 1px solid #ecf0f1;
            border-radius: 4px;
            background: white;
            display: block;
        }

        #lossChart {
            width: 100%;
            height: 250px;
            border: 1px solid #ecf0f1;
            border-radius: 4px;
            background: white;
            display: block;
        }

        .metrics-row {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .metric-mini {
            flex: 1;
            background: white;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }

        .metric-mini .metric-label {
            display: block;
            font-size: 0.75em;
            color: #7f8c8d;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .metric-mini .metric-value {
            display: block;
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
        }

        .validation-grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 20px;
        }

        .boundary-viz-box, .validation-metrics-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        #boundaryCanvas {
            width: 100%;
            height: 400px;
            border: 1px solid #ecf0f1;
            border-radius: 4px;
            background: white;
            display: block;
        }

        .metric-card-large {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .metric-card-large h4 {
            margin: 0 0 10px 0;
            font-size: 0.9em;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .metric-card-large .value-large {
            font-size: 3em;
            font-weight: 700;
            color: #27ae60;
        }

        .validation-explanation {
            background: white;
            border-radius: 8px;
            padding: 15px;
        }

        .validation-explanation h4 {
            margin: 0 0 10px 0;
            font-size: 0.95em;
            color: #2c3e50;
        }

        .validation-explanation ul {
            margin: 0;
            padding-left: 20px;
        }

        .metric-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .metric-card h4 {
            margin: 0 0 5px 0;
            font-size: 0.85em;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .metric-card .value {
            font-size: 1.8em;
            font-weight: 600;
            color: #2c3e50;
        }

        .metric-card .subvalue {
            font-size: 0.9em;
            color: #95a5a6;
        }

        .chart-container {
            margin-top: 20px;
        }

        #lossChart {
            width: 100%;
            height: 200px;
            border: 1px solid #ecf0f1;
            border-radius: 4px;
            background: white;
            display: block;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
            font-size: 1em;
        }

        .info-box p {
            margin: 0;
            color: #424242;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .guided-mode-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .guided-mode-banner h3 {
            margin: 0;
            font-size: 1em;
        }

        .guided-mode-banner label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .playground-grid {
                grid-template-columns: 1fr;
            }

            .dataset-selector {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Bar -->
    <div class="auth-bar">
        <div class="auth-bar__container">
            <div></div>
            <div id="auth-bar-content" class="auth-bar__links">
                <!-- Populated by auth_bar.js -->
            </div>
        </div>
    </div>

    <div class="playground-container">
        <div class="playground-header">
            <h1>üß† Neural Network Playground</h1>
            <p>Visualize and understand how neural networks learn marketing patterns</p>
        </div>

        <!-- Guided Mode Banner -->
        <div class="guided-mode-banner">
            <h3>üëã New to neural networks? Guided mode simplifies the controls!</h3>
            <label>
                <input type="checkbox" id="guidedMode" checked>
                <span>Guided Mode</span>
            </label>
        </div>

        <!-- Info Box -->
        <div class="info-box">
            <h3>What is this tool?</h3>
            <p>
                Neural networks learn patterns from data by adjusting internal weights through training. 
                This playground lets you experiment with different network architectures and see how they learn 
                to classify marketing scenarios like customer segments, churn prediction, and A/B test outcomes.
            </p>
        </div>

        <div class="playground-grid">
            <!-- Controls Panel -->
            <div class="controls-panel">
                <!-- Dataset Selection -->
                <div class="control-section">
                    <h3>üìä Step 1: Choose Your Business Problem</h3>
                    <p style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 15px;">
                        Select a real marketing scenario. Each has different patterns the network must learn.
                    </p>
                    <div class="dataset-selector">
                        <div class="dataset-card active" data-dataset="churn">
                            <canvas class="dataset-preview" id="preview-churn"></canvas>
                            <h4>Customer Churn</h4>
                            <p class="dataset-desc">Will customers stay or leave?</p>
                        </div>
                        <div class="dataset-card" data-dataset="segment">
                            <canvas class="dataset-preview" id="preview-segment"></canvas>
                            <h4>Market Segments</h4>
                            <p class="dataset-desc">Identify customer groups</p>
                        </div>
                        <div class="dataset-card" data-dataset="abtest">
                            <canvas class="dataset-preview" id="preview-abtest"></canvas>
                            <h4>A/B Test</h4>
                            <p class="dataset-desc">Predict which version converts</p>
                        </div>
                        <div class="dataset-card" data-dataset="affinity">
                            <canvas class="dataset-preview" id="preview-affinity"></canvas>
                            <h4>Product Affinity</h4>
                            <p class="dataset-desc">Who will buy together?</p>
                        </div>
                    </div>
                    
                    <!-- Scenario Details -->
                    <div class="scenario-details" id="scenarioDetails">
                        <h4 style="font-size: 0.9em; margin-bottom: 8px;">Current Scenario:</h4>
                        <p id="scenarioDescription" style="font-size: 0.85em; line-height: 1.5; color: #2c3e50;">
                            Predict customer churn based on pricing and service quality. 
                            <strong style="color: #3498db;">Blue</strong> = likely to stay, 
                            <strong style="color: #e74c3c;">Red</strong> = likely to churn.
                        </p>
                        <button class="btn btn-secondary" id="viewDataBtn" style="width: 100%; margin-top: 10px; font-size: 0.85em;">
                            üëÅÔ∏è View Sample Data
                        </button>
                    </div>
                </div>
                
                <!-- Data Settings -->
                <div class="control-section advanced-controls">
                    <h3>‚öôÔ∏è Data Settings</h3>
                    <div class="control-group">
                        <label>
                            Noise Level 
                            <span class="help-icon" title="Add randomness to make the pattern harder to learn (simulates real-world messiness)">‚ìò</span>
                            : <span class="value-display" id="noiseValue">0%</span>
                        </label>
                        <input type="range" id="noise" min="0" max="50" value="0" step="1">
                    </div>
                    <div class="control-group">
                        <label>
                            Training Data 
                            <span class="help-icon" title="% of data used to teach the network (rest is used to test how well it learned)">‚ìò</span>
                            : <span class="value-display" id="trainSplitValue">70%</span>
                        </label>
                        <input type="range" id="trainSplit" min="50" max="90" value="70" step="5">
                    </div>
                </div>
                
                <div class="section-divider"></div>

                <!-- Input Features -->
                <div class="control-section model-section">
                    <h3>üß† Step 2: Design Your Model</h3>
                    <p style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 15px;">
                        Configure what information the network uses and how it processes it.
                    </p>
                    
                    <h4 style="font-size: 0.9em; margin-bottom: 10px;">
                        Input Features 
                        <span class="help-icon" title="Variables the network uses to make predictions. Start with basic features (X, Y), then add engineered features to capture complex patterns">‚ìò</span>
                    </h4>
                    <div class="feature-selector">
                        <label class="feature-checkbox">
                            <input type="checkbox" name="feature" value="price" checked>
                            <span><span id="label-x">Variable X</span> 
                                <span class="help-icon" title="First variable (changes based on scenario)">‚ìò</span>
                            </span>
                        </label>
                        <label class="feature-checkbox">
                            <input type="checkbox" name="feature" value="quality" checked>
                            <span><span id="label-y">Variable Y</span> 
                                <span class="help-icon" title="Second variable (changes based on scenario)">‚ìò</span>
                            </span>
                        </label>
                        <label class="feature-checkbox">
                            <input type="checkbox" name="feature" value="priceSquared">
                            <span><span id="label-x2">X¬≤</span> 
                                <span class="help-icon" title="Captures curved relationships - helps when medium values are best or worst">‚ìò</span>
                            </span>
                        </label>
                        <label class="feature-checkbox">
                            <input type="checkbox" name="feature" value="qualitySquared">
                            <span><span id="label-y2">Y¬≤</span> 
                                <span class="help-icon" title="Captures curved relationships in Y variable">‚ìò</span>
                            </span>
                        </label>
                        <label class="feature-checkbox">
                            <input type="checkbox" name="feature" value="interaction">
                            <span><span id="label-xy">X √ó Y</span> 
                                <span class="help-icon" title="Captures how X and Y work together - useful for XOR-like patterns">‚ìò</span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Network Architecture -->
                <div class="control-section model-section">
                    <h4 style="font-size: 0.9em; margin-bottom: 10px;">
                        Network Architecture 
                        <span class="help-icon" title="The 'brain' structure: layers are levels of processing, neurons are the processing units">‚ìò</span>
                    </h4>
                    <div class="control-group">
                        <label>
                            Hidden Layers 
                            <span class="help-icon" title="More layers = can learn more complex patterns, but takes longer to train">‚ìò</span>
                            : <span class="value-display" id="layersValue">1</span>
                        </label>
                        <input type="range" id="hiddenLayers" min="0" max="4" value="1" step="1">
                    </div>
                    <div class="control-group">
                        <label>
                            Neurons per Layer 
                            <span class="help-icon" title="More neurons = more processing power per layer">‚ìò</span>
                            : <span class="value-display" id="neuronsValue">4</span>
                        </label>
                        <input type="range" id="neuronsPerLayer" min="2" max="8" value="4" step="1">
                    </div>
                </div>

                <!-- Learning Settings -->
                <div class="control-section advanced-controls model-section">
                    <h4 style="font-size: 0.9em; margin-bottom: 10px;">Advanced Model Settings</h4>
                    <div class="control-group">
                        <label>
                            Learning Speed 
                            <span class="help-icon" title="How fast the network adjusts. Too fast = unstable, too slow = takes forever">‚ìò</span>
                            : <span class="value-display" id="learningRateValue">0.03</span>
                        </label>
                        <input type="range" id="learningRate" min="0.001" max="0.1" value="0.03" step="0.001">
                    </div>
                    <div class="control-group">
                        <label>
                            Transformation Type 
                            <span class="help-icon" title="How neurons process information. ReLU is most common for modern networks">‚ìò</span>
                        </label>
                        <select id="activation">
                            <option value="relu">ReLU (Recommended)</option>
                            <option value="tanh" selected>Tanh</option>
                            <option value="sigmoid">Sigmoid</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>
                            Complexity Penalty 
                            <span class="help-icon" title="Prevents overfitting by keeping weights small. L2 is most common">‚ìò</span>
                        </label>
                        <select id="regularization">
                            <option value="none" selected>None (Simpler)</option>
                            <option value="L1">L1</option>
                            <option value="L2">L2</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Visualization Panel -->
            <div class="visualization-panel">
                <!-- Step 3: Model Training -->
                <div class="training-section">
                    <div class="section-header">
                        <h2>üéØ Step 3: Model Training
                            <span class="help-icon" title="Watch as the network learns patterns by adjusting its internal weights. Blue lines = positive connections, red = negative">‚ìò</span>
                        </h2>
                        <div class="control-buttons">
                            <button class="btn btn-primary" id="playPauseBtn">
                                <span id="playPauseIcon">‚ñ∂</span> Start Training
                            </button>
                            <button class="btn btn-secondary" id="stepBtn">Step</button>
                            <button class="btn btn-danger" id="resetBtn">Reset</button>
                        </div>
                    </div>

                    <div class="training-grid">
                        <!-- Network Architecture Visualization -->
                        <div class="network-viz-box">
                            <h3>Network Architecture 
                                <span class="help-icon" title="Each circle is a neuron. Lines show connections. Thicker lines = stronger influence. Colors show if connection is positive (blue) or negative (red)">‚ìò</span>
                            </h3>
                            <canvas id="networkCanvas"></canvas>
                        </div>

                        <!-- Training Progress Chart -->
                        <div class="progress-viz-box">
                            <h3>Training Progress 
                                <span class="help-icon" title="Lower loss = better predictions. Orange line is training data (what it learns from). Green line is test data (how well it generalizes)">‚ìò</span>
                            </h3>
                            <canvas id="lossChart"></canvas>
                            
                            <!-- Metrics -->
                            <div class="metrics-row">
                                <div class="metric-mini">
                                    <span class="metric-label">Iterations</span>
                                    <span class="metric-value" id="iterations">0</span>
                                </div>
                                <div class="metric-mini">
                                    <span class="metric-label">Train Loss</span>
                                    <span class="metric-value" id="trainLoss">0.000</span>
                                </div>
                                <div class="metric-mini">
                                    <span class="metric-label">Test Loss</span>
                                    <span class="metric-value" id="testLoss">0.000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-divider" style="margin: 30px 0;"></div>

                <!-- Step 4: Model Validation -->
                <div class="validation-section">
                    <div class="section-header">
                        <h2>‚úÖ Step 4: Model Validation
                            <span class="help-icon" title="See how well your trained model performs on NEW data it has never seen before. This tests if it truly learned the pattern or just memorized the training data">‚ìò</span>
                        </h2>
                    </div>

                    <div class="validation-grid">
                        <!-- Decision Boundary Visualization -->
                        <div class="boundary-viz-box">
                            <h3>Decision Boundary 
                                <span class="help-icon" title="The colored background shows what the model predicts for every possible input. Blue regions = model predicts positive outcome, red = negative outcome">‚ìò</span>
                            </h3>
                            <canvas id="boundaryCanvas"></canvas>
                            <p style="font-size: 0.85em; color: #7f8c8d; margin-top: 10px; text-align: center;">
                                Background colors = model's predictions | Dots = actual data points
                            </p>
                        </div>

                        <!-- Validation Metrics -->
                        <div class="validation-metrics-box">
                            <h3>Performance on Unseen Data 
                                <span class="help-icon" title="These metrics show how well the model performs on test data it wasn't trained on - the true test of whether it learned the pattern">‚ìò</span>
                            </h3>
                            
                            <div class="metric-card-large">
                                <h4>Test Accuracy</h4>
                                <div class="value-large" id="accuracy">--</div>
                                <p style="font-size: 0.85em; color: #7f8c8d; margin-top: 8px;">
                                    Percentage of test data points correctly classified
                                </p>
                            </div>

                            <div class="validation-explanation">
                                <h4>ü§î Understanding Validation</h4>
                                <ul style="font-size: 0.9em; line-height: 1.8; color: #2c3e50;">
                                    <li><strong>Test data</strong> (dots on decision boundary) were NOT used during training</li>
                                    <li><strong>Good fit:</strong> Model performs similarly on training and test data</li>
                                    <li><strong>Overfitting:</strong> Great on training, poor on test = memorized instead of learned</li>
                                    <li><strong>Underfitting:</strong> Poor on both = model is too simple for the pattern</li>
                                </ul>
                                
                                <div id="validationInsight" style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-radius: 6px; font-size: 0.9em;">
                                    <strong>üí° Current Model Status:</strong>
                                    <p id="validationStatus" style="margin: 5px 0 0 0;">Train your model to see validation results...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Preview Modal -->
    <div id="dataModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; padding: 20px; overflow: auto;">
        <div style="max-width: 800px; margin: 50px auto; background: white; border-radius: 12px; padding: 30px; position: relative;">
            <button id="closeModal" style="position: absolute; top: 15px; right: 15px; background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px;">√ó</button>
            <h2 style="margin-top: 0;">üìä Sample Data Preview</h2>
            <div id="dataPreviewContent"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../../shared/js/auth_tracking.js"></script>
    <script src="../../../shared/js/auth_bar.js"></script>
    <script src="nn.js"></script>
    <script src="playground.js"></script>
</body>
</html>
