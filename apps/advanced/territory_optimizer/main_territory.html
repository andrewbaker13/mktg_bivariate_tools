<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sales Territory Optimizer</title>
  <link rel="stylesheet" href="../../../shared/css/main.css">
  <script src="../../../shared/js/tracking.js"></script>
  <link rel="stylesheet" href="../../../shared/css/auth_bar.css">
  <link rel="stylesheet" href="main_territory.css">
  
  <!-- Leaflet for mapping -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  
  <!-- Turf.js for geospatial operations -->
  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
  
  <!-- Plotly for charts -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-290ZJ9RE04"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-290ZJ9RE04');
  </script>
</head>

<body>
  <div class="auth-bar">
    <div class="auth-bar__container">
      <div></div>
      <div id="auth-bar-content" class="auth-bar__links">
        <a href="../../../admin_pages/login.html">Login</a>
        <a href="../../../admin_pages/register.html">Create Account</a>
      </div>
    </div>
  </div>

  <header class="intro hero-header">
    <div class="hero-header__top">
      <h1>Sales Territory Optimizer</h1>
      <div class="hero-context">
        <span class="badge">Sales Operations</span>
        <span class="badge badge--secondary">Optimization</span>
      </div>
    </div>
    <p class="hero-header__lede">
      Assign accounts to sales representatives optimizing for workload balance, travel efficiency, and revenue coverage. Upload your data, run optimization algorithms, or manually draw territories and compare outcomes.
    </p>
  </header>

  <main class="app-main">
    <!-- Overview Section -->
    <section class="test-overview">
      <h2>OVERVIEW &amp; APPROACH</h2>
      <div class="card">
        <p>
          <strong>Sales territory optimization</strong> is a classic operations research problem: partition a set of accounts among sales reps to maximize coverage while respecting constraints like workload capacity and travel limits.
        </p>
        <details class="additional-notes" open>
          <summary>Key Optimization Objectives</summary>
          <div class="objectives-grid">
            <div class="objective-item">
              <strong>Workload Balance</strong>
              <p>Distribute accounts so each rep has similar total potential (weighted by deal size, probability, etc.)</p>
            </div>
            <div class="objective-item">
              <strong>Travel Efficiency</strong>
              <p>Minimize total distance reps must travel from their home base to assigned accounts</p>
            </div>
            <div class="objective-item">
              <strong>Revenue Alignment</strong>
              <p>Match high-performing reps with high-potential accounts to maximize expected revenue</p>
            </div>
            <div class="objective-item">
              <strong>Territory Compactness</strong>
              <p>Create geographically contiguous territories that are easy to cover efficiently</p>
            </div>
          </div>
        </details>
        <details class="additional-notes">
          <summary>Algorithms Available</summary>
          <ul>
            <li><strong>Balanced K-Means:</strong> Iteratively clusters accounts around rep locations, respecting capacity constraints. Fast and produces compact territories.</li>
            <li><strong>Greedy Nearest Neighbor:</strong> Assigns each account to the nearest available rep. Simple baseline for comparison.</li>
            <li><strong>Weighted Voronoi:</strong> Partitions space based on rep "influence" (location + capacity). Visual and intuitive.</li>
          </ul>
          
          <details class="algorithm-advanced">
            <summary>üî¨ Advanced: Algorithm Mathematics</summary>
            
            <div class="algorithm-detail">
              <h4>1. Balanced K-Means Clustering</h4>
              <p class="algo-overview">A capacity-constrained variant of K-means that ensures balanced workload distribution.</p>
              
              <div class="algo-math">
                <p><strong>Objective Function:</strong></p>
                <p class="formula">min Œ£·µ¢ Œ£‚±º‚ààC·µ¢ ‚Äñx‚±º - Œº·µ¢‚Äñ¬≤ ¬∑ w‚±º</p>
                <p>Where:</p>
                <ul>
                  <li><em>x‚±º</em> = location of account j (lat, lng)</li>
                  <li><em>Œº·µ¢</em> = centroid of cluster i (rep home location)</li>
                  <li><em>w‚±º</em> = account weight (annual_potential √ó close_probability)</li>
                  <li><em>C·µ¢</em> = set of accounts assigned to rep i</li>
                </ul>
                
                <p><strong>Capacity Constraint:</strong></p>
                <p class="formula">|C·µ¢| ‚â§ max_accounts_i &nbsp;‚àÄi</p>
                
                <p><strong>Algorithm Steps:</strong></p>
                <ol>
                  <li><strong>Initialize:</strong> Set cluster centers Œº·µ¢ to rep home locations</li>
                  <li><strong>Assignment:</strong> For each account, compute distance to all reps:<br>
                    <span class="formula">d(x‚±º, Œº·µ¢) = ‚àö[(lat‚±º - lat·µ¢)¬≤ + (lng‚±º - lng·µ¢)¬≤ √ó cos¬≤(lat)]</span><br>
                    Assign to nearest rep with available capacity</li>
                  <li><strong>Update:</strong> Recalculate centroids as weighted mean of assigned accounts</li>
                  <li><strong>Iterate:</strong> Repeat steps 2-3 until convergence (max 50 iterations)</li>
                </ol>
                
                <p><strong>Complexity:</strong> O(n √ó k √ó iterations) where n = accounts, k = reps</p>
              </div>
            </div>
            
            <div class="algorithm-detail">
              <h4>2. Greedy Nearest Neighbor</h4>
              <p class="algo-overview">A simple heuristic that makes locally optimal choices at each step.</p>
              
              <div class="algo-math">
                <p><strong>Decision Rule:</strong></p>
                <p class="formula">assign(a‚±º) = argmin·µ¢ { d(a‚±º, r·µ¢) : |C·µ¢| < max_i }</p>
                
                <p><strong>Distance Calculation (Haversine):</strong></p>
                <p class="formula">d = 2R √ó arcsin(‚àö[sin¬≤(Œîlat/2) + cos(lat‚ÇÅ)cos(lat‚ÇÇ)sin¬≤(Œîlng/2)])</p>
                <p>Where R = 3959 miles (Earth radius)</p>
                
                <p><strong>Algorithm Steps:</strong></p>
                <ol>
                  <li>Sort accounts by priority score: <span class="formula">score = potential √ó probability</span></li>
                  <li>For each account (highest priority first):
                    <ul>
                      <li>Calculate distance to all reps with available capacity</li>
                      <li>Assign to the nearest available rep</li>
                      <li>Decrement that rep's remaining capacity</li>
                    </ul>
                  </li>
                </ol>
                
                <p><strong>Complexity:</strong> O(n √ó k) - very fast but not globally optimal</p>
                <p><strong>Limitation:</strong> Does not consider account value when assigning, only distance</p>
              </div>
            </div>
            
            <div class="algorithm-detail">
              <h4>3. Weighted Voronoi Tessellation</h4>
              <p class="algo-overview">Partitions space into regions where each point is "closest" to a rep, with distance weighted by rep capacity.</p>
              
              <div class="algo-math">
                <p><strong>Power Distance:</strong></p>
                <p class="formula">pow(x, s·µ¢) = ‚Äñx - s·µ¢‚Äñ¬≤ - w·µ¢</p>
                <p>Where w·µ¢ is the "power" weight for rep i (derived from capacity)</p>
                
                <p><strong>Voronoi Cell Definition:</strong></p>
                <p class="formula">V·µ¢ = { x ‚àà ‚Ñù¬≤ : pow(x, s·µ¢) ‚â§ pow(x, s‚±º) ‚àÄj ‚â† i }</p>
                
                <p><strong>Weight Calculation:</strong></p>
                <p class="formula">w·µ¢ = (max_accounts_i / Œ£‚±º max_accounts_j) √ó scaling_factor</p>
                <p>Higher capacity reps have larger "territories of influence"</p>
                
                <p><strong>Algorithm Steps:</strong></p>
                <ol>
                  <li>Calculate weight w·µ¢ for each rep based on capacity proportion</li>
                  <li>For each account location x:
                    <ul>
                      <li>Compute power distance to all reps</li>
                      <li>Assign to rep with minimum power distance</li>
                    </ul>
                  </li>
                  <li>Apply capacity constraints (reassign overflow to next-nearest)</li>
                </ol>
                
                <p><strong>Properties:</strong></p>
                <ul>
                  <li>Creates visually intuitive, contiguous regions</li>
                  <li>Naturally balances territory size with rep capacity</li>
                  <li>Cell boundaries are hyperbolic arcs (not straight lines)</li>
                </ul>
              </div>
            </div>
          </details>
        </details>
        <details class="additional-notes">
          <summary>How Scoring Works</summary>
          <p>Each territory is scored on four dimensions:</p>
          <ul>
            <li><strong>Balance (CV):</strong> Coefficient of variation of workload across reps. Lower = more balanced.</li>
            <li><strong>Travel:</strong> Average miles from rep home to assigned accounts. Lower = more efficient.</li>
            <li><strong>Revenue Alignment:</strong> Correlation between rep effectiveness and territory potential. Higher = better matching.</li>
            <li><strong>Compactness:</strong> Ratio of territory area to convex hull. Higher = tighter clustering.</li>
          </ul>
          
          <details class="algorithm-advanced">
            <summary>üî¨ Advanced: Scoring Mathematics</summary>
            
            <div class="algorithm-detail">
              <h4>Balance Score (Workload Equity)</h4>
              <p class="algo-overview">Measures how evenly work is distributed. Uses inverse coefficient of variation.</p>
              
              <div class="algo-math">
                <p><strong>Workload per Rep:</strong></p>
                <p class="formula">W·µ¢ = Œ£‚±º‚ààC·µ¢ (potential‚±º √ó probability‚±º)</p>
                
                <p><strong>Coefficient of Variation:</strong></p>
                <p class="formula">CV = œÉ(W) / Œº(W) = ‚àö[Œ£(W·µ¢ - WÃÑ)¬≤ / n] / WÃÑ</p>
                
                <p><strong>Balance Score:</strong></p>
                <p class="formula">Balance = max(0, 100 √ó (1 - CV))</p>
                <p>Perfect balance (CV=0) ‚Üí 100%. High variation (CV‚â•1) ‚Üí 0%</p>
              </div>
            </div>
            
            <div class="algorithm-detail">
              <h4>Travel Efficiency Score</h4>
              <p class="algo-overview">Penalizes total distance reps must travel to reach their accounts.</p>
              
              <div class="algo-math">
                <p><strong>Total Travel Distance:</strong></p>
                <p class="formula">D·µ¢ = Œ£‚±º‚ààC·µ¢ haversine(rep·µ¢, account‚±º)</p>
                
                <p><strong>Haversine Formula:</strong></p>
                <p class="formula">d = 2R √ó arcsin(‚àö[sin¬≤(ŒîœÜ/2) + cos(œÜ‚ÇÅ)cos(œÜ‚ÇÇ)sin¬≤(ŒîŒª/2)])</p>
                <p>Where œÜ = latitude (radians), Œª = longitude (radians), R = 3959 mi</p>
                
                <p><strong>Travel Score:</strong></p>
                <p class="formula">Travel = 100 √ó max(0, 1 - (avg_distance / max_travel))</p>
                <p>Where max_travel is the configured constraint (default 75 miles)</p>
              </div>
            </div>
            
            <div class="algorithm-detail">
              <h4>Revenue Alignment Score</h4>
              <p class="algo-overview">Measures correlation between rep effectiveness and territory value.</p>
              
              <div class="algo-math">
                <p><strong>Territory Value:</strong></p>
                <p class="formula">V·µ¢ = Œ£‚±º‚ààC·µ¢ (potential‚±º √ó probability‚±º)</p>
                
                <p><strong>Pearson Correlation:</strong></p>
                <p class="formula">r = Œ£(e·µ¢ - ƒì)(V·µ¢ - VÃÑ) / ‚àö[Œ£(e·µ¢ - ƒì)¬≤ √ó Œ£(V·µ¢ - VÃÑ)¬≤]</p>
                <p>Where e·µ¢ = effectiveness of rep i</p>
                
                <p><strong>Revenue Score:</strong></p>
                <p class="formula">Revenue = 50 √ó (1 + r)</p>
                <p>Perfect positive correlation (r=1) ‚Üí 100%<br>
                   No correlation (r=0) ‚Üí 50%<br>
                   Negative correlation (r=-1) ‚Üí 0%</p>
              </div>
            </div>
            
            <div class="algorithm-detail">
              <h4>Compactness Score</h4>
              <p class="algo-overview">Measures how tightly clustered accounts are within each territory.</p>
              
              <div class="algo-math">
                <p><strong>Convex Hull:</strong></p>
                <p>The smallest convex polygon containing all points in a territory.</p>
                
                <p><strong>Dispersion Metric:</strong></p>
                <p class="formula">dispersion·µ¢ = avg_distance_to_centroid / hull_radius</p>
                
                <p><strong>Compactness Score:</strong></p>
                <p class="formula">Compactness = 100 √ó (1 - avg_dispersion)</p>
                <p>Tightly clustered accounts ‚Üí higher score<br>
                   Scattered/fragmented territories ‚Üí lower score</p>
                
                <p><strong>Alternative: Isoperimetric Quotient</strong></p>
                <p class="formula">Q = 4œÄA / P¬≤</p>
                <p>Where A = area, P = perimeter. A circle has Q=1 (maximum compactness)</p>
              </div>
            </div>
            
            <div class="algorithm-detail">
              <h4>Overall Score</h4>
              <p class="algo-overview">Weighted combination of all four metrics.</p>
              
              <div class="algo-math">
                <p><strong>Default Weights:</strong></p>
                <p class="formula">Overall = 0.25√óBalance + 0.25√óTravel + 0.25√óRevenue + 0.25√óCompactness</p>
                <p>Equal weighting by default, but can be adjusted via the weight sliders in settings.</p>
              </div>
            </div>
          </details>
        </details>
      </div>
    </section>

    <!-- Mode Toggle -->
    <section class="mode-section">
      <h2>DATA INPUT MODE</h2>
      <div class="card">
        <div class="mode-toggle">
          <button class="mode-button active" data-mode="demo">
            <span class="mode-icon">üìä</span>
            <span class="mode-label">Demo Scenario</span>
          </button>
          <button class="mode-button" data-mode="upload">
            <span class="mode-icon">üì§</span>
            <span class="mode-label">Upload Data</span>
          </button>
          <button class="mode-button" data-mode="manual">
            <span class="mode-icon">‚úèÔ∏è</span>
            <span class="mode-label">Manual Draw</span>
          </button>
        </div>
        <p class="mode-description" id="mode-description">
          Explore pre-built marketing scenarios with realistic account and rep data.
        </p>
      </div>
    </section>

    <!-- Demo Scenario Section -->
    <section id="scenario-section" class="scenario-section">
      <h2>MARKETING SCENARIOS</h2>
      <div class="card">
        <div class="scenario-controls">
          <label for="scenario-select">Load a territory scenario:</label>
          <div class="scenario-controls__input">
            <select id="scenario-select">
              <option value="">-- Select a scenario --</option>
              <option value="san_diego">San Diego Tech Sales</option>
              <option value="regional_b2b">Regional B2B Sales Team (NYC Metro)</option>
              <option value="retail_expansion">Retail Expansion (Chicago)</option>
              <option value="pharma_reps">Pharmaceutical Sales (Northeast)</option>
            </select>
          </div>
        </div>
        <div id="scenario-description" class="scenario-description"></div>
      </div>
    </section>
    
    <!-- Data Overview Section (visible when data is loaded, regardless of mode) -->
    <section id="data-overview-section" class="data-overview-section hidden">
      <h2>LOADED DATA OVERVIEW</h2>
      <div class="card">
        <details class="constraints-panel" open>
          <summary>
            <span class="constraints-title">Scenario Constraints & Data</span>
            <span class="constraints-summary" id="constraints-summary"></span>
          </summary>
          <div class="constraints-content">
            <div class="constraints-lock-row">
              <label class="lock-toggle">
                <input type="checkbox" id="lock-constraints" checked>
                <span>Lock constraints to scenario defaults</span>
              </label>
            </div>
            
            <div class="constraints-grid">
              <!-- Sales Force Section -->
              <div class="constraint-section">
                <h4>Sales Force</h4>
                <div class="constraint-row">
                  <label>Number of Reps</label>
                  <input type="number" id="constraint-num-reps" min="1" max="20" disabled>
                </div>
                <div class="constraint-row">
                  <label>Max Accounts/Rep</label>
                  <input type="number" id="constraint-max-accounts" min="1" max="100" disabled>
                </div>
                <div class="constraint-row">
                  <label>Max Travel (mi)</label>
                  <input type="number" id="constraint-max-travel" min="1" max="500" disabled>
                </div>
              </div>
              
              <!-- Territory Section -->
              <div class="constraint-section">
                <h4>Territory Metrics</h4>
                <div class="constraint-row">
                  <label>Total Accounts</label>
                  <span class="constraint-value" id="constraint-total-accounts">--</span>
                </div>
                <div class="constraint-row">
                  <label>Total Potential</label>
                  <span class="constraint-value" id="constraint-total-potential">--</span>
                </div>
                <div class="constraint-row">
                  <label>Avg Close Prob</label>
                  <span class="constraint-value" id="constraint-avg-prob">--</span>
                </div>
              </div>
              
              <!-- Rep Details Section -->
              <div class="constraint-section constraint-section--wide">
                <h4>Sales Rep Details</h4>
                <div class="rep-table-wrapper">
                  <table class="rep-table" id="constraint-rep-table">
                    <thead>
                      <tr>
                        <th>Rep</th>
                        <th>Location</th>
                        <th>Max Accts</th>
                        <th>Max Travel</th>
                        <th>Effectiveness</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              
              <!-- Account Details Section -->
              <div class="constraint-section constraint-section--wide">
                <h4>Account Details <span class="accounts-count" id="accounts-table-count"></span></h4>
                <div class="accounts-table-wrapper">
                  <table class="accounts-table" id="constraint-accounts-table">
                    <thead>
                      <tr>
                        <th>Account</th>
                        <th>Location</th>
                        <th>Annual Potential</th>
                        <th>Close Prob</th>
                        <th>Industry</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
                <div class="accounts-table-toggle" id="accounts-toggle-row">
                  <button id="toggle-all-accounts" class="secondary small">Show all accounts</button>
                </div>
              </div>
            </div>
            
            <!-- Download Button -->
            <div class="constraints-actions">
              <button id="download-scenario-data" class="secondary small">
                <span>üì•</span> Download Scenario Data (CSV)
              </button>
            </div>
          </div>
        </details>
      </div>
    </section>

    <!-- Upload Section (hidden by default) -->
    <section id="upload-section" class="upload-section hidden">
      <h2>UPLOAD YOUR DATA</h2>
      <div class="card">
        <div class="upload-grid">
          <!-- Accounts Upload -->
          <div class="upload-box">
            <h3>Accounts / Prospects</h3>
            <p class="panel-intro">
              CSV with account locations, potential value, and close probability.
            </p>
            <div class="dropzone" id="accounts-dropzone" role="button" tabindex="0">
              <p class="dropzone-title">Drag & Drop accounts file</p>
              <p class="dropzone-note">.csv or .tsv with headers</p>
              <button type="button" id="accounts-browse" class="secondary">Browse</button>
            </div>
            <input type="file" id="accounts-input" accept=".csv,.tsv,.txt" hidden>
            <div class="template-buttons">
              <button type="button" id="accounts-template-download" class="secondary small">Download template</button>
            </div>
            <p class="upload-status" id="accounts-upload-status">No file uploaded.</p>
          </div>
          
          <!-- Reps Upload -->
          <div class="upload-box">
            <h3>Sales Representatives</h3>
            <p class="panel-intro">
              CSV with rep locations, capacity constraints, and effectiveness.
            </p>
            <div class="dropzone" id="reps-dropzone" role="button" tabindex="0">
              <p class="dropzone-title">Drag & Drop reps file</p>
              <p class="dropzone-note">.csv or .tsv with headers</p>
              <button type="button" id="reps-browse" class="secondary">Browse</button>
            </div>
            <input type="file" id="reps-input" accept=".csv,.tsv,.txt" hidden>
            <div class="template-buttons">
              <button type="button" id="reps-template-download" class="secondary small">Download template</button>
            </div>
            <p class="upload-status" id="reps-upload-status">No file uploaded.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Manual Draw Instructions (hidden by default) -->
    <section id="manual-section" class="manual-section hidden">
      <h2>MANUAL TERRITORY DRAWING</h2>
      <div class="card">
        <div class="manual-steps">
          <p><strong>Step 1:</strong> Load a scenario first (select from dropdown above) or upload your data.</p>
          <p><strong>Step 2:</strong> Use the polygon/rectangle tools (top-left of map) to draw territories.</p>
          <p><strong>Step 3:</strong> After drawing, you'll be prompted to assign the area to a rep.</p>
          <p><strong>Step 4:</strong> Click "Score My Territories" to compare against the algorithm.</p>
        </div>
        <div class="manual-scenario-loader">
          <label for="manual-scenario-select">Quick load scenario:</label>
          <select id="manual-scenario-select">
            <option value="">-- Select a scenario --</option>
            <option value="san_diego">San Diego Tech Sales</option>
            <option value="regional_b2b">NYC Metro B2B</option>
            <option value="retail_expansion">Chicago Retail</option>
            <option value="pharma_reps">Northeast Pharma</option>
          </select>
        </div>
        <div class="manual-controls">
          <button id="clear-drawings" class="secondary">Clear All Drawings</button>
          <button id="score-manual" class="primary" disabled>Score My Territories</button>
        </div>
        <p class="muted" id="manual-status">Load data first, then draw polygons on the map.</p>
      </div>
    </section>

    <!-- Configuration Panel -->
    <section id="config-section" class="config-section">
      <h2>OPTIMIZATION SETTINGS</h2>
      <div class="card">
        <div class="config-grid">
          <!-- Algorithm Selection -->
          <div class="config-item">
            <label for="algorithm-select">Algorithm <span class="tooltip-icon" data-tooltip="Different algorithms produce different territory shapes. K-Means creates balanced clusters, Greedy builds territories one account at a time, and Voronoi creates geometric regions around each rep.">‚ìò</span></label>
            <select id="algorithm-select">
              <option value="kmeans" selected>Balanced K-Means</option>
              <option value="greedy">Greedy Nearest Neighbor</option>
              <option value="voronoi">Weighted Voronoi</option>
            </select>
          </div>
          
          <!-- Priority -->
          <div class="config-item">
            <label>Optimization Priority <span class="tooltip-icon" data-tooltip="Sets the primary goal when there are trade-offs. Balance = even workloads across reps. Travel = shortest routes. Revenue = highest-value accounts grouped strategically.">‚ìò</span></label>
            <div class="radio-group">
              <label><input type="radio" name="priority" value="balance" checked> Balance workloads</label>
              <label><input type="radio" name="priority" value="travel"> Minimize travel</label>
              <label><input type="radio" name="priority" value="revenue"> Maximize revenue</label>
            </div>
          </div>
          
          <!-- Constraints -->
          <div class="config-item">
            <label for="max-accounts">Max Accounts per Rep <span class="tooltip-icon" data-tooltip="Hard limit on accounts per rep. Prevents overloading‚Äîa rep with 50+ accounts may not have time to service them all effectively.">‚ìò</span></label>
            <input type="number" id="max-accounts" min="1" max="100" value="30">
          </div>
          
          <div class="config-item">
            <label for="max-travel">Max Travel (miles) <span class="tooltip-icon" data-tooltip="Maximum daily driving distance. Reduces windshield time and ensures reps can actually visit their assigned accounts.">‚ìò</span></label>
            <input type="number" id="max-travel" min="1" max="500" value="75">
          </div>
        </div>
        
        <!-- Weight Sliders -->
        <div class="weight-sliders">
          <h4>Scoring Weights <span class="tooltip-icon" data-tooltip="Unlike traditional optimization with a single objective, territory design must balance multiple competing goals. These weights let you control how much each factor matters when scoring solutions. Higher weight = more influence on the final score.">‚ìò</span></h4>
          <p class="weight-intro">Adjust how much each factor influences the overall territory score. Most real-world optimization has a single goal; territory design requires balancing several.</p>
          <div class="slider-row">
            <label>Potential Weight <span class="tooltip-icon" data-tooltip="How much account revenue potential matters. Higher values reward territories with more high-value accounts. Practical impact: Sales teams often want their best reps covering highest-potential areas.">‚ìò</span></label>
            <input type="range" id="weight-potential" min="0" max="1" step="0.1" value="0.8">
            <span id="weight-potential-value">0.8</span>
          </div>
          <div class="slider-row">
            <label>Probability Weight <span class="tooltip-icon" data-tooltip="How much conversion likelihood matters. Higher values favor territories with 'sure wins' over uncertain prospects. Practical impact: Risk-averse strategies prioritize probability over upside.">‚ìò</span></label>
            <input type="range" id="weight-probability" min="0" max="1" step="0.1" value="0.6">
            <span id="weight-probability-value">0.6</span>
          </div>
          <div class="slider-row">
            <label>Travel Cost Weight <span class="tooltip-icon" data-tooltip="How much driving distance matters. Higher values penalize scattered territories. Practical impact: High travel costs eat into margins‚Äîreps spending 4+ hours driving have less selling time.">‚ìò</span></label>
            <input type="range" id="weight-travel" min="0" max="1" step="0.1" value="0.4">
            <span id="weight-travel-value">0.4</span>
          </div>
        </div>
        
        <div class="action-buttons">
          <button id="run-optimization" class="primary" disabled>Run Optimization</button>
        </div>
      </div>
    </section>

    <!-- Map Visualization -->
    <section id="map-section" class="map-section">
      <h2>TERRITORY MAP</h2>
      <div class="card map-card">
        <div class="map-controls">
          <label for="map-style">Map Style:</label>
          <select id="map-style">
            <option value="minimal" selected>Minimal (Light)</option>
            <option value="standard">Standard</option>
            <option value="dark">Dark</option>
          </select>
          <button id="reset-view" class="secondary small" title="Reset to show all accounts">Reset View</button>
        </div>
        <div id="territory-map" class="territory-map"></div>
        <div class="map-legend" id="map-legend">
          <p class="muted">Load data to see territories</p>
        </div>
      </div>
    </section>

    <!-- Scorecard -->
    <section id="scorecard-section" class="scorecard-section hidden">
      <h2>TERRITORY SCORECARD</h2>
      <div class="card">
        <div class="scorecard-grid">
          <div class="score-item">
            <div class="score-label">Balance</div>
            <div class="score-bar">
              <div class="score-fill" id="score-balance" style="width: 0%"></div>
            </div>
            <div class="score-value" id="score-balance-value">--</div>
          </div>
          <div class="score-item">
            <div class="score-label">Travel Efficiency</div>
            <div class="score-bar">
              <div class="score-fill" id="score-travel" style="width: 0%"></div>
            </div>
            <div class="score-value" id="score-travel-value">--</div>
          </div>
          <div class="score-item">
            <div class="score-label">Revenue Alignment</div>
            <div class="score-bar">
              <div class="score-fill" id="score-revenue" style="width: 0%"></div>
            </div>
            <div class="score-value" id="score-revenue-value">--</div>
          </div>
          <div class="score-item">
            <div class="score-label">Compactness</div>
            <div class="score-bar">
              <div class="score-fill" id="score-compactness" style="width: 0%"></div>
            </div>
            <div class="score-value" id="score-compactness-value">--</div>
          </div>
        </div>
        <div class="overall-score">
          <span class="overall-label">Overall Score:</span>
          <span class="overall-value" id="overall-score">--</span>
        </div>
      </div>
    </section>

    <!-- Territory Breakdown -->
    <section id="breakdown-section" class="breakdown-section hidden">
      <h2>TERRITORY BREAKDOWN</h2>
      <div class="card">
        <div class="breakdown-grid" id="breakdown-grid">
          <!-- Dynamically populated -->
        </div>
      </div>
    </section>

    <!-- Comparison Section (for manual vs. algorithm) -->
    <section id="comparison-section" class="comparison-section hidden">
      <h2>YOUR TERRITORIES vs. ALGORITHM</h2>
      <div class="card">
        <p class="comparison-intro" id="comparison-intro"></p>
        <div class="comparison-grid">
          <div class="comparison-col">
            <h3>‚úèÔ∏è Your Hand-Drawn Territories</h3>
            <p class="comparison-subtitle">How your manual assignments scored</p>
            <div id="manual-scores"></div>
          </div>
          <div class="comparison-col comparison-col--algo">
            <h3>ü§ñ Algorithm Solution</h3>
            <p class="comparison-subtitle" id="algo-subtitle">Optimized using selected algorithm</p>
            <div id="algorithm-scores"></div>
          </div>
        </div>
        <div class="comparison-verdict" id="comparison-verdict"></div>
      </div>
    </section>

    <!-- Export Section -->
    <section id="export-section" class="export-section hidden">
      <h2>EXPORT RESULTS</h2>
      <div class="card">
        <div class="export-buttons">
          <button id="export-assignments" class="secondary">Download Assignments (CSV)</button>
          <button id="export-map" class="secondary">Download Map (PNG)</button>
          <button id="copy-summary" class="secondary">Copy Summary to Clipboard</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <div class="footer-inner">
        <div class="footer-meta">
            <span>Created: 2026-02-06</span>
            <span class="meta-separator">&bull;</span>
            <span>Last Updated: 2026-02-06</span>
        </div>
        <div class="footer-citation">
            <span class="citation-label">Cite this tool</span>
            <p class="citation-text">
                Baker, A. (2026). <em>Sales Territory Optimizer</em>. Marketing Analysis Tools.
                <br>
                <span style="font-size: 0.85em; color: #6b7280;">Retrieved from: https://drbakermarketing.com/apps/advanced/territory_optimizer/main_territory.html</span>
            </p>
        </div>
        <div class="footer-copyright">
            &copy; 2026 Andrew Baker. All rights reserved.
        </div>
    </div>
  </footer>

  <script src="main_territory.js"></script>
</body>

</html>
