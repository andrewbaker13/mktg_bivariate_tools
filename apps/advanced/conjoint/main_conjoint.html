<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conjoint Analysis & Simulation Tool</title>
  <!-- Shared design system -->
  <link rel="stylesheet" href="../../../shared/css/main.css">
  <link rel="stylesheet" href="../../../shared/css/auth_bar.css">
  <!-- App-specific overrides -->
  <link rel="stylesheet" href="main_conjoint.css">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-290ZJ9RE04"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-290ZJ9RE04');
  </script>
</head>

<body>
  <div class="auth-bar">
    <div class="auth-bar__container">
      <div></div>
      <div id="auth-bar-content" class="auth-bar__links">
        <a href="../../../admin_pages/login.html">Login</a>
        <a href="../../../admin_pages/register.html">Create Account</a>
      </div>
    </div>
  </div>

  <main class="app-main">
    <header class="intro hero-header">
      <div class="hero-header__top">
        <h1>Conjoint Analysis & Simulation Tool</h1>
        <div class="hero-context">
          <span class="badge">Analysis Tool</span>
          <a href="main_conjoint_creator.html" class="badge badge-secondary">Design Tool ‚Üí</a>
        </div>
      </div>
      <p class="hero-header__lede">
        Analyze choice-based conjoint (CBC) data to understand how customers value product attributes. Upload experiment data, estimate individual-level preferences (part-worth utilities), simulate market shares, and optimize product configurations for maximum profit.
      </p>
      
      <!-- Progressive Workflow Stepper -->
      <div class="workflow-stepper" id="conjoint-workflow-stepper">
        <div class="workflow-step" data-step="1">
          <div class="workflow-step__indicator">
            <span class="workflow-step__number">1</span>
            <span class="workflow-step__checkmark">‚úì</span>
          </div>
          <div class="workflow-step__label">Upload Data</div>
        </div>
        <div class="workflow-step__connector"></div>
        <div class="workflow-step" data-step="2">
          <div class="workflow-step__indicator">
            <span class="workflow-step__number">2</span>
            <span class="workflow-step__checkmark">‚úì</span>
          </div>
          <div class="workflow-step__label">Configure Attributes</div>
        </div>
        <div class="workflow-step__connector"></div>
        <div class="workflow-step" data-step="3">
          <div class="workflow-step__indicator">
            <span class="workflow-step__number">3</span>
            <span class="workflow-step__checkmark">‚úì</span>
          </div>
          <div class="workflow-step__label">Estimate Model</div>
        </div>
        <div class="workflow-step__connector"></div>
        <div class="workflow-step" data-step="4">
          <div class="workflow-step__indicator">
            <span class="workflow-step__number">4</span>
            <span class="workflow-step__checkmark">‚úì</span>
          </div>
          <div class="workflow-step__label">Analyze Results</div>
        </div>
        <div class="workflow-step__connector"></div>
        <div class="workflow-step" data-step="5">
          <div class="workflow-step__indicator">
            <span class="workflow-step__number">5</span>
            <span class="workflow-step__checkmark">‚úì</span>
          </div>
          <div class="workflow-step__label">Simulate Markets</div>
        </div>
      </div>
    </header>

    <section class="test-overview" aria-labelledby="test-overview-heading">
      <h2 id="test-overview-heading">TEST OVERVIEW &amp; EQUATIONS</h2>
      <div class="card">
        <p>
          <strong>Choice-based conjoint (CBC)</strong> analysis reveals how customers trade off product attributes when making purchase decisions. Each respondent completes multiple choice tasks where they select their preferred alternative from a set of products with varying attribute levels (brand, features, price, etc.).
        </p>
        <p>
          The tool estimates <strong>individual-level part-worth utilities</strong> using multinomial logit (MNL) regression. For each respondent \(i\), the utility of alternative \(j\) in task \(t\) is:
        </p>
        <p class="equation">
          $$
          U_{ijt} = \alpha_{j,i} + \sum_{a \in \text{cat}} \sum_{\ell} \beta_{a,\ell,i} \cdot I(\text{level}(a) = \ell) + \sum_{b \in \text{numeric}} \beta_{b,i} \cdot x_b + \beta_{\text{price},i} \cdot p_j
          $$
        </p>
        <p>
          where \(\alpha_{j,i}\) are alternative-specific constants (for competitor and "None" alternatives), \(\beta\) coefficients represent part-worth utilities for each attribute level, and \(\beta_{\text{price},i}\) captures price sensitivity.
        </p>
        <p>
          The probability respondent \(i\) chooses alternative \(j\) follows the multinomial logit:
        </p>
        <p class="equation">
          $$
          P(y_{it} = j) = \frac{\exp(U_{ijt})}{\sum_{k \in C_{it}} \exp(U_{ikt})}
          $$
        </p>
        <details class="intro-notes" open>
          <summary>Key Concepts</summary>
          <ul>
            <li><strong>Part-worth utilities:</strong> The value (in utility units) a customer assigns to each attribute level. Higher values = stronger preference.</li>
            <li><strong>Attribute importance:</strong> The range of utilities within an attribute divided by the sum of all ranges. Shows which attributes drive choice most.</li>
            <li><strong>Price coefficient:</strong> Usually negative; larger magnitude = more price-sensitive. Used for willingness-to-pay calculations.</li>
            <li><strong>Individual-level estimation:</strong> Each respondent gets their own coefficients, enabling segmentation and personalized simulations.</li>
            <li><strong>None alternative:</strong> Models the "no purchase" option with its own constant term per respondent.</li>
            <li><strong>Competitor alternatives:</strong> Real products with known attribute profiles, modeled via alternative-specific constants.</li>
          </ul>
        </details>
        <details class="intro-notes">
          <summary>Understanding the "None" Option (Opt-Out Modeling)</summary>
          <p><strong>How it works:</strong> The "None" alternative is modeled as a <strong>constant utility term</strong> (ASC_None) with no product attributes. This represents a respondent's baseline preference for "doing nothing" or "not purchasing."</p>
          <p><strong>Why constant-only?</strong> Since "None" has no tangible product features (no brand, no price, no screen size, etc.), its utility doesn't vary with attribute changes. It serves as a <strong>fixed outside option</strong> that respondents can always choose instead of any product.</p>
          <p><strong>Interpretation:</strong></p>
          <ul>
            <li><strong>Negative ASC_None</strong> (e.g., -2.5): Respondents generally prefer buying something over nothing. The more negative, the stronger the "must have a product" preference.</li>
            <li><strong>Positive ASC_None</strong> (e.g., +1.2): Respondents prefer doing nothing unless a product offers substantial utility. Indicates high barriers to purchase.</li>
            <li><strong>ASC_None ‚âà 0:</strong> Indifference between "None" and a product with baseline attribute levels. Market is highly competitive for attention.</li>
          </ul>
          <p><strong>In market simulation:</strong> When you change product configurations (e.g., lower price, better brand), the "None" utility stays constant while product utilities change. This allows realistic "no purchase" share predictions that reflect actual market opt-out rates.</p>
        </details>
        <details class="intro-notes">
          <summary>When to Use Conjoint Analysis</summary>
          <p>
            Use conjoint when you need to understand customer preferences for multi-attribute products or services. Common marketing applications:
          </p>
          <ul>
            <li>Product design: Which features drive purchase intent? What's the optimal feature set?</li>
            <li>Pricing strategy: How much can we charge for premium features? What's willingness-to-pay?</li>
            <li>Market simulation: If we launch Product A vs Product B, what market share will each capture?</li>
            <li>Competitive positioning: How do customers value our brand vs competitors?</li>
            <li>Segmentation: Do different customer segments value attributes differently?</li>
          </ul>
        </details>
      </div>
    </section>

    <section class="scenario-section" aria-labelledby="scenario-heading">
      <h2 id="scenario-heading">MARKETING SCENARIOS</h2>
      <div class="card">
        <div class="scenario-controls">
          <label for="scenario-select">Practical scenario</label>
          <div class="scenario-controls__input">
            <select id="scenario-select">
              <option value="">Manual upload (no preset)</option>
            </select>
            <button id="scenario-download" class="secondary hidden" type="button" disabled>Download scenario dataset</button>
          </div>
        </div>
        <div id="scenario-description">
          <p>Use presets to auto-load realistic CBC study data. The download button exposes the exact dataset so you can modify it in Excel before re-uploading.</p>
        </div>
      </div>
    </section>

    <section class="input-card" aria-labelledby="inputs-heading">
      <h2 id="inputs-heading">INPUTS &amp; SETTINGS</h2>
      <article class="card data-entry-card">
        <div class="input-header">
          <h3>Step 1: Get Your Data</h3>
        </div>

        <!-- Tab Navigation -->
        <div class="data-tabs">
          <button class="data-tab active" data-tab="upload">üì§ Upload Your Data</button>
          <button class="data-tab" data-tab="examples">üìö Try Example Dataset</button>
        </div>

        <!-- Upload Tab -->
        <div class="data-tab-content active" id="tab-upload">
          <div class="data-import-block">
            <p>
              Upload long-format CBC data where each row represents one alternative in one choice task for one respondent.
              Required columns: <code>respondent_id</code>, <code>task_id</code>, <code>alternative_id</code>, <code>chosen</code> (0/1), plus attribute columns.
            </p>
            <div id="conjoint-dropzone" class="dropzone" role="button" tabindex="0">
              <p class="dropzone-title">Drag &amp; drop CBC file</p>
              <p class="dropzone-note">CSV with respondent_id, task_id, alternative_id, chosen, and attribute columns</p>
              <button type="button" id="conjoint-browse" class="secondary">Browse files</button>
            </div>
            <input type="file" id="conjoint-input" accept=".csv,.tsv,.txt" hidden>
            <div class="template-buttons">
              <button type="button" id="conjoint-template-download">Download Blank Template</button>
            </div>
            <p id="conjoint-upload-feedback" class="upload-status" aria-live="polite">No file uploaded.</p>
          </div>
        </div>

        <!-- Examples Tab -->
        <div class="data-tab-content" id="tab-examples">
          <div class="example-datasets">
            <div class="example-card" data-example="smartphone">
              <div class="example-card__icon">üì±</div>
              <h4>Smartphone Preferences</h4>
              <p class="example-card__stats">200 respondents ‚Ä¢ 8 tasks per person ‚Ä¢ 3 attributes</p>
              <p class="example-card__description">
                Consumer preferences for smartphones with varying Brand (Apple, Samsung, Google), Storage (64GB, 128GB, 256GB), and Price ($599-$1099). 
                Includes "None" option to model opt-out behavior.
              </p>
              <p class="example-card__learning"><strong>Learning focus:</strong> Price sensitivity, brand equity, willingness-to-pay</p>
              <button class="primary" data-load="smartphone">Load Dataset</button>
            </div>

            <div class="example-card" data-example="coffee">
              <div class="example-card__icon">‚òï</div>
              <h4>Coffee Shop Attributes</h4>
              <p class="example-card__stats">150 respondents ‚Ä¢ 10 tasks per person ‚Ä¢ 4 attributes</p>
              <p class="example-card__description">
                Customer preferences for coffee shops varying by Atmosphere (Cozy, Modern, Minimalist), WiFi Quality (Fast, Slow, None), 
                Seating Availability (Limited, Moderate, Ample), and Price per Coffee ($3-$6).
              </p>
              <p class="example-card__learning"><strong>Learning focus:</strong> Service attributes, amenity tradeoffs, customer segmentation</p>
              <button class="primary" data-load="coffee">Load Dataset</button>
            </div>

            <div class="example-card" data-example="hotel">
              <div class="example-card__icon">üè®</div>
              <h4>Hotel Room Features</h4>
              <p class="example-card__stats">180 respondents ‚Ä¢ 12 tasks per person ‚Ä¢ 5 attributes</p>
              <p class="example-card__description">
                Business traveler preferences for hotel rooms with varying Location (Downtown, Airport, Suburb), Star Rating (3-star to 5-star),
                Free Breakfast (Yes/No), WiFi Speed (Basic, Premium), and Price per Night ($89-$289). Includes competitor hotels.
              </p>
              <p class="example-card__learning"><strong>Learning focus:</strong> Competitive positioning, feature bundling, market simulation</p>
              <button class="primary" data-load="hotel">Load Dataset</button>
            </div>
          </div>
        </div>

        <div class="input-group" id="conjoint-column-mapping" style="display:none;">
          <h3>Column Mapping</h3>
          <p class="hint">Map your CSV columns to the required CBC structure fields.</p>
          
          <div class="input-grid">
            <div>
              <label for="conjoint-respondent-col">Respondent ID Column</label>
              <select id="conjoint-respondent-col"></select>
            </div>
            <div>
              <label for="conjoint-task-col">Task ID Column</label>
              <select id="conjoint-task-col"></select>
            </div>
            <div>
              <label for="conjoint-alternative-col">Alternative ID Column</label>
              <select id="conjoint-alternative-col"></select>
            </div>
            <div>
              <label for="conjoint-chosen-col">Chosen (0/1) Column</label>
              <select id="conjoint-chosen-col"></select>
            </div>
          </div>
          <button type="button" id="conjoint-confirm-mapping" class="primary">Confirm Mapping</button>
        </div>

        <div class="input-group" id="conjoint-attribute-config" style="display:none;">
          <h3>Step 2: Configure Attributes</h3>
          <p class="hint">
            Configure each attribute's type and identify special alternatives (None, Competitors). 
            The tool will automatically dummy-code categorical attributes and create appropriate model terms.
          </p>
          
          <div id="conjoint-attribute-list" class="attribute-config-list">
            <!-- Populated dynamically -->
          </div>

          <h4>Special Alternatives</h4>
          <div class="input-grid">
            <div>
              <label for="conjoint-none-alternative">None/No-purchase alternative ID (optional)</label>
              <select id="conjoint-none-alternative">
                <option value="">-- No "None" option --</option>
              </select>
              <p class="hint">Select if your study includes a "no purchase" or "none of these" alternative.</p>
            </div>
          </div>

          <div>
            <label>Competitor alternative IDs (optional)</label>
            <div id="conjoint-competitor-list" class="competitor-checkbox-list">
              <!-- Populated with checkboxes for each unique alternative_id -->
            </div>
            <p class="hint">
              Check the boxes for real competitor products (e.g., "iPhone", "SamsungS20") that appeared in choice tasks. 
              These will be modeled with alternative-specific constants rather than decomposed attributes.
            </p>
          </div>
        </div>

        <div class="input-group" id="conjoint-estimation-controls" style="display:none;">
          <h3>Step 3: Estimate Individual Utilities
            <span class="help-icon">?
              <span class="help-popover">
                <div class="help-term">Hierarchical Bayes Estimation</div>
                Estimates individual-level preferences by "borrowing strength" across respondents. More accurate than aggregate models and enables segmentation & personalized simulations.
              </span>
            </span>
          </h3>
          <div class="input-grid">
            <div>
              <label for="conjoint-regularization">
                Regularization strength (L2)
                <span class="help-icon">?
                  <span class="help-popover">
                    <div class="help-term">Regularization (L2)</div>
                    Prevents overfitting by penalizing extreme coefficient values. Higher values = more conservative estimates. Default 1.0 works well for most CBC studies.
                  </span>
                </span>
              </label>
              <input type="number" id="conjoint-regularization" min="0" max="10" step="0.1" value="1.0">
              <p class="hint">Higher values reduce overfitting but may bias coefficients toward zero. Default 1.0 is suitable for most studies.</p>
            </div>
          </div>
          
          <button type="button" id="conjoint-estimate-model" class="primary">Estimate Individual Utilities</button>
          <p id="conjoint-estimation-status" class="upload-status" aria-live="polite"></p>
        </div>
      </article>

      <article class="card analysis-settings test-options">
        <h3>Analysis Settings</h3>
        <div class="input-group">
          <label for="conjoint-alpha">Significance level (&alpha;) for coefficient tests</label>
          <input type="number" id="conjoint-alpha" min="0.001" max="0.2" step="0.001" value="0.050">
          <p class="hint">Used for highlighting significant coefficients in the results table.</p>
        </div>
      </article>
    </section>

    <section class="visual-output" aria-labelledby="visual-output-heading" style="display:none;" id="conjoint-results-section">
      <h2 id="visual-output-heading">VISUAL OUTPUT</h2>
      
      <!-- Attribute Importance Card -->
      <div class="result-card">
        <div class="result-card__header">
          <span class="result-card__header-icon">üìä</span>
          <h3 class="result-card__header-title">Attribute Importance</h3>
          <span class="help-icon">?
            <span class="help-popover">
              <div class="help-term">Attribute Importance</div>
              Shows which product features drive customer choices most. Calculated as the utility range within each attribute divided by the sum of all ranges.
            </span>
          </span>
        </div>
        <div class="result-card__body">
          <div class="chart-placeholder" id="chart-importance"></div>
          <p class="chart-note">
            Shows which attributes drive choice decisions most. Higher bars = more influential attributes in purchase decisions.
          </p>
          
          <div class="insight-callout tip">
            <div class="insight-callout__icon">üí°</div>
            <div class="insight-callout__content">
              <div class="insight-callout__title">Marketing Insight</div>
              <p class="insight-callout__text">Attributes with &lt;10% importance have minimal impact on purchase decisions‚Äîconsider removing them from your product strategy or marketing communications. Focus resources on high-importance attributes where you have competitive advantages.</p>
            </div>
          </div>
        </div>
        <div class="result-card__actions">
          <button class="secondary" onclick="Plotly.downloadImage('chart-importance', {format: 'png', width: 1200, height: 600, filename: 'attribute_importance'})">üì• Export Chart (PNG)</button>
        </div>
      </div>

      <!-- Part-Worth Utilities Card -->
      <div class="result-card">
        <div class="result-card__header">
          <span class="result-card__header-icon">üìà</span>
          <h3 class="result-card__header-title">Part-Worth Utilities</h3>
          <span class="help-icon">?
            <span class="help-popover">
              <div class="help-term">Part-Worth Utilities</div>
              The value (in utility units) customers assign to each attribute level. Higher values indicate stronger preference. Use these to identify winning feature combinations.
            </span>
          </span>
        </div>
        <div class="result-card__body">
          <div class="chart-placeholder" id="chart-partworths"></div>
          <p class="chart-note">
            Average utility for each attribute level. Higher bars = more preferred. Compare within attributes to see which levels win.
          </p>
          
          <div class="insight-callout interpretation">
            <div class="insight-callout__icon">üìä</div>
            <div class="insight-callout__content">
              <div class="insight-callout__title">Interpretation Guide</div>
              <p class="insight-callout__text">Positive utilities indicate preference above the baseline; negative values indicate dispreference. A feature with +2.5 utility adds 2.5 units to total product utility. Combine high-utility levels from each attribute to design optimal products.</p>
            </div>
          </div>
        </div>
        <div class="result-card__actions">
          <button class="secondary" onclick="Plotly.downloadImage('chart-partworths', {format: 'png', width: 1200, height: 600, filename: 'partworth_utilities'})">üì• Export Chart (PNG)</button>
        </div>
      </div>

      <!-- Price Sensitivity Card -->
      <div class="result-card">
        <div class="result-card__header">
          <span class="result-card__header-icon">üí∞</span>
          <h3 class="result-card__header-title">Price Sensitivity Distribution</h3>
          <span class="help-icon">?
            <span class="help-popover">
              <div class="help-term">Price Sensitivity</div>
              Histogram of price coefficients across respondents. More negative values = more price-sensitive customers. Wide distribution suggests opportunities for segmentation.
            </span>
          </span>
        </div>
        <div class="result-card__body">
          <div class="chart-placeholder" id="chart-price-dist"></div>
          <p class="chart-note">
            Distribution of price coefficients across respondents. More negative = more price-sensitive.
          </p>
          
          <div class="insight-callout warning">
            <div class="insight-callout__icon">‚ö†Ô∏è</div>
            <div class="insight-callout__content">
              <div class="insight-callout__title">Common Mistake</div>
              <p class="insight-callout__text">Don't assume all customers have the same price sensitivity! A wide distribution justifies segmentation analysis and potentially tiered pricing strategies (economy, standard, premium).</p>
            </div>
          </div>
        </div>
        <div class="result-card__actions">
          <button class="secondary" onclick="Plotly.downloadImage('chart-price-dist', {format: 'png', width: 1200, height: 600, filename: 'price_sensitivity'})">üì• Export Chart (PNG)</button>
        </div>
      </div>
        </article>
      </div>
    </section>

    <section class="test-results" aria-labelledby="test-results-heading" style="display:none;" id="conjoint-test-results">
      <h2 id="test-results-heading">MODEL RESULTS</h2>
      
      <div class="card metrics-panel">
        <div class="metric-output">Total respondents estimated: <span id="conjoint-n-respondents">&ndash;</span></div>
        <div class="metric-output">Mean tasks per respondent: <span id="conjoint-mean-tasks">&ndash;</span></div>
        <div class="metric-output">
          Mean pseudo-R¬≤ (McFadden): <span id="conjoint-mean-r2">&ndash;</span>
          <span class="help-icon">?
            <span class="help-popover">
              <div class="help-term">Pseudo R¬≤</div>
              Measures model fit. >0.20 is good, >0.40 is excellent for conjoint analysis. Unlike regular R¬≤, this doesn't represent % variance explained‚Äîit's based on likelihood improvement.
            </span>
          </span>
        </div>
        <div class="metric-output">Estimation time: <span id="conjoint-estimation-time">&ndash;</span></div>
        <details class="interpretation-aid">
          <summary>Interpretation Aid</summary>
          <p class="muted"><strong>Pseudo-R¬≤:</strong> Measure of model fit per respondent. Values 0.2‚Äì0.4 are typical for CBC studies; higher values indicate stronger predictive power.</p>
          <p class="muted"><strong>Tasks per respondent:</strong> More tasks (12‚Äì20) produce more stable coefficient estimates. Fewer than 8 tasks may yield unreliable utilities.</p>
        </details>
      </div>

      <div class="dual-panels">
        <article class="card dual-panel">
          <h3>APA-Style Report</h3>
          <p id="conjoint-apa-report">Estimate the model to see the APA-style statistical report.</p>
        </article>
        <article class="card dual-panel">
          <h3>Managerial Interpretation</h3>
          <p id="conjoint-managerial-report">Business-focused interpretation will appear here after estimation.</p>
        </article>
      </div>

      <div class="card summary-table-card">
        <h3>Aggregated Part-Worth Utilities</h3>
        <table class="summary-table">
          <thead>
            <tr>
              <th>Attribute</th>
              <th>Level</th>
              <th>Mean Utility</th>
              <th>Std. Dev.</th>
              <th>Min</th>
              <th>Max</th>
            </tr>
          </thead>
          <tbody id="conjoint-utilities-table-body">
            <tr>
              <td colspan="6">Estimate the model to view aggregated part-worth utilities.</td>
            </tr>
          </tbody>
        </table>
        <details class="interpretation-aid" style="margin-top: 1rem;">
          <summary>How to Interpret Part-Worth Utilities</summary>
          <div class="interpretation-content">
            <p><strong>Mean Utility:</strong> Average part-worth value across all respondents. Higher utilities indicate stronger preference.</p>
            <ul>
              <li><strong>Categorical attributes</strong> (brand, camera): Each level gets a coefficient relative to a baseline (usually the first alphabetically). Positive values mean preference over baseline; negative means less preferred.</li>
              <li><strong>Linear attributes</strong> (price, screen_size): Single coefficient per attribute. Positive = "more is better" (e.g., bigger screen); negative = "less is better" (e.g., lower price).</li>
              <li><strong>None alternative (ASC_None):</strong> The constant utility for choosing "no purchase." This has no product attributes‚Äîit's a fixed outside option. Negative values mean respondents strongly prefer buying something; positive values indicate high barriers to purchase (people prefer doing nothing unless products offer substantial value).</li>
              <li><strong>Competitor alternatives (ASC_Competitor_*):</strong> Positive = brand loyalty to competitor; negative = preference for your brands.</li>
            </ul>
            <p><strong>Std. Dev.:</strong> Variation across respondents. High std dev (>0.5) suggests heterogeneous preferences‚Äîgood candidates for segmentation.</p>
            <p><strong>Min/Max:</strong> Range of individual utilities. Wide ranges indicate some respondents strongly prefer/dislike this level.</p>
          </div>
        </details>
        <p class="template-download">
          <button type="button" id="conjoint-download-utilities" class="secondary">
            Download individual utilities (CSV)
          </button>
          <button type="button" id="conjoint-view-individual" class="secondary">
            View individual respondent utilities
          </button>
        </p>
      </div>

      <div class="card" id="conjoint-individual-viewer" style="display:none;">
        <h3>Individual Respondent Utilities</h3>
        <div class="input-group">
          <label for="conjoint-respondent-select">Select Respondent:</label>
          <select id="conjoint-respondent-select" class="input-field">
            <option value="">-- Choose a respondent --</option>
          </select>
        </div>
        <div id="conjoint-individual-details" style="margin-top: 1rem;">
          <p class="muted">Select a respondent to view their estimated utilities and model fit.</p>
        </div>
      </div>
    </section>

    <section class="segmentation-section" aria-labelledby="segmentation-heading" style="display:none;" id="conjoint-segmentation">
      <h2 id="segmentation-heading">SEGMENTATION ANALYSIS</h2>
      <div class="card">
        <h3>K-Means Clustering on Utilities</h3>
        <p>
          Segment respondents based on their estimated part-worth utilities. Different segments may value attributes differently, enabling targeted product positioning and pricing strategies.
        </p>
        
        <div class="input-group">
          <label for="conjoint-n-clusters">Number of segments (k)</label>
          <input type="number" id="conjoint-n-clusters" min="2" max="6" step="1" value="3">
          <button type="button" id="conjoint-run-segmentation" class="primary">Run Segmentation</button>
          <p id="conjoint-segmentation-status" class="upload-status" aria-live="polite"></p>
        </div>

        <div id="conjoint-segment-results" style="display:none;">
          <h4>Segment Sizes</h4>
          <div class="chart-placeholder" id="chart-segment-sizes"></div>

          <h4>Segment Profiles: Attribute Importance</h4>
          <div class="chart-placeholder" id="chart-segment-importance"></div>
          <p class="chart-note">
            Compare which attributes drive choice for each segment. Use this to create segment-specific marketing messages and product bundles.
          </p>

          <h4>Segment-Level Mean Utilities</h4>
          <table class="summary-table" id="conjoint-segment-table">
            <thead>
              <tr>
                <th>Segment</th>
                <th>Size</th>
                <th>Mean Price Coefficient</th>
                <th>Top Valued Attribute</th>
              </tr>
            </thead>
            <tbody id="conjoint-segment-table-body">
              <!-- Populated dynamically -->
            </tbody>
          </table>
          
          <div id="conjoint-segment-details" style="margin-top: 2rem;">
            <!-- Segment utilities tables populated here -->
          </div>
        </div>
      </div>
    </section>

    <section class="simulation-section" aria-labelledby="simulation-heading" style="display:none;" id="conjoint-simulation">
      <h2 id="simulation-heading">MARKET SIMULATION</h2>
      <div class="card">
        <h3>Price Configuration</h3>
        <p>
          First, specify how price should be treated in the market simulation.
        </p>
        
        <div class="input-group">
          <label for="conjoint-price-mode">Price Treatment</label>
          <select id="conjoint-price-mode">
            <option value="attribute">Price is an attribute in the conjoint design (estimated utility coefficient)</option>
            <option value="fixed">Price was fixed in the conjoint design (not varied)</option>
            <option value="none">No pricing (free products/services)</option>
          </select>
          <p class="hint" id="price-mode-hint">
            If price was varied as an attribute, utilities can be translated into willingness-to-pay (WTP) values.
          </p>
        </div>
        
        <div id="price-wtp-options" style="display:none;">
          <div class="input-group">
            <label>
              <input type="checkbox" id="conjoint-show-wtp">
              Show Willingness-to-Pay (WTP) estimates
              <span class="help-icon">?
                <span class="help-popover">
                  <div class="help-term">Willingness-to-Pay (WTP)</div>
                  The dollar amount customers value a feature upgrade. Calculated as -Œîutility / price_coefficient. Use this for pricing decisions and ROI analysis.
                </span>
              </span>
            </label>
            <p class="hint">
              Calculate dollar value of each attribute level using the price coefficient. 
              WTP = -Œîutility / price_coefficient
            </p>
          </div>
        </div>
        </div>
      </div>

      <div class="card">
        <h3>Cost Structure</h3>
        <p>
          Define base costs and incremental costs for attribute levels to calculate profitability.
        </p>
        
        <div class="input-group">
          <label for="conjoint-base-cost">Base Cost (per unit)</label>
          <input type="number" id="conjoint-base-cost" min="0" step="0.01" value="0">
          <p class="hint">Fixed cost regardless of attribute configuration (e.g., core manufacturing cost).</p>
        </div>
        
        <div id="conjoint-incremental-costs">
          <h4>Incremental Costs by Attribute Level</h4>
          <p class="hint">
            Specify additional cost for each attribute level. Default is 0 (no cost impact). 
            Positive values increase cost, negative values decrease cost relative to baseline.
          </p>
          <div id="conjoint-cost-config-list">
            <!-- Dynamically populated with attribute level cost inputs -->
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Scenario Builder</h3>
        <p>
          Define a competitive scenario with multiple product alternatives. The tool will compute predicted market shares using the estimated individual utilities.
        </p>

        <div class="input-group">
          <label><strong>Simulation Options</strong></label>
          <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem;">
              <input type="checkbox" id="conjoint-force-choice" />
              <span>Force all to choose (exclude "None" option from simulation)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem;">
              <input type="checkbox" id="conjoint-ignore-competitors" />
              <span>Ignore competitors (exclude competitor products from simulation)</span>
            </label>
          </div>
          <p class="hint">By default, competitors and "None" (if present in study) are included in simulations. Use these options to run "must purchase" or "our brands only" scenarios.</p>
        </div>

        <div id="conjoint-auto-included-products" style="display:none; margin-bottom: 1rem; padding: 1rem; background: #e3f2fd; border-radius: 4px;">
          <p style="margin: 0 0 0.5rem; font-weight: 600;">Auto-Included in Simulation:</p>
          <ul id="conjoint-auto-list" style="margin: 0; padding-left: 1.5rem;">
            <!-- Auto-populated -->
          </ul>
        </div>

        <div class="simulation-controls">
          <button type="button" id="conjoint-add-product" class="secondary">+ Add Product Alternative</button>
          <button type="button" id="conjoint-clear-scenario" class="secondary">Clear Scenario</button>
        </div>

        <div id="conjoint-products-list" class="products-config-list">
          <!-- Product configuration cards populated here -->
        </div>

        <div class="input-group">
          <label for="conjoint-market-size">Total market size (customers)</label>
          <input type="number" id="conjoint-market-size" min="1" max="1000000000" step="1000" value="10000">
          <p class="hint">Used to convert share percentages into customer counts and total profit dollars.</p>
        </div>

        <button type="button" id="conjoint-run-simulation" class="primary">Run Market Simulation</button>
        <p id="conjoint-simulation-status" class="upload-status" aria-live="polite"></p>

        <div id="conjoint-simulation-results" style="display:none;">
          <h3>Simulation Results</h3>
          
          <div class="insight-callout interpretation">
            <div class="insight-callout__icon">üìä</div>
            <div class="insight-callout__content">
              <div class="insight-callout__title">Reading Your Results</div>
              <p class="insight-callout__text">Market share shows what % of customers prefer each option. If "None" captures >30% share, customers may not find current products compelling‚Äîconsider improving core features or adjusting prices. Compare profit (not just share) to identify the optimal product configuration.</p>
            </div>
          </div>
          
          <div class="chart-grid">
            <article class="chart-card">
              <h3>Market Share by Alternative</h3>
              <div class="chart-placeholder" id="chart-sim-share"></div>
              <p class="chart-note">
                Predicted preference share based on individual-level utilities averaged across all respondents.
              </p>
            </article>

            <article class="chart-card">
              <h3>Total Profit by Alternative</h3>
              <div class="chart-placeholder" id="chart-sim-profit"></div>
              <p class="chart-note">
                Profit = Share √ó Market Size √ó (Price - Cost). Identifies which products maximize revenue.
              </p>
            </article>
          </div>

          <table class="summary-table">
            <thead>
              <tr id="conjoint-sim-table-header">
                <th>Product</th>
                <th>Market Share (%)</th>
                <th>Customer Count</th>
                <th>Price</th>
                <th>Cost</th>
                <th>Margin</th>
                <th>Total Profit</th>
                <!-- WTP column added dynamically if price is an attribute -->
              </tr>
            </thead>
            <tbody id="conjoint-simulation-table-body">
              <!-- Populated dynamically -->
            </tbody>
          </table>

          <div id="conjoint-wtp-details" style="display:none;">
            <h4>Willingness-to-Pay (WTP) Analysis</h4>
            <p class="hint">
              WTP represents the dollar value customers place on each attribute level relative to the baseline. 
              Calculated as: WTP = -Œîutility / price_coefficient
            </p>
            <table class="summary-table">
              <thead>
                <tr>
                  <th>Attribute</th>
                  <th>Level</th>
                  <th>Mean WTP ($)</th>
                  <th>Std Dev ($)</th>
                </tr>
              </thead>
              <tbody id="conjoint-wtp-table-body">
                <!-- Populated dynamically -->
              </tbody>
            </table>
          </div>

          <p class="template-download">
            <button type="button" id="conjoint-download-simulation" class="secondary">
              Download simulation results (CSV)
            </button>
          </p>
        </div>
      </div>
    </section>

    <section class="optimization-section" aria-labelledby="optimization-heading" style="display:none;" id="conjoint-optimization">
      <h2 id="optimization-heading">PRODUCT OPTIMIZATION</h2>
      <div class="card">
        <h3>Brute-Force Configuration Search</h3>
        <p>
          Explore all possible combinations of attribute levels to find the product configuration that maximizes market share or profit. Useful for new product design decisions.
        </p>

        <div class="input-group">
          <h4>Select attributes to vary</h4>
          <div id="conjoint-optimize-attributes" class="optimize-attribute-list">
            <!-- Checkboxes for each attribute -->
          </div>
        </div>

        <div class="input-group">
          <label for="conjoint-optimize-metric">Optimization goal</label>
          <select id="conjoint-optimize-metric">
            <option value="share">Maximize Market Share</option>
            <option value="profit">Maximize Profit</option>
          </select>
        </div>

        <div class="input-group" id="conjoint-optimize-price-range" style="display:none;">
          <h4>Price range to test</h4>
          <div class="input-grid">
            <div>
              <label for="conjoint-price-min">Min price</label>
              <input type="number" id="conjoint-price-min" step="0.01" value="0">
            </div>
            <div>
              <label for="conjoint-price-max">Max price</label>
              <input type="number" id="conjoint-price-max" step="0.01" value="100">
            </div>
            <div>
              <label for="conjoint-price-step">Price increment</label>
              <input type="number" id="conjoint-price-step" step="0.01" value="10">
            </div>
            <div>
              <label for="conjoint-optimize-cost">Fixed unit cost</label>
              <input type="number" id="conjoint-optimize-cost" step="0.01" value="30">
            </div>
          </div>
        </div>

        <button type="button" id="conjoint-run-optimization" class="primary">Run Optimization</button>
        <p id="conjoint-optimization-status" class="upload-status" aria-live="polite"></p>

        <div id="conjoint-optimization-results" style="display:none;">
          <h3>Top 10 Configurations</h3>
          <table class="summary-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Configuration</th>
                <th>Market Share (%)</th>
                <th>Profit</th>
              </tr>
            </thead>
            <tbody id="conjoint-optimization-table-body">
              <!-- Populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="diagnostics-section" aria-labelledby="diagnostics-heading" style="display:none;" id="conjoint-diagnostics">
      <h2 id="diagnostics-heading">DIAGNOSTICS &amp; ASSUMPTIONS</h2>
      <div class="card">
        <details class="diagnostics-details" open>
          <summary>Model Assumptions &amp; Data Quality Checks</summary>
          <div id="conjoint-diagnostics-content">
            <p class="muted">Estimate the model to see diagnostic information.</p>
            
            <div class="diagnostic-section">
              <h4>CBC Study Design Requirements</h4>
              <ul>
                <li><strong>Sample size:</strong> Minimum 100‚Äì200 respondents for stable aggregate estimates; 200‚Äì500+ recommended for segmentation.</li>
                <li><strong>Tasks per respondent:</strong> 8‚Äì20 choice tasks provide reliable individual-level estimates. Fewer than 8 may yield unstable coefficients.</li>
                <li><strong>Alternatives per task:</strong> 3‚Äì5 alternatives per task is typical. Too few (2) limits information; too many (6+) increases cognitive burden.</li>
                <li><strong>Attribute levels:</strong> Use 3‚Äì5 levels per categorical attribute. Binary attributes provide limited information.</li>
                <li><strong>Orthogonality:</strong> Experimental design should minimize correlation between attributes. Check design quality in your CBC software.</li>
              </ul>
            </div>

            <div class="diagnostic-section">
              <h4>Model Assumptions</h4>
              <ul>
                <li><strong>IIA (Independence of Irrelevant Alternatives):</strong> MNL assumes adding/removing an alternative affects all others proportionally. Violated when alternatives are perceived as close substitutes.</li>
                <li><strong>Linear utility:</strong> Utilities are linear combinations of part-worths. May not hold for complex interactions or threshold effects.</li>
                <li><strong>Homogeneous preferences (at individual level):</strong> Each respondent has stable preferences across tasks. Violated if respondents use different decision rules in different tasks.</li>
                <li><strong>No outside information:</strong> Respondents base choices only on information presented in the task. Violated if they apply external knowledge about brands or features.</li>
              </ul>
            </div>

            <div class="diagnostic-section" id="conjoint-data-quality">
              <!-- Populated after estimation -->
            </div>
          </div>
        </details>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <p class="page-timestamps">Created: <span id="created-date">2025-12-07</span> &middot; Last updated: <span id="modified-date">2025-12-07</span></p>
    <p><a href="../../../index.html">Back to Stat Analysis Selection</a></p>
    <p class="citation">Cite as: Baker, Andrew. (2025). Conjoint Analysis & Simulation Tool. Marketing Bivariate Tools.</p>
  </footer>

  <div id="conjoint-loading-overlay" class="loading-overlay" aria-hidden="true">
    <div class="loading-modal">
      <div class="loading-spinner"></div>
      <h3>Estimating Individual Utilities</h3>
      <p id="loading-progress-text">Preparing data for estimation...</p>
      <p class="loading-detail">Processing your conjoint data. This typically takes 10-60 seconds depending on dataset size.</p>
      <div class="loading-stats">
        <span id="loading-respondents">Respondents: <strong>--</strong></span>
        <span id="loading-tasks">Tasks: <strong>--</strong></span>
      </div>
    </div>
  </div>

  <script src="../../../shared/js/csv_utils.js"></script>
  <script src="../../../shared/js/ui_utils.js"></script>
  <script src="../../../shared/js/auth_tracking.js"></script>
  <script src="../../../shared/js/auth_bar.js"></script>
  <script src="../../../shared/js/quiz_utils.js"></script>
  <script src="conjoint_app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      initQuizButton('conjoint');
    });
  </script>
</body>

</html>
