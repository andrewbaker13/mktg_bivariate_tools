<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multinomial Logistic Regression Tool</title>
  <!-- Shared design system -->
  <link rel="stylesheet" href="../../shared/css/main.css">
  <!-- App-specific overrides -->
  <link rel="stylesheet" href="main_mn_log_regression.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="../../shared/js/csv_utils.js"></script>
  <script src="../../shared/js/fan_chart_utils.js"></script>
  <script src="../../shared/js/stacked_bar_utils.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <!-- This template mirrors the shared layout so new tools can copy/paste sections quickly. -->
  <main class="app-main">
    <header class="intro hero-header">
      <div class="hero-header__top">
        <h1>Multinomial Logistic Regression Tool</h1>
        <div class="hero-context">
          <span class="badge">Design prototype</span>
        </div>
      </div>
      <p class="hero-header__lede">
        Explore multinomial logistic regression for marketing outcomes with more than two categories (for example,
        multi-level brand choice or multi-step funnel stage). Upload raw data, select the outcome and predictors, and
        compare predicted class probabilities with diagnostics.
      </p>
    </header>

    <section class="test-overview" aria-labelledby="test-overview-heading">
      <h2 id="test-overview-heading">TEST OVERVIEW &amp; EQUATIONS</h2>
      <div class="card">
        <p>
          Multinomial logistic regression is used when the outcome has more than two unordered categories
          (for example, <em>Brand A / Brand B / Brand C</em> or <em>aware / considering / ready to buy</em>).
          It models how a set of predictors changes the probability of landing in each category, relative to a
          chosen reference outcome.
        </p>
        <p>
          For each non-reference outcome category \(j\), the model estimates a separate log-odds equation relative
          to the reference category \(\text{ref}\):
        </p>
        <p class="equation">
          $$
          \log \frac{P(Y = j)}{P(Y = \text{ref})}
          = \beta_{0j} + \beta_{1j} x_1 + \cdots + \beta_{pj} x_p,\quad j = 1, \ldots, K - 1.
          $$
        </p>
        <p>
          These log-odds are converted into predicted probabilities using the multinomial logistic (softmax) link:
        </p>
        <p class="equation">
          $$
          P(Y = j) = \frac{\exp(\eta_j)}{1 + \sum_{h \neq \text{ref}} \exp(\eta_h)},\quad
          P(Y = \text{ref}) = \frac{1}{1 + \sum_{h \neq \text{ref}} \exp(\eta_h)}
          $$
          where \(\eta_j = \beta_{0j} + \beta_{1j} x_1 + \cdots + \beta_{pj} x_p\).
        </p>
        <details class="intro-notes" open>
          <summary>Additional Notes / Formulas</summary>
          <p>
            Choosing the reference outcome category changes the interpretation of coefficients but not the underlying
            probabilities. A positive coefficient \(\beta_{kj}\) means that as predictor \(x_k\) increases, outcome
            \(j\) becomes more likely relative to the reference category, holding other predictors constant.
          </p>
          <p>
            This tool focuses on predicted probabilities and pseudo-\(R^2\) as the primary outputs. Traditional
            inferential details (standard errors, Wald tests, and confidence intervals for each coefficient) are not
            yet implemented and should be computed in a dedicated statistical package if required.
          </p>
        </details>
      </div>
    </section>

    <section class="scenario-section" aria-labelledby="scenario-heading">
      <h2 id="scenario-heading">MARKETING SCENARIOS</h2>
      <div class="card">
        <div class="scenario-controls">
          <label for="scenario-select">Practical scenario</label>
          <div class="scenario-controls__input">
            <select id="scenario-select">
              <option value="">Manual inputs (no preset)</option>
            </select>
            <button id="scenario-download" class="secondary hidden" type="button" disabled>Download scenario dataset</button>
          </div>
        </div>
        <div id="scenario-description">
          <p>Use presets to auto-load realistic marketing inputs, text, and any CSV/TSV data required for uploads. The download button exposes the exact dataset used so editors can tweak it in Excel or Numbers before re-uploading.</p>
        </div>
      </div>
    </section>

    <section class="input-card" aria-labelledby="inputs-heading">
      <h2 id="inputs-heading">INPUTS &amp; SETTINGS</h2>
      <article class="card data-entry-card">
        <div class="input-header">
          <h3>Select Data Entry / Upload Mode</h3>
        </div>
        <div class="mode-toggle" role="tablist" aria-label="Data entry mode">
          <button type="button" class="mode-button active" data-mode="manual">Manual entry</button>
          <button type="button" class="mode-button" data-mode="summary-upload">Upload summary inputs</button>
          <button type="button" class="mode-button" data-mode="raw-upload">Upload raw data</button>
        </div>

        <div class="input-group">
          <h3>Outcome &amp; Reference Category</h3>
          <p class="hint">
            Choose the multinomial outcome (with 2 or more categories) and which outcome level should serve as the
            reference (baseline) category in the model. Coefficients and probability plots will be interpreted relative
            to this reference outcome.
          </p>
          <label for="mnlog-outcome-select">Outcome variable (Y)</label>
          <select id="mnlog-outcome-select"></select>
          <label for="mnlog-outcome-ref-select">Reference outcome category</label>
          <select id="mnlog-outcome-ref-select"></select>
        </div>

        <div class="input-group">
          <h3>Select predictors</h3>
            <p class="hint">
              Check the box for each predictor you want to include in the model. For categorical predictors, the app will
              create one coefficient per non-reference category. For continuous predictors, the app will estimate a single
              slope per outcome contrast.
            </p>
          <div id="mnlog-predictor-list" class="predictor-list stacked"></div>
        </div>

        <div class="input-group">
          <button type="button" id="mnlog-run-model" class="primary">Run multinomial model</button>
          <p id="mnlog-run-status" class="upload-status" aria-live="polite"></p>
        </div>
        <div class="mode-panels">
          <div class="mode-panel active" data-mode="manual" id="template-manual-panel">
            <article class="group-controls placeholder-group-card">
              <h4>Manual summaries</h4>
              <p>Use this structure whenever the test accepts aggregated inputs (means, standard deviations, proportions, etc.). Labels persist so scenarios and uploads overwrite them cleanly.</p>
              <div class="input-grid">
                <div>
                  <label for="group-a">Group A summary</label>
                  <input id="group-a" type="number" placeholder="e.g., mean or proportion">
                </div>
                <div>
                  <label for="group-b">Group B summary</label>
                  <input id="group-b" type="number" placeholder="e.g., mean or proportion">
                </div>
              </div>
              <p class="hint">For multi-group tools swap this grid for a table so column labels render once.</p>
            </article>
          </div>
          <div class="mode-panel" data-mode="summary-upload" id="template-summary-panel">
            <div class="data-import-block">
              <h4>Upload summary inputs</h4>
              <p>Default template fields are <code>group,conversions,sample_size,delta0,alpha,notes</code> so stakeholders can capture both aggregated stats and the hypothesized difference/confidence level in one file. Adjust the headers to whatever summaries your test needs (means, SDs, totals, etc.), and remind users if your app only accepts two groups.</p>
              <div id="template-summary-dropzone" class="dropzone" role="button" tabindex="0">
                <p class="dropzone-title">Drag &amp; drop summary file</p>
                <p class="dropzone-note">Up to 2,000 rows. Each row represents one group or condition.</p>
                <button type="button" id="template-summary-browse" class="secondary">Browse files</button>
              </div>
              <input type="file" id="template-summary-input" accept=".csv,.tsv,.txt" hidden>
              <div class="template-buttons">
                <button type="button" id="template-summary-download">Download summary template</button>
              </div>
              <p id="template-summary-feedback" class="upload-status" aria-live="polite">No summary file uploaded.</p>
            </div>
          </div>
          <div class="mode-panel" data-mode="raw-upload" id="template-raw-panel">
            <div class="data-import-block">
              <h4>Upload raw long-format data</h4>
              <p>The template shows <code>group,value,channel,note</code> columns so end users can include the outcome plus optional metadata (channel, creative, timestamp). Customize those columns to the raw format your tool expects, and call out when only two group labels are allowed.</p>
              <div id="template-raw-dropzone" class="dropzone" role="button" tabindex="0">
                <p class="dropzone-title">Drag &amp; drop raw case file</p>
                <p class="dropzone-note">Two columns minimum: group label and numeric metric.</p>
                <button type="button" id="template-raw-browse" class="secondary">Browse files</button>
              </div>
              <input type="file" id="template-raw-input" accept=".csv,.tsv,.txt" hidden>
              <div class="template-buttons">
                <button type="button" id="template-raw-download">Download raw template</button>
              </div>
              <p id="template-raw-feedback" class="upload-status" aria-live="polite">No raw file uploaded.</p>
            </div>
          </div>
        </div>
      </article>

      <article class="card analysis-settings test-options">
        <h3>Analysis Settings</h3>
        <div class="confidence-buttons" role="group" aria-label="Select confidence level">
          <button class="confidence-button" data-level="0.90">90% Conf.</button>
          <button class="confidence-button active" data-level="0.95">95% Conf.</button>
          <button class="confidence-button" data-level="0.99">99% Conf.</button>
        </div>
        <div class="input-group">
          <label for="alpha">Significance level (&alpha;)</label>
          <input type="number" id="alpha" min="0.001" max="0.2" step="0.001" value="0.050">
        </div>
        <details class="advanced-details">
          <summary>Advanced analysis settings</summary>
          <p>Use this accordion for optional toggles (axis locks, alternative hypotheses, label editing, upload limits, etc.).</p>
        </details>
      </article>
    </section>

    <section class="visual-output" aria-labelledby="visual-output-heading">
      <h2 id="visual-output-heading">VISUAL OUTPUT</h2>
      <div class="card">
        <div class="chart-grid">
          <article class="chart-card">
            <h3>Predicted probabilities vs. focal predictor</h3>
            <div class="chart-placeholder" id="chart-a"></div>
            <p id="mnlog-effect-note" class="chart-note">
              After you upload data, choose an outcome, select at least one continuous predictor, and run the model, this chart will show one probability curve per non-reference outcome category as the focal predictor varies (holding other predictors at typical values).
            </p>
          </article>
          <article class="chart-card">
            <h3>Observed vs predicted outcome distribution</h3>
            <div class="chart-placeholder" id="chart-b"></div>
            <p class="chart-note">
              This bar chart compares how often each outcome category appears in the modeled data (observed) with the
              average predicted probability for each category (predicted). Use the controls below to switch between
              counts and percentages or to hide the predicted bars.
            </p>
          </article>
        </div>
      </div>
      <div class="card visual-output-settings">
        <details>
          <summary>Visual Output Settings</summary>
          <div class="visual-settings-grid">
            <label class="switch-option">
              <input type="checkbox" id="toggle-chart-mode" checked>
              <span>Show predicted distribution as well as observed</span>
            </label>
            <label>
              Y-axis scale
              <select id="visual-mode">
                <option value="rows">Counts</option>
                <option value="columns">Percent of modeled sample</option>
              </select>
            </label>
          </div>
        </details>
      </div>
    </section>

    <section class="test-results" aria-labelledby="test-results-heading">
      <h2 id="test-results-heading">TEST RESULTS</h2>
      <div class="card metrics-panel">
        <div class="metric-output">Model log-likelihood: <span id="statistic-value">&ndash;</span></div>
        <div class="metric-output">Approx. degrees of freedom: <span id="df-value">&ndash;</span></div>
        <div class="metric-output">p-value (not computed): <span id="p-value">&ndash;</span></div>
        <div class="metric-output">Pseudo-R&sup2; (McFadden): <span id="effect-size">&ndash;</span></div>
      </div>
      <div class="dual-panels">
        <article class="card dual-panel">
          <h3>APA-Style Report</h3>
          <p id="apa-report">Placeholder APA narrative will appear here.</p>
        </article>
        <article class="card dual-panel">
          <h3>Managerial Interpretation</h3>
          <p id="managerial-report">Business-focused copy referencing scenario inputs appears here.</p>
        </article>
      </div>
      <div class="card summary-table-card">
        <h3>Coefficient Table (log-odds relative to reference outcome)</h3>
        <table class="summary-table">
          <thead>
            <tr>
              <th>Outcome contrast</th>
              <th>Predictor term</th>
              <th>Coefficient (log-odds)</th>
            </tr>
          </thead>
          <tbody id="mnlog-coefficient-table-body">
            <tr>
              <td colspan="3">Run the model to view coefficients for each outcome category relative to the reference.</td>
            </tr>
          </tbody>
        </table>
        <p class="template-download">
          <button type="button" id="mnlog-download-results" class="secondary">
            Download predicted probabilities (CSV)
          </button>
        </p>
        <p class="hint">
          This download exports the original uploaded data plus one column for the most likely outcome category and one
          column per outcome with its predicted probability from the fitted multinomial model.
        </p>
      </div>
    </section>

    <section class="diagnostics-section" aria-labelledby="diagnostics-heading">
      <h2 id="diagnostics-heading">DIAGNOSTICS &amp; ASSUMPTIONS</h2>
      <div class="card">
        <details class="diagnostics-details">
          <summary>Diagnostics &amp; Assumption Tests</summary>
          <div id="diagnostics-content">
            <p>Explain assumption checks (sample size, variance, normality, expected counts, leverage points). Populate via JS.</p>
          </div>
        </details>
      </div>
    </section>
  </main>

    <footer class="app-footer">
    <p class="page-timestamps">Created: <span id="created-date">YYYY-MM-DD</span> &middot; Last updated: <span id="modified-date">YYYY-MM-DD</span></p>
      <p><a href="../../index.html">Back to Stat Analysis Selection</a></p>
      <p class="citation">Cite as: Baker, Andrew. (2025). Multinomial Logistic Regression Tool. Marketing Bivariate Tools.</p>
    </footer>

  <script src="../../shared/js/csv_utils.js"></script>
  <script src="../../shared/js/ui_utils.js"></script>
  <script src="mn_log_model.js"></script>
  <script src="main_mn_log_regression.js"></script>
</body>

</html>









