<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Selection Probability Lab</title>
  <link rel="stylesheet" href="../../shared/css/main.css">
  <link rel="stylesheet" href="selection_probability_lab.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <main class="app-main">
    <header class="intro hero-header">
      <div class="hero-header__top">
        <h1>Selection Probability Lab</h1>
        <div class="hero-context">
          <span class="badge">Sampling</span>
        </div>
      </div>
      <p class="hero-header__lede">
        Explore the probability that specific items are selected from a finite population. Adjust the population size,
        sample size, and number of special items, and compare exact math to simulated draws, with live equations that
        show how the formulas work for your inputs.
      </p>
    </header>

    <section class="test-overview" aria-labelledby="overview-heading">
      <h2 id="overview-heading">OVERVIEW &amp; CONCEPTS</h2>
      <div class="card">
        <p>
          This lab focuses on questions like: <em>"If I draw a sample of size \(n\) from a population of size \(N\),
          what is the chance that a particular set of \(r\) special items appears in my sample?"</em>. You can toggle
          between sampling <strong>without replacement</strong> (hypergeometric) and <strong>with replacement</strong>
          (binomial-style) frameworks.
        </p>
        <details class="intro-notes">
          <summary>Key ideas illustrated</summary>
          <p><strong>Hypergeometric model (without replacement):</strong> draws from a finite population where each
            individual can only be selected once. The number of special items in the sample follows a hypergeometric
            distribution.</p>
          <p><strong>Binomial model (with replacement):</strong> repeated independent draws with the same probability of
            selecting a special item on each draw. The number of special items in the sample follows a binomial
            distribution.</p>
          <p><strong>"At least one" logic:</strong> the probability of seeing at least one special item is computed via
            the complement: \(P(\text{at least one}) = 1 - P(\text{zero specials})\). The app shows this computation
            numerically and symbolically.</p>
        </details>
      </div>
    </section>

    <section class="scenario-section" aria-labelledby="scenario-heading">
      <h2 id="scenario-heading">MARKETING SCENARIOS</h2>
      <div class="card">
        <div class="scenario-controls">
          <label for="selection-scenario-select">Load a selection case study</label>
          <div class="scenario-controls__input">
            <select id="selection-scenario-select">
              <option value="">Manual settings (no preset)</option>
            </select>
          </div>
        </div>
        <div id="selection-scenario-description">
          <p>
            Use these presets to explore realistic selection questions, such as the chance a VIP customer appears in a sample,
            the probability of at least one high-value lead in repeated with-replacement draws, or the likelihood of finding
            a specific number of defects in a quality-control check.
          </p>
        </div>
      </div>
    </section>

    <section class="input-card" aria-labelledby="inputs-heading">
      <h2 id="inputs-heading">POPULATION &amp; SAMPLING SETTINGS</h2>
      <article class="card data-entry-card">
        <div class="input-header">
          <h3>Configure the scenario</h3>
        </div>

        <div class="input-grid">
          <div>
            <label for="population-size-input">Population size (\(N\))</label>
            <input type="number" id="population-size-input" min="1" max="5000" step="1" value="100">
            <p class="hint">Total number of items in the population.</p>
          </div>
          <div>
            <label for="sample-size-input">Sample size (\(n\))</label>
            <input type="number" id="sample-size-input" min="1" max="200" step="1" value="20">
            <p class="hint">Number of draws in each sample.</p>
          </div>
          <div>
            <label for="special-count-input">Number of special items (\(r\))</label>
            <input type="number" id="special-count-input" min="1" max="100" step="1" value="5">
            <p class="hint">How many specific items are considered "special" in the population.</p>
          </div>
          <div>
            <label for="success-count-input">Target count of specials in sample (\(k\))</label>
            <input type="number" id="success-count-input" min="0" max="20" step="1" value="1">
            <p class="hint">Used when computing \(P(K = k)\). For "at least one", the app uses the complement rule.</p>
          </div>
          <div>
            <label for="special-label-input">Label for the "special" outcome</label>
            <input type="text" id="special-label-input" maxlength="60" value="special" placeholder="e.g., opens email, is a VIP customer">
            <p class="hint">This short phrase will replace the word "special" in narrative descriptions (for example, "opens email" or "is a VIP customer").</p>
          </div>
        </div>

        <div class="input-grid" style="margin-top:0.75rem;">
          <div>
            <label for="sampling-mode-select">Sampling mode</label>
            <select id="sampling-mode-select">
              <option value="without_replacement" selected>Without replacement (hypergeometric)</option>
              <option value="with_replacement">With replacement (binomial approximation)</option>
            </select>
            <p class="hint">Switch between finite-population draws and independent draws with constant probability.</p>
          </div>
          <div>
            <label for="probability-mode-select">Probability of interest</label>
            <select id="probability-mode-select">
              <option value="exact_k" selected>Exact: \(P(K = k)\)</option>
              <option value="at_least_one">At least one: \(P(K \ge 1)\)</option>
            </select>
            <p class="hint">Choose whether to focus on a specific count or the chance of seeing at least one special item.</p>
          </div>
          <div>
            <label for="num-simulations-input">Number of simulated samples</label>
            <input type="number" id="num-simulations-input" min="100" max="5000" step="100" value="2000">
            <p class="hint">Used for Monte Carlo simulation to approximate the distribution.</p>
          </div>
        </div>

        <div style="margin-top:0.75rem;">
          <button type="button" id="simulate-once-btn" class="secondary">Draw one sample</button>
          <button type="button" id="simulate-many-btn" class="primary" style="margin-left:0.5rem;">Simulate many samples</button>
          <button type="button" id="clear-sim-btn" class="secondary" style="margin-left:0.5rem;">Clear simulation history</button>
        </div>
        <p id="sampling-warning" class="hint"></p>
        <details class="advanced-details" style="margin-top:0.75rem;">
          <summary>Additional info about these inputs</summary>
          <p>
            <strong>Population size \(N\):</strong> think of this as the full list of customers, items, or units you could sample from.
            In many marketing problems \(N\) is large but finite (panel members, current customers, emails on a list).
          </p>
          <p>
            <strong>Sample size \(n\):</strong> how many draws you make. For <em>without replacement</em>, this cannot exceed \(N\);
            for <em>with replacement</em> you can think of re-contacting or re-targeting with possible repeats.
          </p>
          <p>
            <strong>Special items \(r\):</strong> a fixed set you care about (VIP customers, high-value prospects, defective units).
            The model assumes these are known in advance and fixed inside the population.
          </p>
          <p>
            <strong>Target count \(k\):</strong> used for \(P(K = k)\). For example, \(k = 0\) is the probability you miss all specials;
            \(k = 2\) is the chance you get exactly two specials in the sample.
          </p>
          <p>
            <strong>Sampling mode:</strong> choose <em>without replacement</em> for one-off samples from a list,
            and <em>with replacement</em> for repeated, independent trials (like ad impressions) where the same unit could be sampled multiple times.
          </p>
        </details>
      </article>
    </section>

    <section class="visual-output" aria-labelledby="visual-output-heading">
      <h2 id="visual-output-heading">VISUAL OUTPUT</h2>
      <div class="card">
        <div class="chart-grid selection-lab-grid">
          <article class="chart-card">
            <h3>Population &amp; sampled items</h3>
            <div id="population-grid" class="population-grid selection-population-grid"></div>
            <p id="population-summary" class="chart-note">
              The grid shows the first \(N\) items in the population. Special items are highlighted; items included in the current sample are outlined.
            </p>
          </article>
          <article class="chart-card">
            <h3>Distribution of number of specials</h3>
            <div id="distribution-chart" class="chart-placeholder"></div>
            <p id="distribution-note" class="chart-note">
              The chart compares the <strong>theoretical distribution</strong> of \(K\), the number of special items in the sample,
              to the <strong>empirical distribution</strong> from simulated samples. Bars show probabilities for each possible value of \(K\);
              the orange bars are based on the number of simulated samples you have run.
            </p>
          </article>
        </div>
        <details class="intro-notes" style="margin-top:0.75rem;">
          <summary>How to read these visuals</summary>
          <p>
            The <strong>population grid</strong> shows which positions are special (highlighted) and which of those are captured in the
            current sample (outlined). This makes it easier to connect the abstract math to concrete draws.
          </p>
          <p>
            The <strong>distribution chart</strong> stacks probability mass across values of \(K\). Blue bars show the exact
            hypergeometric/binomial probabilities; orange bars show how often each value appeared in your simulated samples.
            As you increase the number of simulations, the orange bars should approach the blue bars.
          </p>
        </details>
      </div>
    </section>

    <section class="test-results" aria-labelledby="math-heading">
      <h2 id="math-heading">MATH DETAILS &amp; WORKED EXAMPLES</h2>
      <div class="card metrics-panel selection-math-panel">
        <div class="metric-output">
          <span>Exact probability (current mode):</span>
          <span id="metric-exact-prob" class="dynamic-value">&ndash;</span>
        </div>
        <div class="metric-output">
          <span>Simulated probability (current mode):</span>
          <span id="metric-sim-prob" class="dynamic-value">&ndash;</span>
        </div>
        <div class="metric-output">
          <span>Expected number of specials \(E[K]\):</span>
          <span id="metric-expected-k" class="dynamic-value">&ndash;</span>
        </div>
      </div>
      <div class="card" style="margin-top:0.75rem;">
        <details class="advanced-details">
          <summary>Interpreting these metrics</summary>
          <p>
            <strong>Exact probability:</strong> the value from the hypergeometric (no replacement) or binomial (with replacement)
            formula for your chosen mode (\(P(K = k)\) or \(P(K \ge 1)\)). This is the theoretical benchmark.
          </p>
          <p>
            <strong>Simulated probability:</strong> the proportion of simulated samples whose outcome matches the event of interest.
            With enough simulations, this should track the exact probability closely, illustrating the link between probability models
            and long-run frequencies.
          </p>
          <p>
            <strong>Expected number of specials \(E[K]\):</strong> the average number of specials you would see if you could repeat
            the sampling process many times. For both models, \(E[K] = n \cdot (r/N)\), but the distribution around that mean differs
            depending on whether you sample with or without replacement.
          </p>
        </details>
      </div>
      <div class="card" style="margin-top:0.75rem;">
        <details class="advanced-details">
          <summary>Understanding the \(\binom{n}{k}\) notation</summary>
          <p>
            In the equations below you will see expressions written as \(\binom{n}{k}\) or \(\binom{N}{n}\). This is read
            out loud as “<em>n choose k</em>” and it counts how many different groups of \(k\) items you can form from a
            larger pool of \(n\) items when order does not matter.
          </p>
          <p>
            For example, if there are \(n = 10\) customers and you want to know how many different samples of size \(k = 3\)
            you could draw, \(\binom{10}{3} = 120\). That means there are 120 distinct 3‑person groups you might see.
          </p>
          <p>
            Mathematically, \(\binom{n}{k}\) is computed as
            \[
              \binom{n}{k} = \frac{n!}{k!\,(n-k)!},
            \]
            where \(n!\) (“<em>n factorial</em>”) means \(n \times (n-1) \times \dots \times 2 \times 1\). In practice, the
            app uses a more numerically stable version of this calculation, but the idea is the same: it is counting how many
            ways you can choose positions for the “special” outcomes inside the sample.
          </p>
        </details>
      </div>

      <div class="dual-panels">
        <article class="card dual-panel">
          <h3>General equations</h3>
          <div id="equations-general">
            <!-- Filled dynamically with MathJax content -->
          </div>
        </article>
        <article class="card dual-panel">
          <h3>Worked with your numbers</h3>
          <div id="equations-worked">
            <!-- Filled dynamically with MathJax content -->
          </div>
        </article>
      </div>

      <div class="card" style="margin-top:1rem;">
        <h3>Exact vs. simulated distribution</h3>
        <div class="selection-table-wrapper">
          <table id="distribution-table">
            <thead>
              <tr>
                <th>k (number of specials)</th>
                <th>Theoretical P(K = k)</th>
                <th>Simulated frequency</th>
                <th>Simulated P(K = k)</th>
                <th>Cumulative P(K ≤ k)</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filled dynamically -->
            </tbody>
          </table>
        </div>
        <details class="advanced-details" style="margin-top:0.75rem;">
          <summary>How to read this table</summary>
          <p>
            <strong>k (number of specials):</strong> each row corresponds to a specific value of \(k\), the number of times the
            chosen outcome (your "special" label) occurs in the sample. The example row highlighted here corresponds to
            \(k =\) <span id="table-example-k">2</span>, meaning exactly that many specials are observed in the sample.
          </p>
          <p>
            <strong>Theoretical P(K = k):</strong> this column shows the exact probability that a random sample will contain
            exactly \(k\) specials, computed from the hypergeometric or binomial model. In your current table, the example row
            has theoretical probability <span id="table-example-theoretical">0.1800</span>.
          </p>
          <p>
            <strong>Simulated frequency:</strong> after you run simulations, this column counts how many of those simulated
            samples produced each value of \(k\). For the example row, the table shows
            <span id="table-example-frequency">360</span> out of
            <span id="table-example-total">2,000</span> simulated samples landing on that value of \(k\).
          </p>
          <p>
            <strong>Simulated P(K = k):</strong> this is the simulated frequency divided by the total number of simulations.
            In your current table, the example row has simulated probability
            <span id="table-example-simprob">0.1800</span>, which should be close to the theoretical value if you have run
            enough simulations.
          </p>
          <p>
            <strong>Cumulative P(K &le; k):</strong> this column adds up the theoretical probabilities from 0 up through that row’s
            value of \(k\). If the cumulative value in the row for \(k = 2\) is 0.6500, you can read that as “there is a 65%
            chance of seeing at most two specials in the sample.”
          </p>
        </details>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <p class="page-timestamps">Created: <span id="created-date">2025-11-25</span> &middot; Last updated:
      <span id="modified-date">2025-11-25</span>
    </p>
    <p><a href="../../index.html">Back to Stat Analysis Selection</a></p>
    <p class="citation">Cite as: Baker, Andrew. (2025). Selection Probability Lab. Marketing Bivariate Tools.</p>
  </footer>

  <script src="../../shared/js/ui_utils.js"></script>
  <script src="selection_probability_lab.js"></script>
</body>

</html>
