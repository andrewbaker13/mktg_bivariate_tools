<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One-Way ANOVA Explorer</title>
    <link rel="stylesheet" href="../../shared/css/main.css">
    <link rel="stylesheet" href="main_onewayanova.css">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="../../shared/js/fan_chart_utils.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header class="intro hero-header">
        <div class="hero-header__top">
            <h1>One-Way ANOVA Explorer</h1>
            <div class="hero-context">
                <span class="badge">Means tool</span>
            </div>
        </div>
        <p class="hero-header__lede">Evaluate how multiple group means compare to the overall mean with visuals, diagnostics, and narratives.</p>
    </header>

    <main class="app-main">
        <section class="test-overview">
            <h2>TEST OVERVIEW &amp; EQUATIONS</h2>
            <div class="card equation-section">
                <p>One-way ANOVA partitions variability into signal (between groups) and noise (within groups):</p>
                <div class="equation-display">
                    \[
                    \begin{aligned}
                    \mathrm{SS}_{\text{between}} &= \sum_{i=1}^{k} n_i \left(\bar{x}_i - \bar{x}_{\text{grand}}\right)^2 \\
                    \mathrm{SS}_{\text{within}} &= \sum_{i=1}^{k} (n_i - 1)s_i^2 \\
                    F &= \frac{\mathrm{MS}_{\text{between}}}{\mathrm{MS}_{\text{within}}} = \frac{\mathrm{SS}_{\text{between}}/(k-1)}{\mathrm{SS}_{\text{within}}/(N-k)}
                    \end{aligned}
                    \]
                </div>
                <div class="equation-definitions">
                    <p><strong>Where:</strong></p>
                    <ul>
                        <li>\( k \) is the number of groups and \( N = \sum_{i=1}^{k} n_i \) is the total sample size.</li>
                        <li>\( n_i \) is the sample size, \( \bar{x}_i \) the sample mean, and \( s_i \) the sample standard deviation for group \( i \).</li>
                        <li>\( \bar{x}_{\text{grand}} \) is the grand mean across all observations.</li>
                        <li>\( \mathrm{MS}_{\text{between}} = \mathrm{SS}_{\text{between}}/(k-1) \) and \( \mathrm{MS}_{\text{within}} = \mathrm{SS}_{\text{within}}/(N-k) \).</li>
                    </ul>
                </div>
                <details class="additional-notes" style="margin-top:12px;">
                    <summary>Additional Notes</summary>
                    <p>The omnibus F statistic compares the average between-group variance to the average within-group variance.</p>
                    <div class="technical-note">
                        <h3>From omnibus to follow-ups</h3>
                        <p>
                            A significant F indicates at least one group differs from the overall mean. Planned comparisons—such as
                            Tukey's HSD—then isolate which pairs create that signal while controlling family-wise error.
                        </p>
                        <p>
                            For an accessible refresher on ANOVA structure, review the
                            <a href="https://en.wikipedia.org/wiki/One-way_analysis_of_variance" target="_blank" rel="noopener noreferrer">
                                one-way ANOVA article on Wikipedia
                            </a>.
                        </p>
                    </div>
                </details>
            </div>
        </section>

        <section class="scenario-section">
            <h2>MARKETING SCENARIOS</h2>
            <div class="card">
                <div class="scenario-controls">
                    <label for="scenario-select">Select a marketing scenario:</label>
                    <select id="scenario-select">
                        <option value="">Manual inputs (no preset)</option>
                    </select>
                </div>
                <div id="scenario-description">
                    <p>
                        Choose a preset to auto-fill the group statistics and narrative for a common marketing analysis, or stay on
                        "Manual inputs" to describe your own experiment. Presets can be extended by dropping additional
                        <code>.txt</code> scenario files into the <code>scenarios</code> folder.
                    </p>
                </div>
                <button id="scenario-download" class="secondary hidden" type="button" disabled>Download scenario dataset</button>
            </div>
        </section>

        <section class="input-stack">
            <h2>INPUTS &amp; SETTINGS</h2>
            <article class="card data-entry-card">
                <div class="input-header">
                    <h3>Select Data Entry / Upload Mode</h3>
                </div>
                <div class="mode-toggle" role="tablist" aria-label="Select data entry mode">
                    <button type="button" class="mode-button active" data-mode="manual">Manual entry</button>
                    <button type="button" class="mode-button" data-mode="summary-upload">Upload summary inputs</button>
                    <button type="button" class="mode-button" data-mode="raw-upload">Upload raw data</button>
                </div>
                <div class="mode-panels">
                    <div class="mode-panel active" data-mode="manual" id="manual-panel">
                        <article class="group-controls">
                            <h4>Group Summary Inputs</h4>
                            <p>Select how many groups you want to compare (2–10), then provide each group's mean, standard deviation, and sample size.</p>
                            <div class="input-group inline">
                                <label for="group-count">Select number of groups:</label>
                                <select id="group-count">
                                    <option value="2">2 groups</option>
                                    <option value="3" selected>3 groups</option>
                                    <option value="4">4 groups</option>
                                    <option value="5">5 groups</option>
                                    <option value="6">6 groups</option>
                                    <option value="7">7 groups</option>
                                    <option value="8">8 groups</option>
                                    <option value="9">9 groups</option>
                                    <option value="10">10 groups</option>
                                </select>
                            </div>
                            <p class="hint">The omnibus test always benchmarks each group against the grand mean before any Tukey HSD follow-ups.</p>
                        </article>
                        <article class="group-input-block" aria-label="Group statistics entry">
                            <h4>Enter Group Statistics</h4>
                            <p class="hint">Each row shows the fields for one group. Provide all four values to include the group in the ANOVA.</p>
                            <div class="group-table-wrapper">
                                <table class="group-table" aria-live="polite">
                                    <thead>
                                        <tr>
                                            <th scope="col">Group</th>
                                            <th scope="col">Name / Label</th>
                                            <th scope="col">Mean</th>
                                            <th scope="col">Standard Deviation</th>
                                            <th scope="col">Sample Size (n)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="group-inputs"></tbody>
                                </table>
                            </div>
                        </article>
                    </div>
                    <div class="mode-panel" data-mode="summary-upload" id="summary-panel">
                        <div class="data-import-block">
                            <h4>Upload summary inputs</h4>
                            <p>Upload group-level means you already calculated. Required columns: <strong>group</strong>, <strong>mean</strong>, <strong>sd</strong>, <strong>n</strong>.</p>
                            <div id="summary-dropzone" class="dropzone" role="button" tabindex="0">
                                <p class="dropzone-title">Drag &amp; Drop raw data file (.csv, .tsv, .txt)</p>
                                <p class="dropzone-note">Each row should contain the group label plus mean, SD, and sample size.</p>
                                <button type="button" id="summary-upload-browse" class="secondary">Browse files</button>
                            </div>
                            <input type="file" id="summary-upload-input" accept=".csv,.tsv,.txt" hidden>
                            <div class="template-buttons">
                                <button type="button" id="download-summary-template">Download summary template</button>
                            </div>
                            <p id="summary-upload-status" class="upload-status">No summary file imported yet.</p>
                        </div>
                    </div>
                    <div class="mode-panel" data-mode="raw-upload" id="raw-panel">
                        <div class="data-import-block">
                            <h4>Upload raw long-format data</h4>
                            <p>Provide exactly two columns: <strong>group label</strong> and <strong>numeric value</strong>. Order does not matter; we compute each group&rsquo;s mean, SD, and n.</p>
                            <div id="anova-raw-dropzone" class="dropzone" role="button" tabindex="0">
                                <p class="dropzone-title">Drag &amp; Drop raw data file (.csv, .tsv, .txt)</p>
                                <p class="dropzone-note">Up to 2,000 rows. Each row needs a group label and numeric value.</p>
                                <button type="button" id="raw-upload-browse" class="secondary">Browse files</button>
                            </div>
                            <input type="file" id="anova-raw-input" accept=".csv,.tsv,.txt" hidden>
                            <div class="template-buttons">
                                <button type="button" id="download-raw-template">Download raw template</button>
                            </div>
                            <p id="raw-upload-status" class="upload-status">No raw file uploaded yet.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card analysis-settings test-options">
                <h3>Analysis Settings</h3>
                <div class="confidence-buttons" role="group" aria-label="Select confidence level for mean intervals">
                    <button type="button" class="confidence-button" data-level="0.90">90% CI</button>
                    <button type="button" class="confidence-button active" data-level="0.95">95% CI</button>
                    <button type="button" class="confidence-button" data-level="0.99">99% CI</button>
                </div>
                <div class="input-group">
                    <label for="alpha">Significance Level (a):</label>
                    <input type="number" id="alpha" value="0.05" min="0.001" max="0.25" step="0.005">
                </div>
                <details class="advanced-menu">
                    <summary>Advanced planned comparisons</summary>
                    <p>Enable Tukey's HSD to evaluate specific post hoc contrasts after the omnibus test.</p>
                    <label class="switch-label">
                        <input type="checkbox" id="enable-planned-comparisons">
                        <span>Enable Tukey HSD planned comparisons</span>
                    </label>
                    <div id="planned-comparisons-panel" class="planned-panel" aria-live="polite">
                        <div class="planned-actions">
                            <button id="add-comparison" type="button" class="secondary">Add planned comparison</button>
                        </div>
                        <div id="planned-warning" class="warning hidden" aria-live="polite"></div>
                        <div id="planned-comparisons-list"></div>
                        <div class="tukey-equation">
                            <p><strong>Tukey HSD reference</strong></p>
                            <p>The statistic compares every pair of means with a shared error term:</p>
                            <p class="math-block">
                                $$ q = \frac{\left| \bar{x}_i - \bar{x}_j \right|}{\sqrt{\tfrac{\mathrm{MS}_{\text{within}}}{2}\left(\tfrac{1}{n_i} + \tfrac{1}{n_j}\right)}} $$
                            </p>
                            <p>Pairs with \( q \) larger than the critical studentized range are flagged as significant.</p>
                            <div class="equation-definitions compact">
                                <p><strong>Where:</strong></p>
                                <ul>
                                    <li>\( \bar{x}_i, \bar{x}_j \) are the sample means for groups \( i \) and \( j \).</li>
                                    <li>\( \mathrm{MS}_{\text{within}} \) is the within-group mean square from the ANOVA output.</li>
                                    <li>\( n_i, n_j \) denote the sample sizes for the compared groups.</li>
                                    <li>\( q \) follows the studentized range distribution with \( k \) groups and \( N-k \) degrees of freedom.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>
            </article>
        </section>

        <section class="visualization-section">
            <h2>VISUAL OUTPUT</h2>
            <div class="visualization-wrapper">
                <article class="card chart-card" aria-labelledby="means-chart-title">
                    <h3 id="means-chart-title">Group Means Fan Chart</h3>
                    <div id="means-chart" class="plot-container" role="img" aria-live="polite" aria-label="Fan chart showing group means and confidence intervals"></div>
                    <div id="means-narrative" class="chart-narrative" aria-live="polite"></div>
                </article>
                <article class="card chart-card hidden" id="planned-chart-card" aria-labelledby="planned-chart-title">
                    <h3 id="planned-chart-title">Tukey Planned Comparisons</h3>
                    <div id="planned-chart" class="plot-container" role="img" aria-live="polite" aria-label="Bar chart showing Tukey planned comparisons"></div>
                    <div id="planned-narrative" class="chart-narrative" aria-live="polite"></div>
                </article>
            </div>
        </section>

        <section class="chart-settings" aria-label="Chart settings">
            <div class="card">
                <details>
                    <summary>Visual Output Settings</summary>
                    <article class="axis-card">
                        <h3>Means Fan Chart Axis</h3>
                        <label class="switch-label">
                            <input type="checkbox" id="means-axis-lock">
                            <span>Lock axis to custom range</span>
                        </label>
                        <div class="range-inputs">
                            <div class="input-group inline">
                                <label for="means-axis-min">Min:</label>
                                <input type="number" id="means-axis-min" step="any">
                            </div>
                            <div class="input-group inline">
                                <label for="means-axis-max">Max:</label>
                                <input type="number" id="means-axis-max" step="any">
                            </div>
                        </div>
                        <button id="reset-axis" type="button" class="secondary">Reset Axis Controls</button>
                    </article>
                    <article class="axis-card">
                        <h3>Mean Reference Options</h3>
                        <p>Overlay a dotted line on the fan chart for either the sample-size-weighted grand mean or an equal-weight mean.</p>
                        <label class="switch-label">
                            <input type="checkbox" id="show-overall-mean">
                            <span>Show overall mean line</span>
                        </label>
                        <div class="mean-type-options">
                            <label class="radio-label">
                                <input type="radio" name="mean-reference-type" value="grand" checked>
                                <span>Grand mean (weights by each group's sample size)</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="mean-reference-type" value="weighted">
                                <span>Equal-weight mean (treat every group equally)</span>
                            </label>
                        </div>
                    </article>
                </details>
            </div>
        </section>

        <section class="test-results" aria-labelledby="test-results-heading">
            <h2 id="test-results-heading">TEST RESULTS</h2>
            <div class="dual-panels">
                <article class="card dual-panel">
                    <h3>APA-Style Statistical Reporting</h3>
                    <p id="anova-apa-report"></p>
                </article>
                <article class="card dual-panel">
                    <h3>Managerial Interpretation</h3>
                    <p id="anova-managerial-report"></p>
                </article>
            </div>
            <div id="interpretation" class="card interpretation" aria-live="polite"></div>
        </section>

        <section class="summary-section card" aria-live="polite">
            <h3>Summary of Estimates</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Measure</th>
                        <th>Estimate</th>
                        <th>df / n</th>
                        <th id="summary-ci-lower-header">Lower Bound</th>
                        <th id="summary-ci-upper-header">Upper Bound</th>
                    </tr>
                </thead>
                <tbody id="summary-table-body"></tbody>
            </table>
        </section>

        <section class="diagnostics-section">
            <h2>DIAGNOSTICS &amp; ASSUMPTIONS</h2>
            <div class="card">
                <details class="diagnostics-details">
                    <summary>Diagnostics &amp; Assumption Tests</summary>
                    <div id="diagnostics-content">
                        <p>Run an analysis to populate the diagnostics summary.</p>
                    </div>
                </details>
            </div>
        </section>

    </main>

      <footer class="app-footer">
        <p class="page-timestamps">Created: <span id="created-date">2025-11-06</span> &middot; Last updated: <span id="modified-date">2025-11-15</span></p>
        <p><a href="../../index.html">Back to Stat Analysis Selection</a></p>
        <p class="citation">Cite as: Baker, Andrew. (2025). One-Way ANOVA Tool. Marketing Bivariate Tools. https://github.com/andre/mktg_bivariate_tools/apps/onewayanova/main_onewayanova.html</p>
      </footer>

    <script src="../../shared/js/csv_utils.js"></script>
    <script src="../../shared/js/ui_utils.js"></script>
    <script src="../../shared/js/auth_tracking.js"></script>
    <script src="onewayanova_app.js"></script>
</body>
</html>

